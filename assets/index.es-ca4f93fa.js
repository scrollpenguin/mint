import{b6 as hd,aO as xr,b5 as jr,aP as J_,bc as _r,bd as ur,be as Wc,bf as bt,b3 as Rn,bg as Q_,aQ as X_,bh as lu,bi as Tl,aX as Z_}from"./index-bee7d828.js";import{c as em}from"./_commonjs-dynamic-modules-302442b1.js";import{t as tm}from"./tslib.es6-c2094241.js";var Go={};const qr=hd(tm);var Es={};Object.defineProperty(Es,"__esModule",{value:!0});function rm(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return JSON.parse(n)}catch{return n}}Es.safeJsonParse=rm;function im(n){return typeof n=="string"?n:JSON.stringify(n,(t,r)=>typeof r>"u"?null:r)}Es.safeJsonStringify=im;var is={exports:{}},Ll;function nm(){return Ll||(Ll=1,function(){let n;function t(){}n=t,n.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},n.prototype.setItem=function(r,s){this[r]=String(s)},n.prototype.removeItem=function(r){delete this[r]},n.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(s){r[s]=void 0,delete r[s]})},n.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof xr<"u"&&xr.localStorage?is.exports=xr.localStorage:typeof window<"u"&&window.localStorage?is.exports=window.localStorage:is.exports=new t}()),is.exports}var Cc={},ns={},Ul;function sm(){if(Ul)return ns;Ul=1,Object.defineProperty(ns,"__esModule",{value:!0}),ns.IKeyValueStorage=void 0;class n{}return ns.IKeyValueStorage=n,ns}var ss={},Fl;function om(){if(Fl)return ss;Fl=1,Object.defineProperty(ss,"__esModule",{value:!0}),ss.parseEntry=void 0;const n=Es;function t(r){var s;return[r[0],n.safeJsonParse((s=r[1])!==null&&s!==void 0?s:"")]}return ss.parseEntry=t,ss}var $l;function am(){return $l||($l=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=qr;t.__exportStar(sm(),n),t.__exportStar(om(),n)}(Cc)),Cc}Object.defineProperty(Go,"__esModule",{value:!0});Go.KeyValueStorage=void 0;const An=qr,Dl=Es,cm=An.__importDefault(nm()),um=am();class ld{constructor(){this.localStorage=cm.default}getKeys(){return An.__awaiter(this,void 0,void 0,function*(){return Object.keys(this.localStorage)})}getEntries(){return An.__awaiter(this,void 0,void 0,function*(){return Object.entries(this.localStorage).map(um.parseEntry)})}getItem(t){return An.__awaiter(this,void 0,void 0,function*(){const r=this.localStorage.getItem(t);if(r!==null)return Dl.safeJsonParse(r)})}setItem(t,r){return An.__awaiter(this,void 0,void 0,function*(){this.localStorage.setItem(t,Dl.safeJsonStringify(r))})}removeItem(t){return An.__awaiter(this,void 0,void 0,function*(){this.localStorage.removeItem(t)})}}Go.KeyValueStorage=ld;var hm=Go.default=ld,Un={},os={},ye={},Ac={},as={},Ml;function lm(){if(Ml)return as;Ml=1,Object.defineProperty(as,"__esModule",{value:!0}),as.delay=void 0;function n(t){return new Promise(r=>{setTimeout(()=>{r(!0)},t)})}return as.delay=n,as}var Xi={},Nc={},Zi={},jl;function fm(){return jl||(jl=1,Object.defineProperty(Zi,"__esModule",{value:!0}),Zi.ONE_THOUSAND=Zi.ONE_HUNDRED=void 0,Zi.ONE_HUNDRED=100,Zi.ONE_THOUSAND=1e3),Zi}var Rc={},ql;function dm(){return ql||(ql=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.ONE_YEAR=n.FOUR_WEEKS=n.THREE_WEEKS=n.TWO_WEEKS=n.ONE_WEEK=n.THIRTY_DAYS=n.SEVEN_DAYS=n.FIVE_DAYS=n.THREE_DAYS=n.ONE_DAY=n.TWENTY_FOUR_HOURS=n.TWELVE_HOURS=n.SIX_HOURS=n.THREE_HOURS=n.ONE_HOUR=n.SIXTY_MINUTES=n.THIRTY_MINUTES=n.TEN_MINUTES=n.FIVE_MINUTES=n.ONE_MINUTE=n.SIXTY_SECONDS=n.THIRTY_SECONDS=n.TEN_SECONDS=n.FIVE_SECONDS=n.ONE_SECOND=void 0,n.ONE_SECOND=1,n.FIVE_SECONDS=5,n.TEN_SECONDS=10,n.THIRTY_SECONDS=30,n.SIXTY_SECONDS=60,n.ONE_MINUTE=n.SIXTY_SECONDS,n.FIVE_MINUTES=n.ONE_MINUTE*5,n.TEN_MINUTES=n.ONE_MINUTE*10,n.THIRTY_MINUTES=n.ONE_MINUTE*30,n.SIXTY_MINUTES=n.ONE_MINUTE*60,n.ONE_HOUR=n.SIXTY_MINUTES,n.THREE_HOURS=n.ONE_HOUR*3,n.SIX_HOURS=n.ONE_HOUR*6,n.TWELVE_HOURS=n.ONE_HOUR*12,n.TWENTY_FOUR_HOURS=n.ONE_HOUR*24,n.ONE_DAY=n.TWENTY_FOUR_HOURS,n.THREE_DAYS=n.ONE_DAY*3,n.FIVE_DAYS=n.ONE_DAY*5,n.SEVEN_DAYS=n.ONE_DAY*7,n.THIRTY_DAYS=n.ONE_DAY*30,n.ONE_WEEK=n.SEVEN_DAYS,n.TWO_WEEKS=n.ONE_WEEK*2,n.THREE_WEEKS=n.ONE_WEEK*3,n.FOUR_WEEKS=n.ONE_WEEK*4,n.ONE_YEAR=n.ONE_DAY*365}(Rc)),Rc}var Hl;function fd(){return Hl||(Hl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=qr;t.__exportStar(fm(),n),t.__exportStar(dm(),n)}(Nc)),Nc}var zl;function pm(){if(zl)return Xi;zl=1,Object.defineProperty(Xi,"__esModule",{value:!0}),Xi.fromMiliseconds=Xi.toMiliseconds=void 0;const n=fd();function t(s){return s*n.ONE_THOUSAND}Xi.toMiliseconds=t;function r(s){return Math.floor(s/n.ONE_THOUSAND)}return Xi.fromMiliseconds=r,Xi}var Kl;function gm(){return Kl||(Kl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=qr;t.__exportStar(lm(),n),t.__exportStar(pm(),n)}(Ac)),Ac}var Cn={},Bl;function vm(){if(Bl)return Cn;Bl=1,Object.defineProperty(Cn,"__esModule",{value:!0}),Cn.Watch=void 0;class n{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const s=this.get(r);if(typeof s.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const a=Date.now()-s.started;this.timestamps.set(r,{started:s.started,elapsed:a})}get(r){const s=this.timestamps.get(r);if(typeof s>"u")throw new Error(`No timestamp found for label: ${r}`);return s}elapsed(r){const s=this.get(r);return s.elapsed||Date.now()-s.started}}return Cn.Watch=n,Cn.default=n,Cn}var Tc={},cs={},kl;function ym(){if(kl)return cs;kl=1,Object.defineProperty(cs,"__esModule",{value:!0}),cs.IWatch=void 0;class n{}return cs.IWatch=n,cs}var Vl;function _m(){return Vl||(Vl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),qr.__exportStar(ym(),n)}(Tc)),Tc}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=qr;t.__exportStar(gm(),n),t.__exportStar(vm(),n),t.__exportStar(_m(),n),t.__exportStar(fd(),n)})(ye);var Lc={},us={};let nn=class{};const mm=Object.freeze(Object.defineProperty({__proto__:null,IEvents:nn},Symbol.toStringTag,{value:"Module"})),wm=hd(mm);var Gl;function bm(){if(Gl)return us;Gl=1,Object.defineProperty(us,"__esModule",{value:!0}),us.IHeartBeat=void 0;const n=wm;class t extends n.IEvents{constructor(s){super()}}return us.IHeartBeat=t,us}var Wl;function dd(){return Wl||(Wl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),qr.__exportStar(bm(),n)}(Lc)),Lc}var Uc={},en={},Yl;function Em(){if(Yl)return en;Yl=1,Object.defineProperty(en,"__esModule",{value:!0}),en.HEARTBEAT_EVENTS=en.HEARTBEAT_INTERVAL=void 0;const n=ye;return en.HEARTBEAT_INTERVAL=n.FIVE_SECONDS,en.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},en}var Jl;function pd(){return Jl||(Jl=1,function(n){Object.defineProperty(n,"__esModule",{value:!0}),qr.__exportStar(Em(),n)}(Uc)),Uc}var Ql;function Im(){if(Ql)return os;Ql=1,Object.defineProperty(os,"__esModule",{value:!0}),os.HeartBeat=void 0;const n=qr,t=jr,r=ye,s=dd(),a=pd();class l extends s.IHeartBeat{constructor(d){super(d),this.events=new t.EventEmitter,this.interval=a.HEARTBEAT_INTERVAL,this.interval=(d==null?void 0:d.interval)||a.HEARTBEAT_INTERVAL}static init(d){return n.__awaiter(this,void 0,void 0,function*(){const v=new l(d);return yield v.init(),v})}init(){return n.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(d,v){this.events.on(d,v)}once(d,v){this.events.once(d,v)}off(d,v){this.events.off(d,v)}removeListener(d,v){this.events.removeListener(d,v)}initialize(){return n.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(a.HEARTBEAT_EVENTS.pulse)}}return os.HeartBeat=l,os}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=qr;t.__exportStar(Im(),n),t.__exportStar(dd(),n),t.__exportStar(pd(),n)})(Un);var Ze={},Fc,Xl;function Sm(){if(Xl)return Fc;Xl=1;function n(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Fc=t;function t(r,s,a){var l=a&&a.stringify||n,p=1;if(typeof r=="object"&&r!==null){var d=s.length+p;if(d===1)return r;var v=new Array(d);v[0]=l(r);for(var b=1;b<d;b++)v[b]=l(s[b]);return v.join(" ")}if(typeof r!="string")return r;var I=s.length;if(I===0)return r;for(var C="",$=1-p,N=-1,H=r&&r.length||0,K=0;K<H;){if(r.charCodeAt(K)===37&&K+1<H){switch(N=N>-1?N:0,r.charCodeAt(K+1)){case 100:case 102:if($>=I||s[$]==null)break;N<K&&(C+=r.slice(N,K)),C+=Number(s[$]),N=K+2,K++;break;case 105:if($>=I||s[$]==null)break;N<K&&(C+=r.slice(N,K)),C+=Math.floor(Number(s[$])),N=K+2,K++;break;case 79:case 111:case 106:if($>=I||s[$]===void 0)break;N<K&&(C+=r.slice(N,K));var B=typeof s[$];if(B==="string"){C+="'"+s[$]+"'",N=K+2,K++;break}if(B==="function"){C+=s[$].name||"<anonymous>",N=K+2,K++;break}C+=l(s[$]),N=K+2,K++;break;case 115:if($>=I)break;N<K&&(C+=r.slice(N,K)),C+=String(s[$]),N=K+2,K++;break;case 37:N<K&&(C+=r.slice(N,K)),C+="%",N=K+2,K++,$--;break}++$}++K}return N===-1?r:(N<H&&(C+=r.slice(N)),C)}return Fc}var $c,Zl;function xm(){if(Zl)return $c;Zl=1;const n=Sm();$c=a;const t=P().console||{},r={mapHttpRequest:H,mapHttpResponse:H,wrapRequestSerializer:K,wrapResponseSerializer:K,wrapErrorSerializer:K,req:H,res:H,err:$};function s(m,u){return Array.isArray(m)?m.filter(function(G){return G!=="!stdSerializers.err"}):m===!0?Object.keys(u):!1}function a(m){m=m||{},m.browser=m.browser||{};const u=m.browser.transmit;if(u&&typeof u.send!="function")throw Error("pino: transmit option must have a send function");const _=m.browser.write||t;m.browser.write&&(m.browser.asObject=!0);const G=m.serializers||{},V=s(m.browser.serialize,G);let se=m.browser.serialize;Array.isArray(m.browser.serialize)&&m.browser.serialize.indexOf("!stdSerializers.err")>-1&&(se=!1);const ce=["error","fatal","warn","info","debug","trace"];typeof _=="function"&&(_.error=_.fatal=_.warn=_.info=_.debug=_.trace=_),m.enabled===!1&&(m.level="silent");const ge=m.level||"info",T=Object.create(_);T.log||(T.log=B),Object.defineProperty(T,"levelVal",{get:le}),Object.defineProperty(T,"level",{get:te,set:W});const q={transmit:u,serialize:V,asObject:m.browser.asObject,levels:ce,timestamp:N(m)};T.levels=a.levels,T.level=ge,T.setMaxListeners=T.getMaxListeners=T.emit=T.addListener=T.on=T.prependListener=T.once=T.prependOnceListener=T.removeListener=T.removeAllListeners=T.listeners=T.listenerCount=T.eventNames=T.write=T.flush=B,T.serializers=G,T._serialize=V,T._stdErrSerialize=se,T.child=ee,u&&(T._logEvent=C());function le(){return this.level==="silent"?1/0:this.levels.values[this.level]}function te(){return this._level}function W(Y){if(Y!=="silent"&&!this.levels.values[Y])throw Error("unknown level "+Y);this._level=Y,l(q,T,"error","log"),l(q,T,"fatal","error"),l(q,T,"warn","error"),l(q,T,"info","log"),l(q,T,"debug","log"),l(q,T,"trace","log")}function ee(Y,re){if(!Y)throw new Error("missing bindings for child Pino");re=re||{},V&&Y.serializers&&(re.serializers=Y.serializers);const Oe=re.serializers;if(V&&Oe){var ie=Object.assign({},G,Oe),we=m.browser.serialize===!0?Object.keys(ie):V;delete Y.serializers,v([Y],we,ie,this._stdErrSerialize)}function he(_e){this._childLevel=(_e._childLevel|0)+1,this.error=b(_e,Y,"error"),this.fatal=b(_e,Y,"fatal"),this.warn=b(_e,Y,"warn"),this.info=b(_e,Y,"info"),this.debug=b(_e,Y,"debug"),this.trace=b(_e,Y,"trace"),ie&&(this.serializers=ie,this._serialize=we),u&&(this._logEvent=C([].concat(_e._logEvent.bindings,Y)))}return he.prototype=this,new he(this)}return T}a.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},a.stdSerializers=r,a.stdTimeFunctions=Object.assign({},{nullTime:oe,epochTime:R,unixTime:D,isoTime:S});function l(m,u,_,G){const V=Object.getPrototypeOf(u);u[_]=u.levelVal>u.levels.values[_]?B:V[_]?V[_]:t[_]||t[G]||B,p(m,u,_)}function p(m,u,_){!m.transmit&&u[_]===B||(u[_]=function(G){return function(){const se=m.timestamp(),ce=new Array(arguments.length),ge=Object.getPrototypeOf&&Object.getPrototypeOf(this)===t?t:this;for(var T=0;T<ce.length;T++)ce[T]=arguments[T];if(m.serialize&&!m.asObject&&v(ce,this._serialize,this.serializers,this._stdErrSerialize),m.asObject?G.call(ge,d(this,_,ce,se)):G.apply(ge,ce),m.transmit){const q=m.transmit.level||u.level,le=a.levels.values[q],te=a.levels.values[_];if(te<le)return;I(this,{ts:se,methodLevel:_,methodValue:te,transmitLevel:q,transmitValue:a.levels.values[m.transmit.level||u.level],send:m.transmit.send,val:u.levelVal},ce)}}}(u[_]))}function d(m,u,_,G){m._serialize&&v(_,m._serialize,m.serializers,m._stdErrSerialize);const V=_.slice();let se=V[0];const ce={};G&&(ce.time=G),ce.level=a.levels.values[u];let ge=(m._childLevel|0)+1;if(ge<1&&(ge=1),se!==null&&typeof se=="object"){for(;ge--&&typeof V[0]=="object";)Object.assign(ce,V.shift());se=V.length?n(V.shift(),V):void 0}else typeof se=="string"&&(se=n(V.shift(),V));return se!==void 0&&(ce.msg=se),ce}function v(m,u,_,G){for(const V in m)if(G&&m[V]instanceof Error)m[V]=a.stdSerializers.err(m[V]);else if(typeof m[V]=="object"&&!Array.isArray(m[V]))for(const se in m[V])u&&u.indexOf(se)>-1&&se in _&&(m[V][se]=_[se](m[V][se]))}function b(m,u,_){return function(){const G=new Array(1+arguments.length);G[0]=u;for(var V=1;V<G.length;V++)G[V]=arguments[V-1];return m[_].apply(this,G)}}function I(m,u,_){const G=u.send,V=u.ts,se=u.methodLevel,ce=u.methodValue,ge=u.val,T=m._logEvent.bindings;v(_,m._serialize||Object.keys(m.serializers),m.serializers,m._stdErrSerialize===void 0?!0:m._stdErrSerialize),m._logEvent.ts=V,m._logEvent.messages=_.filter(function(q){return T.indexOf(q)===-1}),m._logEvent.level.label=se,m._logEvent.level.value=ce,G(se,m._logEvent,ge),m._logEvent=C(T)}function C(m){return{ts:0,messages:[],bindings:m||[],level:{label:"",value:0}}}function $(m){const u={type:m.constructor.name,msg:m.message,stack:m.stack};for(const _ in m)u[_]===void 0&&(u[_]=m[_]);return u}function N(m){return typeof m.timestamp=="function"?m.timestamp:m.timestamp===!1?oe:R}function H(){return{}}function K(m){return m}function B(){}function oe(){return!1}function R(){return Date.now()}function D(){return Math.round(Date.now()/1e3)}function S(){return new Date(Date.now()).toISOString()}function P(){function m(u){return typeof u<"u"&&u}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return m(self)||m(window)||m(this)||{}}}return $c}var tn={},ef;function gd(){return ef||(ef=1,Object.defineProperty(tn,"__esModule",{value:!0}),tn.PINO_CUSTOM_CONTEXT_KEY=tn.PINO_LOGGER_DEFAULTS=void 0,tn.PINO_LOGGER_DEFAULTS={level:"info"},tn.PINO_CUSTOM_CONTEXT_KEY="custom_context"),tn}var or={},tf;function Om(){if(tf)return or;tf=1,Object.defineProperty(or,"__esModule",{value:!0}),or.generateChildLogger=or.formatChildLoggerContext=or.getLoggerContext=or.setBrowserLoggerContext=or.getBrowserLoggerContext=or.getDefaultLoggerOptions=void 0;const n=gd();function t(d){return Object.assign(Object.assign({},d),{level:(d==null?void 0:d.level)||n.PINO_LOGGER_DEFAULTS.level})}or.getDefaultLoggerOptions=t;function r(d,v=n.PINO_CUSTOM_CONTEXT_KEY){return d[v]||""}or.getBrowserLoggerContext=r;function s(d,v,b=n.PINO_CUSTOM_CONTEXT_KEY){return d[b]=v,d}or.setBrowserLoggerContext=s;function a(d,v=n.PINO_CUSTOM_CONTEXT_KEY){let b="";return typeof d.bindings>"u"?b=r(d,v):b=d.bindings().context||"",b}or.getLoggerContext=a;function l(d,v,b=n.PINO_CUSTOM_CONTEXT_KEY){const I=a(d,b);return I.trim()?`${I}/${v}`:v}or.formatChildLoggerContext=l;function p(d,v,b=n.PINO_CUSTOM_CONTEXT_KEY){const I=l(d,v,b),C=d.child({context:I});return s(C,I,b)}return or.generateChildLogger=p,or}(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.pino=void 0;const t=qr,r=t.__importDefault(xm());Object.defineProperty(n,"pino",{enumerable:!0,get:function(){return r.default}}),t.__exportStar(gd(),n),t.__exportStar(Om(),n)})(Ze);class Pm extends nn{constructor(t){super(),this.opts=t,this.protocol="wc",this.version=2}}let Cm=class extends nn{constructor(t,r){super(),this.core=t,this.logger=r,this.records=new Map}};class Am{constructor(t,r){this.logger=t,this.core=r}}let Nm=class extends nn{constructor(t,r){super(),this.relayer=t,this.logger=r}},Rm=class extends nn{constructor(t){super()}},Tm=class{constructor(t,r,s,a){this.core=t,this.logger=r,this.name=s}};class Lm extends nn{constructor(t,r){super(),this.relayer=t,this.logger=r}}let Um=class extends nn{constructor(t,r){super(),this.core=t,this.logger=r}},Fm=class{constructor(t,r){this.projectId=t,this.logger=r}},$m=class{constructor(t){this.opts=t,this.protocol="wc",this.version=2}},Dm=class{constructor(t){this.client=t}};const Mm=n=>JSON.stringify(n,(t,r)=>typeof r=="bigint"?r.toString()+"n":r),jm=n=>{const t=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=n.replace(t,'$1"$2n"$3');return JSON.parse(r,(s,a)=>typeof a=="string"&&a.match(/^\d+n$/)?BigInt(a.substring(0,a.length-1)):a)};function fu(n){if(typeof n!="string")throw new Error(`Cannot safe json parse value of type ${typeof n}`);try{return jm(n)}catch{return n}}function _s(n){return typeof n=="string"?n:Mm(n)||""}var du={},Fn={},Wo={},Yo={};Object.defineProperty(Yo,"__esModule",{value:!0});Yo.BrowserRandomSource=void 0;const rf=65536;class qm{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const t=typeof self<"u"?self.crypto||self.msCrypto:null;t&&t.getRandomValues!==void 0&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(t);for(let s=0;s<r.length;s+=rf)this._crypto.getRandomValues(r.subarray(s,s+Math.min(r.length-s,rf)));return r}}Yo.BrowserRandomSource=qm;var Jo={},Pr={};Object.defineProperty(Pr,"__esModule",{value:!0});function Hm(n){for(var t=0;t<n.length;t++)n[t]=0;return n}Pr.wipe=Hm;Object.defineProperty(Jo,"__esModule",{value:!0});Jo.NodeRandomSource=void 0;const zm=Pr;class Km{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof em<"u"){const t=J_();t&&t.randomBytes&&(this._crypto=t,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(t){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(t);if(r.length!==t)throw new Error("NodeRandomSource: got fewer bytes than requested");const s=new Uint8Array(t);for(let a=0;a<s.length;a++)s[a]=r[a];return(0,zm.wipe)(r),s}}Jo.NodeRandomSource=Km;Object.defineProperty(Wo,"__esModule",{value:!0});Wo.SystemRandomSource=void 0;const Bm=Yo,km=Jo;class Vm{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Bm.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new km.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(t){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(t)}}Wo.SystemRandomSource=Vm;var $e={},vd={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});function t(d,v){var b=d>>>16&65535,I=d&65535,C=v>>>16&65535,$=v&65535;return I*$+(b*$+I*C<<16>>>0)|0}n.mul=Math.imul||t;function r(d,v){return d+v|0}n.add=r;function s(d,v){return d-v|0}n.sub=s;function a(d,v){return d<<v|d>>>32-v}n.rotl=a;function l(d,v){return d<<32-v|d>>>v}n.rotr=l;function p(d){return typeof d=="number"&&isFinite(d)&&Math.floor(d)===d}n.isInteger=Number.isInteger||p,n.MAX_SAFE_INTEGER=9007199254740991,n.isSafeInteger=function(d){return n.isInteger(d)&&d>=-n.MAX_SAFE_INTEGER&&d<=n.MAX_SAFE_INTEGER}})(vd);Object.defineProperty($e,"__esModule",{value:!0});var yd=vd;function Gm(n,t){return t===void 0&&(t=0),(n[t+0]<<8|n[t+1])<<16>>16}$e.readInt16BE=Gm;function Wm(n,t){return t===void 0&&(t=0),(n[t+0]<<8|n[t+1])>>>0}$e.readUint16BE=Wm;function Ym(n,t){return t===void 0&&(t=0),(n[t+1]<<8|n[t])<<16>>16}$e.readInt16LE=Ym;function Jm(n,t){return t===void 0&&(t=0),(n[t+1]<<8|n[t])>>>0}$e.readUint16LE=Jm;function _d(n,t,r){return t===void 0&&(t=new Uint8Array(2)),r===void 0&&(r=0),t[r+0]=n>>>8,t[r+1]=n>>>0,t}$e.writeUint16BE=_d;$e.writeInt16BE=_d;function md(n,t,r){return t===void 0&&(t=new Uint8Array(2)),r===void 0&&(r=0),t[r+0]=n>>>0,t[r+1]=n>>>8,t}$e.writeUint16LE=md;$e.writeInt16LE=md;function Yc(n,t){return t===void 0&&(t=0),n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3]}$e.readInt32BE=Yc;function Jc(n,t){return t===void 0&&(t=0),(n[t]<<24|n[t+1]<<16|n[t+2]<<8|n[t+3])>>>0}$e.readUint32BE=Jc;function Qc(n,t){return t===void 0&&(t=0),n[t+3]<<24|n[t+2]<<16|n[t+1]<<8|n[t]}$e.readInt32LE=Qc;function Xc(n,t){return t===void 0&&(t=0),(n[t+3]<<24|n[t+2]<<16|n[t+1]<<8|n[t])>>>0}$e.readUint32LE=Xc;function qo(n,t,r){return t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0),t[r+0]=n>>>24,t[r+1]=n>>>16,t[r+2]=n>>>8,t[r+3]=n>>>0,t}$e.writeUint32BE=qo;$e.writeInt32BE=qo;function Ho(n,t,r){return t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0),t[r+0]=n>>>0,t[r+1]=n>>>8,t[r+2]=n>>>16,t[r+3]=n>>>24,t}$e.writeUint32LE=Ho;$e.writeInt32LE=Ho;function Qm(n,t){t===void 0&&(t=0);var r=Yc(n,t),s=Yc(n,t+4);return r*4294967296+s-(s>>31)*4294967296}$e.readInt64BE=Qm;function Xm(n,t){t===void 0&&(t=0);var r=Jc(n,t),s=Jc(n,t+4);return r*4294967296+s}$e.readUint64BE=Xm;function Zm(n,t){t===void 0&&(t=0);var r=Qc(n,t),s=Qc(n,t+4);return s*4294967296+r-(r>>31)*4294967296}$e.readInt64LE=Zm;function ew(n,t){t===void 0&&(t=0);var r=Xc(n,t),s=Xc(n,t+4);return s*4294967296+r}$e.readUint64LE=ew;function wd(n,t,r){return t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0),qo(n/4294967296>>>0,t,r),qo(n>>>0,t,r+4),t}$e.writeUint64BE=wd;$e.writeInt64BE=wd;function bd(n,t,r){return t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0),Ho(n>>>0,t,r),Ho(n/4294967296>>>0,t,r+4),t}$e.writeUint64LE=bd;$e.writeInt64LE=bd;function tw(n,t,r){if(r===void 0&&(r=0),n%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(n/8>t.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var s=0,a=1,l=n/8+r-1;l>=r;l--)s+=t[l]*a,a*=256;return s}$e.readUintBE=tw;function rw(n,t,r){if(r===void 0&&(r=0),n%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(n/8>t.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var s=0,a=1,l=r;l<r+n/8;l++)s+=t[l]*a,a*=256;return s}$e.readUintLE=rw;function iw(n,t,r,s){if(r===void 0&&(r=new Uint8Array(n/8)),s===void 0&&(s=0),n%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!yd.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var a=1,l=n/8+s-1;l>=s;l--)r[l]=t/a&255,a*=256;return r}$e.writeUintBE=iw;function nw(n,t,r,s){if(r===void 0&&(r=new Uint8Array(n/8)),s===void 0&&(s=0),n%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!yd.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var a=1,l=s;l<s+n/8;l++)r[l]=t/a&255,a*=256;return r}$e.writeUintLE=nw;function sw(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat32(t)}$e.readFloat32BE=sw;function ow(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat32(t,!0)}$e.readFloat32LE=ow;function aw(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat64(t)}$e.readFloat64BE=aw;function cw(n,t){t===void 0&&(t=0);var r=new DataView(n.buffer,n.byteOffset,n.byteLength);return r.getFloat64(t,!0)}$e.readFloat64LE=cw;function uw(n,t,r){t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat32(r,n),t}$e.writeFloat32BE=uw;function hw(n,t,r){t===void 0&&(t=new Uint8Array(4)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat32(r,n,!0),t}$e.writeFloat32LE=hw;function lw(n,t,r){t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat64(r,n),t}$e.writeFloat64BE=lw;function fw(n,t,r){t===void 0&&(t=new Uint8Array(8)),r===void 0&&(r=0);var s=new DataView(t.buffer,t.byteOffset,t.byteLength);return s.setFloat64(r,n,!0),t}$e.writeFloat64LE=fw;(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.randomStringForEntropy=n.randomString=n.randomUint32=n.randomBytes=n.defaultRandomSource=void 0;const t=Wo,r=$e,s=Pr;n.defaultRandomSource=new t.SystemRandomSource;function a(b,I=n.defaultRandomSource){return I.randomBytes(b)}n.randomBytes=a;function l(b=n.defaultRandomSource){const I=a(4,b),C=(0,r.readUint32LE)(I);return(0,s.wipe)(I),C}n.randomUint32=l;const p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function d(b,I=p,C=n.defaultRandomSource){if(I.length<2)throw new Error("randomString charset is too short");if(I.length>256)throw new Error("randomString charset is too long");let $="";const N=I.length,H=256-256%N;for(;b>0;){const K=a(Math.ceil(b*256/H),C);for(let B=0;B<K.length&&b>0;B++){const oe=K[B];oe<H&&($+=I.charAt(oe%N),b--)}(0,s.wipe)(K)}return $}n.randomString=d;function v(b,I=p,C=n.defaultRandomSource){const $=Math.ceil(b/(Math.log(I.length)/Math.LN2));return d($,I,C)}n.randomStringForEntropy=v})(Fn);var Ed={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=$e,r=Pr;n.DIGEST_LENGTH=64,n.BLOCK_SIZE=128;var s=function(){function d(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return d.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},d.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},d.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},d.prototype.update=function(v,b){if(b===void 0&&(b=v.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var I=0;if(this._bytesHashed+=b,this._bufferLength>0){for(;this._bufferLength<n.BLOCK_SIZE&&b>0;)this._buffer[this._bufferLength++]=v[I++],b--;this._bufferLength===this.blockSize&&(l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(b>=this.blockSize&&(I=l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,v,I,b),b%=this.blockSize);b>0;)this._buffer[this._bufferLength++]=v[I++],b--;return this},d.prototype.finish=function(v){if(!this._finished){var b=this._bytesHashed,I=this._bufferLength,C=b/536870912|0,$=b<<3,N=b%128<112?128:256;this._buffer[I]=128;for(var H=I+1;H<N-8;H++)this._buffer[H]=0;t.writeUint32BE(C,this._buffer,N-8),t.writeUint32BE($,this._buffer,N-4),l(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,N),this._finished=!0}for(var H=0;H<this.digestLength/8;H++)t.writeUint32BE(this._stateHi[H],v,H*8),t.writeUint32BE(this._stateLo[H],v,H*8+4);return this},d.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},d.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},d.prototype.restoreState=function(v){return this._stateHi.set(v.stateHi),this._stateLo.set(v.stateLo),this._bufferLength=v.bufferLength,v.buffer&&this._buffer.set(v.buffer),this._bytesHashed=v.bytesHashed,this._finished=!1,this},d.prototype.cleanSavedState=function(v){r.wipe(v.stateHi),r.wipe(v.stateLo),v.buffer&&r.wipe(v.buffer),v.bufferLength=0,v.bytesHashed=0},d}();n.SHA512=s;var a=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function l(d,v,b,I,C,$,N){for(var H=b[0],K=b[1],B=b[2],oe=b[3],R=b[4],D=b[5],S=b[6],P=b[7],m=I[0],u=I[1],_=I[2],G=I[3],V=I[4],se=I[5],ce=I[6],ge=I[7],T,q,le,te,W,ee,Y,re;N>=128;){for(var Oe=0;Oe<16;Oe++){var ie=8*Oe+$;d[Oe]=t.readUint32BE(C,ie),v[Oe]=t.readUint32BE(C,ie+4)}for(var Oe=0;Oe<80;Oe++){var we=H,he=K,_e=B,j=oe,M=R,A=D,h=S,x=P,ne=m,fe=u,Se=_,ze=G,ke=V,De=se,pt=ce,gt=ge;if(T=P,q=ge,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=(R>>>14|V<<32-14)^(R>>>18|V<<32-18)^(V>>>41-32|R<<32-(41-32)),q=(V>>>14|R<<32-14)^(V>>>18|R<<32-18)^(R>>>41-32|V<<32-(41-32)),W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,T=R&D^~R&S,q=V&se^~V&ce,W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,T=a[Oe*2],q=a[Oe*2+1],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,T=d[Oe%16],q=v[Oe%16],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,le=Y&65535|re<<16,te=W&65535|ee<<16,T=le,q=te,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=(H>>>28|m<<32-28)^(m>>>34-32|H<<32-(34-32))^(m>>>39-32|H<<32-(39-32)),q=(m>>>28|H<<32-28)^(H>>>34-32|m<<32-(34-32))^(H>>>39-32|m<<32-(39-32)),W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,T=H&K^H&B^K&B,q=m&u^m&_^u&_,W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,x=Y&65535|re<<16,gt=W&65535|ee<<16,T=j,q=ze,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=le,q=te,W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,j=Y&65535|re<<16,ze=W&65535|ee<<16,K=we,B=he,oe=_e,R=j,D=M,S=A,P=h,H=x,u=ne,_=fe,G=Se,V=ze,se=ke,ce=De,ge=pt,m=gt,Oe%16===15)for(var ie=0;ie<16;ie++)T=d[ie],q=v[ie],W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=d[(ie+9)%16],q=v[(ie+9)%16],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,le=d[(ie+1)%16],te=v[(ie+1)%16],T=(le>>>1|te<<32-1)^(le>>>8|te<<32-8)^le>>>7,q=(te>>>1|le<<32-1)^(te>>>8|le<<32-8)^(te>>>7|le<<32-7),W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,le=d[(ie+14)%16],te=v[(ie+14)%16],T=(le>>>19|te<<32-19)^(te>>>61-32|le<<32-(61-32))^le>>>6,q=(te>>>19|le<<32-19)^(le>>>61-32|te<<32-(61-32))^(te>>>6|le<<32-6),W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,d[ie]=Y&65535|re<<16,v[ie]=W&65535|ee<<16}T=H,q=m,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[0],q=I[0],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[0]=H=Y&65535|re<<16,I[0]=m=W&65535|ee<<16,T=K,q=u,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[1],q=I[1],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[1]=K=Y&65535|re<<16,I[1]=u=W&65535|ee<<16,T=B,q=_,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[2],q=I[2],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[2]=B=Y&65535|re<<16,I[2]=_=W&65535|ee<<16,T=oe,q=G,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[3],q=I[3],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[3]=oe=Y&65535|re<<16,I[3]=G=W&65535|ee<<16,T=R,q=V,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[4],q=I[4],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[4]=R=Y&65535|re<<16,I[4]=V=W&65535|ee<<16,T=D,q=se,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[5],q=I[5],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[5]=D=Y&65535|re<<16,I[5]=se=W&65535|ee<<16,T=S,q=ce,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[6],q=I[6],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[6]=S=Y&65535|re<<16,I[6]=ce=W&65535|ee<<16,T=P,q=ge,W=q&65535,ee=q>>>16,Y=T&65535,re=T>>>16,T=b[7],q=I[7],W+=q&65535,ee+=q>>>16,Y+=T&65535,re+=T>>>16,ee+=W>>>16,Y+=ee>>>16,re+=Y>>>16,b[7]=P=Y&65535|re<<16,I[7]=ge=W&65535|ee<<16,$+=128,N-=128}return $}function p(d){var v=new s;v.update(d);var b=v.digest();return v.clean(),b}n.hash=p})(Ed);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertSecretKeyToX25519=n.convertPublicKeyToX25519=n.verify=n.sign=n.extractPublicKeyFromSecretKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.SEED_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=n.SIGNATURE_LENGTH=void 0;const t=Fn,r=Ed,s=Pr;n.SIGNATURE_LENGTH=64,n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=64,n.SEED_LENGTH=32;function a(j){const M=new Float64Array(16);if(j)for(let A=0;A<j.length;A++)M[A]=j[A];return M}const l=new Uint8Array(32);l[0]=9;const p=a(),d=a([1]),v=a([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),b=a([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),I=a([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),C=a([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),$=a([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function N(j,M){for(let A=0;A<16;A++)j[A]=M[A]|0}function H(j){let M=1;for(let A=0;A<16;A++){let h=j[A]+M+65535;M=Math.floor(h/65536),j[A]=h-M*65536}j[0]+=M-1+37*(M-1)}function K(j,M,A){const h=~(A-1);for(let x=0;x<16;x++){const ne=h&(j[x]^M[x]);j[x]^=ne,M[x]^=ne}}function B(j,M){const A=a(),h=a();for(let x=0;x<16;x++)h[x]=M[x];H(h),H(h),H(h);for(let x=0;x<2;x++){A[0]=h[0]-65517;for(let fe=1;fe<15;fe++)A[fe]=h[fe]-65535-(A[fe-1]>>16&1),A[fe-1]&=65535;A[15]=h[15]-32767-(A[14]>>16&1);const ne=A[15]>>16&1;A[14]&=65535,K(h,A,1-ne)}for(let x=0;x<16;x++)j[2*x]=h[x]&255,j[2*x+1]=h[x]>>8}function oe(j,M){let A=0;for(let h=0;h<32;h++)A|=j[h]^M[h];return(1&A-1>>>8)-1}function R(j,M){const A=new Uint8Array(32),h=new Uint8Array(32);return B(A,j),B(h,M),oe(A,h)}function D(j){const M=new Uint8Array(32);return B(M,j),M[0]&1}function S(j,M){for(let A=0;A<16;A++)j[A]=M[2*A]+(M[2*A+1]<<8);j[15]&=32767}function P(j,M,A){for(let h=0;h<16;h++)j[h]=M[h]+A[h]}function m(j,M,A){for(let h=0;h<16;h++)j[h]=M[h]-A[h]}function u(j,M,A){let h,x,ne=0,fe=0,Se=0,ze=0,ke=0,De=0,pt=0,gt=0,je=0,xe=0,Le=0,Ue=0,qe=0,Ce=0,Fe=0,Ie=0,Ae=0,Ke=0,Pe=0,Ve=0,We=0,et=0,tt=0,Je=0,er=0,hr=0,Yr=0,tr=0,si=0,Ei=0,Mi=0,Et=A[0],vt=A[1],It=A[2],St=A[3],mt=A[4],yt=A[5],Ft=A[6],$t=A[7],xt=A[8],Dt=A[9],Ot=A[10],At=A[11],Pt=A[12],ht=A[13],Mt=A[14],jt=A[15];h=M[0],ne+=h*Et,fe+=h*vt,Se+=h*It,ze+=h*St,ke+=h*mt,De+=h*yt,pt+=h*Ft,gt+=h*$t,je+=h*xt,xe+=h*Dt,Le+=h*Ot,Ue+=h*At,qe+=h*Pt,Ce+=h*ht,Fe+=h*Mt,Ie+=h*jt,h=M[1],fe+=h*Et,Se+=h*vt,ze+=h*It,ke+=h*St,De+=h*mt,pt+=h*yt,gt+=h*Ft,je+=h*$t,xe+=h*xt,Le+=h*Dt,Ue+=h*Ot,qe+=h*At,Ce+=h*Pt,Fe+=h*ht,Ie+=h*Mt,Ae+=h*jt,h=M[2],Se+=h*Et,ze+=h*vt,ke+=h*It,De+=h*St,pt+=h*mt,gt+=h*yt,je+=h*Ft,xe+=h*$t,Le+=h*xt,Ue+=h*Dt,qe+=h*Ot,Ce+=h*At,Fe+=h*Pt,Ie+=h*ht,Ae+=h*Mt,Ke+=h*jt,h=M[3],ze+=h*Et,ke+=h*vt,De+=h*It,pt+=h*St,gt+=h*mt,je+=h*yt,xe+=h*Ft,Le+=h*$t,Ue+=h*xt,qe+=h*Dt,Ce+=h*Ot,Fe+=h*At,Ie+=h*Pt,Ae+=h*ht,Ke+=h*Mt,Pe+=h*jt,h=M[4],ke+=h*Et,De+=h*vt,pt+=h*It,gt+=h*St,je+=h*mt,xe+=h*yt,Le+=h*Ft,Ue+=h*$t,qe+=h*xt,Ce+=h*Dt,Fe+=h*Ot,Ie+=h*At,Ae+=h*Pt,Ke+=h*ht,Pe+=h*Mt,Ve+=h*jt,h=M[5],De+=h*Et,pt+=h*vt,gt+=h*It,je+=h*St,xe+=h*mt,Le+=h*yt,Ue+=h*Ft,qe+=h*$t,Ce+=h*xt,Fe+=h*Dt,Ie+=h*Ot,Ae+=h*At,Ke+=h*Pt,Pe+=h*ht,Ve+=h*Mt,We+=h*jt,h=M[6],pt+=h*Et,gt+=h*vt,je+=h*It,xe+=h*St,Le+=h*mt,Ue+=h*yt,qe+=h*Ft,Ce+=h*$t,Fe+=h*xt,Ie+=h*Dt,Ae+=h*Ot,Ke+=h*At,Pe+=h*Pt,Ve+=h*ht,We+=h*Mt,et+=h*jt,h=M[7],gt+=h*Et,je+=h*vt,xe+=h*It,Le+=h*St,Ue+=h*mt,qe+=h*yt,Ce+=h*Ft,Fe+=h*$t,Ie+=h*xt,Ae+=h*Dt,Ke+=h*Ot,Pe+=h*At,Ve+=h*Pt,We+=h*ht,et+=h*Mt,tt+=h*jt,h=M[8],je+=h*Et,xe+=h*vt,Le+=h*It,Ue+=h*St,qe+=h*mt,Ce+=h*yt,Fe+=h*Ft,Ie+=h*$t,Ae+=h*xt,Ke+=h*Dt,Pe+=h*Ot,Ve+=h*At,We+=h*Pt,et+=h*ht,tt+=h*Mt,Je+=h*jt,h=M[9],xe+=h*Et,Le+=h*vt,Ue+=h*It,qe+=h*St,Ce+=h*mt,Fe+=h*yt,Ie+=h*Ft,Ae+=h*$t,Ke+=h*xt,Pe+=h*Dt,Ve+=h*Ot,We+=h*At,et+=h*Pt,tt+=h*ht,Je+=h*Mt,er+=h*jt,h=M[10],Le+=h*Et,Ue+=h*vt,qe+=h*It,Ce+=h*St,Fe+=h*mt,Ie+=h*yt,Ae+=h*Ft,Ke+=h*$t,Pe+=h*xt,Ve+=h*Dt,We+=h*Ot,et+=h*At,tt+=h*Pt,Je+=h*ht,er+=h*Mt,hr+=h*jt,h=M[11],Ue+=h*Et,qe+=h*vt,Ce+=h*It,Fe+=h*St,Ie+=h*mt,Ae+=h*yt,Ke+=h*Ft,Pe+=h*$t,Ve+=h*xt,We+=h*Dt,et+=h*Ot,tt+=h*At,Je+=h*Pt,er+=h*ht,hr+=h*Mt,Yr+=h*jt,h=M[12],qe+=h*Et,Ce+=h*vt,Fe+=h*It,Ie+=h*St,Ae+=h*mt,Ke+=h*yt,Pe+=h*Ft,Ve+=h*$t,We+=h*xt,et+=h*Dt,tt+=h*Ot,Je+=h*At,er+=h*Pt,hr+=h*ht,Yr+=h*Mt,tr+=h*jt,h=M[13],Ce+=h*Et,Fe+=h*vt,Ie+=h*It,Ae+=h*St,Ke+=h*mt,Pe+=h*yt,Ve+=h*Ft,We+=h*$t,et+=h*xt,tt+=h*Dt,Je+=h*Ot,er+=h*At,hr+=h*Pt,Yr+=h*ht,tr+=h*Mt,si+=h*jt,h=M[14],Fe+=h*Et,Ie+=h*vt,Ae+=h*It,Ke+=h*St,Pe+=h*mt,Ve+=h*yt,We+=h*Ft,et+=h*$t,tt+=h*xt,Je+=h*Dt,er+=h*Ot,hr+=h*At,Yr+=h*Pt,tr+=h*ht,si+=h*Mt,Ei+=h*jt,h=M[15],Ie+=h*Et,Ae+=h*vt,Ke+=h*It,Pe+=h*St,Ve+=h*mt,We+=h*yt,et+=h*Ft,tt+=h*$t,Je+=h*xt,er+=h*Dt,hr+=h*Ot,Yr+=h*At,tr+=h*Pt,si+=h*ht,Ei+=h*Mt,Mi+=h*jt,ne+=38*Ae,fe+=38*Ke,Se+=38*Pe,ze+=38*Ve,ke+=38*We,De+=38*et,pt+=38*tt,gt+=38*Je,je+=38*er,xe+=38*hr,Le+=38*Yr,Ue+=38*tr,qe+=38*si,Ce+=38*Ei,Fe+=38*Mi,x=1,h=ne+x+65535,x=Math.floor(h/65536),ne=h-x*65536,h=fe+x+65535,x=Math.floor(h/65536),fe=h-x*65536,h=Se+x+65535,x=Math.floor(h/65536),Se=h-x*65536,h=ze+x+65535,x=Math.floor(h/65536),ze=h-x*65536,h=ke+x+65535,x=Math.floor(h/65536),ke=h-x*65536,h=De+x+65535,x=Math.floor(h/65536),De=h-x*65536,h=pt+x+65535,x=Math.floor(h/65536),pt=h-x*65536,h=gt+x+65535,x=Math.floor(h/65536),gt=h-x*65536,h=je+x+65535,x=Math.floor(h/65536),je=h-x*65536,h=xe+x+65535,x=Math.floor(h/65536),xe=h-x*65536,h=Le+x+65535,x=Math.floor(h/65536),Le=h-x*65536,h=Ue+x+65535,x=Math.floor(h/65536),Ue=h-x*65536,h=qe+x+65535,x=Math.floor(h/65536),qe=h-x*65536,h=Ce+x+65535,x=Math.floor(h/65536),Ce=h-x*65536,h=Fe+x+65535,x=Math.floor(h/65536),Fe=h-x*65536,h=Ie+x+65535,x=Math.floor(h/65536),Ie=h-x*65536,ne+=x-1+37*(x-1),x=1,h=ne+x+65535,x=Math.floor(h/65536),ne=h-x*65536,h=fe+x+65535,x=Math.floor(h/65536),fe=h-x*65536,h=Se+x+65535,x=Math.floor(h/65536),Se=h-x*65536,h=ze+x+65535,x=Math.floor(h/65536),ze=h-x*65536,h=ke+x+65535,x=Math.floor(h/65536),ke=h-x*65536,h=De+x+65535,x=Math.floor(h/65536),De=h-x*65536,h=pt+x+65535,x=Math.floor(h/65536),pt=h-x*65536,h=gt+x+65535,x=Math.floor(h/65536),gt=h-x*65536,h=je+x+65535,x=Math.floor(h/65536),je=h-x*65536,h=xe+x+65535,x=Math.floor(h/65536),xe=h-x*65536,h=Le+x+65535,x=Math.floor(h/65536),Le=h-x*65536,h=Ue+x+65535,x=Math.floor(h/65536),Ue=h-x*65536,h=qe+x+65535,x=Math.floor(h/65536),qe=h-x*65536,h=Ce+x+65535,x=Math.floor(h/65536),Ce=h-x*65536,h=Fe+x+65535,x=Math.floor(h/65536),Fe=h-x*65536,h=Ie+x+65535,x=Math.floor(h/65536),Ie=h-x*65536,ne+=x-1+37*(x-1),j[0]=ne,j[1]=fe,j[2]=Se,j[3]=ze,j[4]=ke,j[5]=De,j[6]=pt,j[7]=gt,j[8]=je,j[9]=xe,j[10]=Le,j[11]=Ue,j[12]=qe,j[13]=Ce,j[14]=Fe,j[15]=Ie}function _(j,M){u(j,M,M)}function G(j,M){const A=a();let h;for(h=0;h<16;h++)A[h]=M[h];for(h=253;h>=0;h--)_(A,A),h!==2&&h!==4&&u(A,A,M);for(h=0;h<16;h++)j[h]=A[h]}function V(j,M){const A=a();let h;for(h=0;h<16;h++)A[h]=M[h];for(h=250;h>=0;h--)_(A,A),h!==1&&u(A,A,M);for(h=0;h<16;h++)j[h]=A[h]}function se(j,M){const A=a(),h=a(),x=a(),ne=a(),fe=a(),Se=a(),ze=a(),ke=a(),De=a();m(A,j[1],j[0]),m(De,M[1],M[0]),u(A,A,De),P(h,j[0],j[1]),P(De,M[0],M[1]),u(h,h,De),u(x,j[3],M[3]),u(x,x,b),u(ne,j[2],M[2]),P(ne,ne,ne),m(fe,h,A),m(Se,ne,x),P(ze,ne,x),P(ke,h,A),u(j[0],fe,Se),u(j[1],ke,ze),u(j[2],ze,Se),u(j[3],fe,ke)}function ce(j,M,A){for(let h=0;h<4;h++)K(j[h],M[h],A)}function ge(j,M){const A=a(),h=a(),x=a();G(x,M[2]),u(A,M[0],x),u(h,M[1],x),B(j,h),j[31]^=D(A)<<7}function T(j,M,A){N(j[0],p),N(j[1],d),N(j[2],d),N(j[3],p);for(let h=255;h>=0;--h){const x=A[h/8|0]>>(h&7)&1;ce(j,M,x),se(M,j),se(j,j),ce(j,M,x)}}function q(j,M){const A=[a(),a(),a(),a()];N(A[0],I),N(A[1],C),N(A[2],d),u(A[3],I,C),T(j,A,M)}function le(j){if(j.length!==n.SEED_LENGTH)throw new Error(`ed25519: seed must be ${n.SEED_LENGTH} bytes`);const M=(0,r.hash)(j);M[0]&=248,M[31]&=127,M[31]|=64;const A=new Uint8Array(32),h=[a(),a(),a(),a()];q(h,M),ge(A,h);const x=new Uint8Array(64);return x.set(j),x.set(A,32),{publicKey:A,secretKey:x}}n.generateKeyPairFromSeed=le;function te(j){const M=(0,t.randomBytes)(32,j),A=le(M);return(0,s.wipe)(M),A}n.generateKeyPair=te;function W(j){if(j.length!==n.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${n.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(j.subarray(32))}n.extractPublicKeyFromSecretKey=W;const ee=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function Y(j,M){let A,h,x,ne;for(h=63;h>=32;--h){for(A=0,x=h-32,ne=h-12;x<ne;++x)M[x]+=A-16*M[h]*ee[x-(h-32)],A=Math.floor((M[x]+128)/256),M[x]-=A*256;M[x]+=A,M[h]=0}for(A=0,x=0;x<32;x++)M[x]+=A-(M[31]>>4)*ee[x],A=M[x]>>8,M[x]&=255;for(x=0;x<32;x++)M[x]-=A*ee[x];for(h=0;h<32;h++)M[h+1]+=M[h]>>8,j[h]=M[h]&255}function re(j){const M=new Float64Array(64);for(let A=0;A<64;A++)M[A]=j[A];for(let A=0;A<64;A++)j[A]=0;Y(j,M)}function Oe(j,M){const A=new Float64Array(64),h=[a(),a(),a(),a()],x=(0,r.hash)(j.subarray(0,32));x[0]&=248,x[31]&=127,x[31]|=64;const ne=new Uint8Array(64);ne.set(x.subarray(32),32);const fe=new r.SHA512;fe.update(ne.subarray(32)),fe.update(M);const Se=fe.digest();fe.clean(),re(Se),q(h,Se),ge(ne,h),fe.reset(),fe.update(ne.subarray(0,32)),fe.update(j.subarray(32)),fe.update(M);const ze=fe.digest();re(ze);for(let ke=0;ke<32;ke++)A[ke]=Se[ke];for(let ke=0;ke<32;ke++)for(let De=0;De<32;De++)A[ke+De]+=ze[ke]*x[De];return Y(ne.subarray(32),A),ne}n.sign=Oe;function ie(j,M){const A=a(),h=a(),x=a(),ne=a(),fe=a(),Se=a(),ze=a();return N(j[2],d),S(j[1],M),_(x,j[1]),u(ne,x,v),m(x,x,j[2]),P(ne,j[2],ne),_(fe,ne),_(Se,fe),u(ze,Se,fe),u(A,ze,x),u(A,A,ne),V(A,A),u(A,A,x),u(A,A,ne),u(A,A,ne),u(j[0],A,ne),_(h,j[0]),u(h,h,ne),R(h,x)&&u(j[0],j[0],$),_(h,j[0]),u(h,h,ne),R(h,x)?-1:(D(j[0])===M[31]>>7&&m(j[0],p,j[0]),u(j[3],j[0],j[1]),0)}function we(j,M,A){const h=new Uint8Array(32),x=[a(),a(),a(),a()],ne=[a(),a(),a(),a()];if(A.length!==n.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${n.SIGNATURE_LENGTH} bytes`);if(ie(ne,j))return!1;const fe=new r.SHA512;fe.update(A.subarray(0,32)),fe.update(j),fe.update(M);const Se=fe.digest();return re(Se),T(x,ne,Se),q(ne,A.subarray(32)),se(x,ne),ge(h,x),!oe(A,h)}n.verify=we;function he(j){let M=[a(),a(),a(),a()];if(ie(M,j))throw new Error("Ed25519: invalid public key");let A=a(),h=a(),x=M[1];P(A,d,x),m(h,d,x),G(h,h),u(A,A,h);let ne=new Uint8Array(32);return B(ne,A),ne}n.convertPublicKeyToX25519=he;function _e(j){const M=(0,r.hash)(j.subarray(0,32));M[0]&=248,M[31]&=127,M[31]|=64;const A=new Uint8Array(M.subarray(0,32));return(0,s.wipe)(M),A}n.convertSecretKeyToX25519=_e})(du);const dw="EdDSA",pw="JWT",Id=".",Sd="base64url",gw="utf8",vw="utf8",yw=":",_w="did",mw="key",nf="base58btc",ww="z",bw="K36",Ew=32;function zo(n){return ur(_r(_s(n),gw),Sd)}function xd(n){const t=_r(bw,nf),r=ww+ur(Wc([t,n]),nf);return[_w,mw,r].join(yw)}function Iw(n){return ur(n,Sd)}function Sw(n){return _r([zo(n.header),zo(n.payload)].join(Id),vw)}function xw(n){return[zo(n.header),zo(n.payload),Iw(n.signature)].join(Id)}function sf(n=Fn.randomBytes(Ew)){return du.generateKeyPairFromSeed(n)}async function Ow(n,t,r,s,a=ye.fromMiliseconds(Date.now())){const l={alg:dw,typ:pw},p=xd(s.publicKey),d=a+r,v={iss:p,sub:n,aud:t,iat:a,exp:d},b=Sw({header:l,payload:v}),I=du.sign(s.secretKey,b);return xw({header:l,payload:v,signature:I})}var pu={},Qo={};Object.defineProperty(Qo,"__esModule",{value:!0});var Xt=$e,Zc=Pr,Pw=20;function Cw(n,t,r){for(var s=1634760805,a=857760878,l=2036477234,p=1797285236,d=r[3]<<24|r[2]<<16|r[1]<<8|r[0],v=r[7]<<24|r[6]<<16|r[5]<<8|r[4],b=r[11]<<24|r[10]<<16|r[9]<<8|r[8],I=r[15]<<24|r[14]<<16|r[13]<<8|r[12],C=r[19]<<24|r[18]<<16|r[17]<<8|r[16],$=r[23]<<24|r[22]<<16|r[21]<<8|r[20],N=r[27]<<24|r[26]<<16|r[25]<<8|r[24],H=r[31]<<24|r[30]<<16|r[29]<<8|r[28],K=t[3]<<24|t[2]<<16|t[1]<<8|t[0],B=t[7]<<24|t[6]<<16|t[5]<<8|t[4],oe=t[11]<<24|t[10]<<16|t[9]<<8|t[8],R=t[15]<<24|t[14]<<16|t[13]<<8|t[12],D=s,S=a,P=l,m=p,u=d,_=v,G=b,V=I,se=C,ce=$,ge=N,T=H,q=K,le=B,te=oe,W=R,ee=0;ee<Pw;ee+=2)D=D+u|0,q^=D,q=q>>>32-16|q<<16,se=se+q|0,u^=se,u=u>>>32-12|u<<12,S=S+_|0,le^=S,le=le>>>32-16|le<<16,ce=ce+le|0,_^=ce,_=_>>>32-12|_<<12,P=P+G|0,te^=P,te=te>>>32-16|te<<16,ge=ge+te|0,G^=ge,G=G>>>32-12|G<<12,m=m+V|0,W^=m,W=W>>>32-16|W<<16,T=T+W|0,V^=T,V=V>>>32-12|V<<12,P=P+G|0,te^=P,te=te>>>32-8|te<<8,ge=ge+te|0,G^=ge,G=G>>>32-7|G<<7,m=m+V|0,W^=m,W=W>>>32-8|W<<8,T=T+W|0,V^=T,V=V>>>32-7|V<<7,S=S+_|0,le^=S,le=le>>>32-8|le<<8,ce=ce+le|0,_^=ce,_=_>>>32-7|_<<7,D=D+u|0,q^=D,q=q>>>32-8|q<<8,se=se+q|0,u^=se,u=u>>>32-7|u<<7,D=D+_|0,W^=D,W=W>>>32-16|W<<16,ge=ge+W|0,_^=ge,_=_>>>32-12|_<<12,S=S+G|0,q^=S,q=q>>>32-16|q<<16,T=T+q|0,G^=T,G=G>>>32-12|G<<12,P=P+V|0,le^=P,le=le>>>32-16|le<<16,se=se+le|0,V^=se,V=V>>>32-12|V<<12,m=m+u|0,te^=m,te=te>>>32-16|te<<16,ce=ce+te|0,u^=ce,u=u>>>32-12|u<<12,P=P+V|0,le^=P,le=le>>>32-8|le<<8,se=se+le|0,V^=se,V=V>>>32-7|V<<7,m=m+u|0,te^=m,te=te>>>32-8|te<<8,ce=ce+te|0,u^=ce,u=u>>>32-7|u<<7,S=S+G|0,q^=S,q=q>>>32-8|q<<8,T=T+q|0,G^=T,G=G>>>32-7|G<<7,D=D+_|0,W^=D,W=W>>>32-8|W<<8,ge=ge+W|0,_^=ge,_=_>>>32-7|_<<7;Xt.writeUint32LE(D+s|0,n,0),Xt.writeUint32LE(S+a|0,n,4),Xt.writeUint32LE(P+l|0,n,8),Xt.writeUint32LE(m+p|0,n,12),Xt.writeUint32LE(u+d|0,n,16),Xt.writeUint32LE(_+v|0,n,20),Xt.writeUint32LE(G+b|0,n,24),Xt.writeUint32LE(V+I|0,n,28),Xt.writeUint32LE(se+C|0,n,32),Xt.writeUint32LE(ce+$|0,n,36),Xt.writeUint32LE(ge+N|0,n,40),Xt.writeUint32LE(T+H|0,n,44),Xt.writeUint32LE(q+K|0,n,48),Xt.writeUint32LE(le+B|0,n,52),Xt.writeUint32LE(te+oe|0,n,56),Xt.writeUint32LE(W+R|0,n,60)}function Od(n,t,r,s,a){if(a===void 0&&(a=0),n.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(s.length<r.length)throw new Error("ChaCha: destination is shorter than source");var l,p;if(a===0){if(t.length!==8&&t.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");l=new Uint8Array(16),p=l.length-t.length,l.set(t,p)}else{if(t.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");l=t,p=a}for(var d=new Uint8Array(64),v=0;v<r.length;v+=64){Cw(d,l,n);for(var b=v;b<v+64&&b<r.length;b++)s[b]=r[b]^d[b-v];Nw(l,0,p)}return Zc.wipe(d),a===0&&Zc.wipe(l),s}Qo.streamXOR=Od;function Aw(n,t,r,s){return s===void 0&&(s=0),Zc.wipe(r),Od(n,t,r,r,s)}Qo.stream=Aw;function Nw(n,t,r){for(var s=1;r--;)s=s+(n[t]&255)|0,n[t]=s&255,s>>>=8,t++;if(s>0)throw new Error("ChaCha: counter overflow")}var Pd={},Fi={};Object.defineProperty(Fi,"__esModule",{value:!0});function Rw(n,t,r){return~(n-1)&t|n-1&r}Fi.select=Rw;function Tw(n,t){return(n|0)-(t|0)-1>>>31&1}Fi.lessOrEqual=Tw;function Cd(n,t){if(n.length!==t.length)return 0;for(var r=0,s=0;s<n.length;s++)r|=n[s]^t[s];return 1&r-1>>>8}Fi.compare=Cd;function Lw(n,t){return n.length===0||t.length===0?!1:Cd(n,t)!==0}Fi.equal=Lw;(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=Fi,r=Pr;n.DIGEST_LENGTH=16;var s=function(){function p(d){this.digestLength=n.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var v=d[0]|d[1]<<8;this._r[0]=v&8191;var b=d[2]|d[3]<<8;this._r[1]=(v>>>13|b<<3)&8191;var I=d[4]|d[5]<<8;this._r[2]=(b>>>10|I<<6)&7939;var C=d[6]|d[7]<<8;this._r[3]=(I>>>7|C<<9)&8191;var $=d[8]|d[9]<<8;this._r[4]=(C>>>4|$<<12)&255,this._r[5]=$>>>1&8190;var N=d[10]|d[11]<<8;this._r[6]=($>>>14|N<<2)&8191;var H=d[12]|d[13]<<8;this._r[7]=(N>>>11|H<<5)&8065;var K=d[14]|d[15]<<8;this._r[8]=(H>>>8|K<<8)&8191,this._r[9]=K>>>5&127,this._pad[0]=d[16]|d[17]<<8,this._pad[1]=d[18]|d[19]<<8,this._pad[2]=d[20]|d[21]<<8,this._pad[3]=d[22]|d[23]<<8,this._pad[4]=d[24]|d[25]<<8,this._pad[5]=d[26]|d[27]<<8,this._pad[6]=d[28]|d[29]<<8,this._pad[7]=d[30]|d[31]<<8}return p.prototype._blocks=function(d,v,b){for(var I=this._fin?0:2048,C=this._h[0],$=this._h[1],N=this._h[2],H=this._h[3],K=this._h[4],B=this._h[5],oe=this._h[6],R=this._h[7],D=this._h[8],S=this._h[9],P=this._r[0],m=this._r[1],u=this._r[2],_=this._r[3],G=this._r[4],V=this._r[5],se=this._r[6],ce=this._r[7],ge=this._r[8],T=this._r[9];b>=16;){var q=d[v+0]|d[v+1]<<8;C+=q&8191;var le=d[v+2]|d[v+3]<<8;$+=(q>>>13|le<<3)&8191;var te=d[v+4]|d[v+5]<<8;N+=(le>>>10|te<<6)&8191;var W=d[v+6]|d[v+7]<<8;H+=(te>>>7|W<<9)&8191;var ee=d[v+8]|d[v+9]<<8;K+=(W>>>4|ee<<12)&8191,B+=ee>>>1&8191;var Y=d[v+10]|d[v+11]<<8;oe+=(ee>>>14|Y<<2)&8191;var re=d[v+12]|d[v+13]<<8;R+=(Y>>>11|re<<5)&8191;var Oe=d[v+14]|d[v+15]<<8;D+=(re>>>8|Oe<<8)&8191,S+=Oe>>>5|I;var ie=0,we=ie;we+=C*P,we+=$*(5*T),we+=N*(5*ge),we+=H*(5*ce),we+=K*(5*se),ie=we>>>13,we&=8191,we+=B*(5*V),we+=oe*(5*G),we+=R*(5*_),we+=D*(5*u),we+=S*(5*m),ie+=we>>>13,we&=8191;var he=ie;he+=C*m,he+=$*P,he+=N*(5*T),he+=H*(5*ge),he+=K*(5*ce),ie=he>>>13,he&=8191,he+=B*(5*se),he+=oe*(5*V),he+=R*(5*G),he+=D*(5*_),he+=S*(5*u),ie+=he>>>13,he&=8191;var _e=ie;_e+=C*u,_e+=$*m,_e+=N*P,_e+=H*(5*T),_e+=K*(5*ge),ie=_e>>>13,_e&=8191,_e+=B*(5*ce),_e+=oe*(5*se),_e+=R*(5*V),_e+=D*(5*G),_e+=S*(5*_),ie+=_e>>>13,_e&=8191;var j=ie;j+=C*_,j+=$*u,j+=N*m,j+=H*P,j+=K*(5*T),ie=j>>>13,j&=8191,j+=B*(5*ge),j+=oe*(5*ce),j+=R*(5*se),j+=D*(5*V),j+=S*(5*G),ie+=j>>>13,j&=8191;var M=ie;M+=C*G,M+=$*_,M+=N*u,M+=H*m,M+=K*P,ie=M>>>13,M&=8191,M+=B*(5*T),M+=oe*(5*ge),M+=R*(5*ce),M+=D*(5*se),M+=S*(5*V),ie+=M>>>13,M&=8191;var A=ie;A+=C*V,A+=$*G,A+=N*_,A+=H*u,A+=K*m,ie=A>>>13,A&=8191,A+=B*P,A+=oe*(5*T),A+=R*(5*ge),A+=D*(5*ce),A+=S*(5*se),ie+=A>>>13,A&=8191;var h=ie;h+=C*se,h+=$*V,h+=N*G,h+=H*_,h+=K*u,ie=h>>>13,h&=8191,h+=B*m,h+=oe*P,h+=R*(5*T),h+=D*(5*ge),h+=S*(5*ce),ie+=h>>>13,h&=8191;var x=ie;x+=C*ce,x+=$*se,x+=N*V,x+=H*G,x+=K*_,ie=x>>>13,x&=8191,x+=B*u,x+=oe*m,x+=R*P,x+=D*(5*T),x+=S*(5*ge),ie+=x>>>13,x&=8191;var ne=ie;ne+=C*ge,ne+=$*ce,ne+=N*se,ne+=H*V,ne+=K*G,ie=ne>>>13,ne&=8191,ne+=B*_,ne+=oe*u,ne+=R*m,ne+=D*P,ne+=S*(5*T),ie+=ne>>>13,ne&=8191;var fe=ie;fe+=C*T,fe+=$*ge,fe+=N*ce,fe+=H*se,fe+=K*V,ie=fe>>>13,fe&=8191,fe+=B*G,fe+=oe*_,fe+=R*u,fe+=D*m,fe+=S*P,ie+=fe>>>13,fe&=8191,ie=(ie<<2)+ie|0,ie=ie+we|0,we=ie&8191,ie=ie>>>13,he+=ie,C=we,$=he,N=_e,H=j,K=M,B=A,oe=h,R=x,D=ne,S=fe,v+=16,b-=16}this._h[0]=C,this._h[1]=$,this._h[2]=N,this._h[3]=H,this._h[4]=K,this._h[5]=B,this._h[6]=oe,this._h[7]=R,this._h[8]=D,this._h[9]=S},p.prototype.finish=function(d,v){v===void 0&&(v=0);var b=new Uint16Array(10),I,C,$,N;if(this._leftover){for(N=this._leftover,this._buffer[N++]=1;N<16;N++)this._buffer[N]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(I=this._h[1]>>>13,this._h[1]&=8191,N=2;N<10;N++)this._h[N]+=I,I=this._h[N]>>>13,this._h[N]&=8191;for(this._h[0]+=I*5,I=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=I,I=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=I,b[0]=this._h[0]+5,I=b[0]>>>13,b[0]&=8191,N=1;N<10;N++)b[N]=this._h[N]+I,I=b[N]>>>13,b[N]&=8191;for(b[9]-=8192,C=(I^1)-1,N=0;N<10;N++)b[N]&=C;for(C=~C,N=0;N<10;N++)this._h[N]=this._h[N]&C|b[N];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,$=this._h[0]+this._pad[0],this._h[0]=$&65535,N=1;N<8;N++)$=(this._h[N]+this._pad[N]|0)+($>>>16)|0,this._h[N]=$&65535;return d[v+0]=this._h[0]>>>0,d[v+1]=this._h[0]>>>8,d[v+2]=this._h[1]>>>0,d[v+3]=this._h[1]>>>8,d[v+4]=this._h[2]>>>0,d[v+5]=this._h[2]>>>8,d[v+6]=this._h[3]>>>0,d[v+7]=this._h[3]>>>8,d[v+8]=this._h[4]>>>0,d[v+9]=this._h[4]>>>8,d[v+10]=this._h[5]>>>0,d[v+11]=this._h[5]>>>8,d[v+12]=this._h[6]>>>0,d[v+13]=this._h[6]>>>8,d[v+14]=this._h[7]>>>0,d[v+15]=this._h[7]>>>8,this._finished=!0,this},p.prototype.update=function(d){var v=0,b=d.length,I;if(this._leftover){I=16-this._leftover,I>b&&(I=b);for(var C=0;C<I;C++)this._buffer[this._leftover+C]=d[v+C];if(b-=I,v+=I,this._leftover+=I,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(b>=16&&(I=b-b%16,this._blocks(d,v,I),v+=I,b-=I),b){for(var C=0;C<b;C++)this._buffer[this._leftover+C]=d[v+C];this._leftover+=b}return this},p.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var d=new Uint8Array(16);return this.finish(d),d},p.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},p}();n.Poly1305=s;function a(p,d){var v=new s(p);v.update(d);var b=v.digest();return v.clean(),b}n.oneTimeAuth=a;function l(p,d){return p.length!==n.DIGEST_LENGTH||d.length!==n.DIGEST_LENGTH?!1:t.equal(p,d)}n.equal=l})(Pd);(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=Qo,r=Pd,s=Pr,a=$e,l=Fi;n.KEY_LENGTH=32,n.NONCE_LENGTH=12,n.TAG_LENGTH=16;var p=new Uint8Array(16),d=function(){function v(b){if(this.nonceLength=n.NONCE_LENGTH,this.tagLength=n.TAG_LENGTH,b.length!==n.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(b)}return v.prototype.seal=function(b,I,C,$){if(b.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var N=new Uint8Array(16);N.set(b,N.length-b.length);var H=new Uint8Array(32);t.stream(this._key,N,H,4);var K=I.length+this.tagLength,B;if($){if($.length!==K)throw new Error("ChaCha20Poly1305: incorrect destination length");B=$}else B=new Uint8Array(K);return t.streamXOR(this._key,N,I,B,4),this._authenticate(B.subarray(B.length-this.tagLength,B.length),H,B.subarray(0,B.length-this.tagLength),C),s.wipe(N),B},v.prototype.open=function(b,I,C,$){if(b.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(I.length<this.tagLength)return null;var N=new Uint8Array(16);N.set(b,N.length-b.length);var H=new Uint8Array(32);t.stream(this._key,N,H,4);var K=new Uint8Array(this.tagLength);if(this._authenticate(K,H,I.subarray(0,I.length-this.tagLength),C),!l.equal(K,I.subarray(I.length-this.tagLength,I.length)))return null;var B=I.length-this.tagLength,oe;if($){if($.length!==B)throw new Error("ChaCha20Poly1305: incorrect destination length");oe=$}else oe=new Uint8Array(B);return t.streamXOR(this._key,N,I.subarray(0,I.length-this.tagLength),oe,4),s.wipe(N),oe},v.prototype.clean=function(){return s.wipe(this._key),this},v.prototype._authenticate=function(b,I,C,$){var N=new r.Poly1305(I);$&&(N.update($),$.length%16>0&&N.update(p.subarray($.length%16))),N.update(C),C.length%16>0&&N.update(p.subarray(C.length%16));var H=new Uint8Array(8);$&&a.writeUint64LE($.length,H),N.update(H),a.writeUint64LE(C.length,H),N.update(H);for(var K=N.digest(),B=0;B<K.length;B++)b[B]=K[B];N.clean(),s.wipe(K),s.wipe(H)},v}();n.ChaCha20Poly1305=d})(pu);var Ad={},Is={},gu={};Object.defineProperty(gu,"__esModule",{value:!0});function Uw(n){return typeof n.saveState<"u"&&typeof n.restoreState<"u"&&typeof n.cleanSavedState<"u"}gu.isSerializableHash=Uw;Object.defineProperty(Is,"__esModule",{value:!0});var ti=gu,Fw=Fi,$w=Pr,Nd=function(){function n(t,r){this._finished=!1,this._inner=new t,this._outer=new t,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var s=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(s).clean():s.set(r);for(var a=0;a<s.length;a++)s[a]^=54;this._inner.update(s);for(var a=0;a<s.length;a++)s[a]^=106;this._outer.update(s),ti.isSerializableHash(this._inner)&&ti.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),$w.wipe(s)}return n.prototype.reset=function(){if(!ti.isSerializableHash(this._inner)||!ti.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},n.prototype.clean=function(){ti.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),ti.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},n.prototype.update=function(t){return this._inner.update(t),this},n.prototype.finish=function(t){return this._finished?(this._outer.finish(t),this):(this._inner.finish(t),this._outer.update(t.subarray(0,this.digestLength)).finish(t),this._finished=!0,this)},n.prototype.digest=function(){var t=new Uint8Array(this.digestLength);return this.finish(t),t},n.prototype.saveState=function(){if(!ti.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},n.prototype.restoreState=function(t){if(!ti.isSerializableHash(this._inner)||!ti.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(t),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},n.prototype.cleanSavedState=function(t){if(!ti.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(t)},n}();Is.HMAC=Nd;function Dw(n,t,r){var s=new Nd(n,t);s.update(r);var a=s.digest();return s.clean(),a}Is.hmac=Dw;Is.equal=Fw.equal;Object.defineProperty(Ad,"__esModule",{value:!0});var of=Is,af=Pr,Mw=function(){function n(t,r,s,a){s===void 0&&(s=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=t,this._info=a;var l=of.hmac(this._hash,s,r);this._hmac=new of.HMAC(t,l),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return n.prototype._fillBuffer=function(){this._counter[0]++;var t=this._counter[0];if(t===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),t>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},n.prototype.expand=function(t){for(var r=new Uint8Array(t),s=0;s<r.length;s++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[s]=this._buffer[this._bufpos++];return r},n.prototype.clean=function(){this._hmac.clean(),af.wipe(this._buffer),af.wipe(this._counter),this._bufpos=0},n}(),jw=Ad.HKDF=Mw,Xo={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var t=$e,r=Pr;n.DIGEST_LENGTH=32,n.BLOCK_SIZE=64;var s=function(){function d(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return d.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},d.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},d.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},d.prototype.update=function(v,b){if(b===void 0&&(b=v.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var I=0;if(this._bytesHashed+=b,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&b>0;)this._buffer[this._bufferLength++]=v[I++],b--;this._bufferLength===this.blockSize&&(l(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(b>=this.blockSize&&(I=l(this._temp,this._state,v,I,b),b%=this.blockSize);b>0;)this._buffer[this._bufferLength++]=v[I++],b--;return this},d.prototype.finish=function(v){if(!this._finished){var b=this._bytesHashed,I=this._bufferLength,C=b/536870912|0,$=b<<3,N=b%64<56?64:128;this._buffer[I]=128;for(var H=I+1;H<N-8;H++)this._buffer[H]=0;t.writeUint32BE(C,this._buffer,N-8),t.writeUint32BE($,this._buffer,N-4),l(this._temp,this._state,this._buffer,0,N),this._finished=!0}for(var H=0;H<this.digestLength/4;H++)t.writeUint32BE(this._state[H],v,H*4);return this},d.prototype.digest=function(){var v=new Uint8Array(this.digestLength);return this.finish(v),v},d.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},d.prototype.restoreState=function(v){return this._state.set(v.state),this._bufferLength=v.bufferLength,v.buffer&&this._buffer.set(v.buffer),this._bytesHashed=v.bytesHashed,this._finished=!1,this},d.prototype.cleanSavedState=function(v){r.wipe(v.state),v.buffer&&r.wipe(v.buffer),v.bufferLength=0,v.bytesHashed=0},d}();n.SHA256=s;var a=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function l(d,v,b,I,C){for(;C>=64;){for(var $=v[0],N=v[1],H=v[2],K=v[3],B=v[4],oe=v[5],R=v[6],D=v[7],S=0;S<16;S++){var P=I+S*4;d[S]=t.readUint32BE(b,P)}for(var S=16;S<64;S++){var m=d[S-2],u=(m>>>17|m<<32-17)^(m>>>19|m<<32-19)^m>>>10;m=d[S-15];var _=(m>>>7|m<<32-7)^(m>>>18|m<<32-18)^m>>>3;d[S]=(u+d[S-7]|0)+(_+d[S-16]|0)}for(var S=0;S<64;S++){var u=(((B>>>6|B<<26)^(B>>>11|B<<21)^(B>>>25|B<<7))+(B&oe^~B&R)|0)+(D+(a[S]+d[S]|0)|0)|0,_=(($>>>2|$<<32-2)^($>>>13|$<<32-13)^($>>>22|$<<32-22))+($&N^$&H^N&H)|0;D=R,R=oe,oe=B,B=K+u|0,K=H,H=N,N=$,$=u+_|0}v[0]+=$,v[1]+=N,v[2]+=H,v[3]+=K,v[4]+=B,v[5]+=oe,v[6]+=R,v[7]+=D,I+=64,C-=64}return I}function p(d){var v=new s;v.update(d);var b=v.digest();return v.clean(),b}n.hash=p})(Xo);var vu={};(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.sharedKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.scalarMultBase=n.scalarMult=n.SHARED_KEY_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=void 0;const t=Fn,r=Pr;n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=32,n.SHARED_KEY_LENGTH=32;function s(S){const P=new Float64Array(16);if(S)for(let m=0;m<S.length;m++)P[m]=S[m];return P}const a=new Uint8Array(32);a[0]=9;const l=s([56129,1]);function p(S){let P=1;for(let m=0;m<16;m++){let u=S[m]+P+65535;P=Math.floor(u/65536),S[m]=u-P*65536}S[0]+=P-1+37*(P-1)}function d(S,P,m){const u=~(m-1);for(let _=0;_<16;_++){const G=u&(S[_]^P[_]);S[_]^=G,P[_]^=G}}function v(S,P){const m=s(),u=s();for(let _=0;_<16;_++)u[_]=P[_];p(u),p(u),p(u);for(let _=0;_<2;_++){m[0]=u[0]-65517;for(let V=1;V<15;V++)m[V]=u[V]-65535-(m[V-1]>>16&1),m[V-1]&=65535;m[15]=u[15]-32767-(m[14]>>16&1);const G=m[15]>>16&1;m[14]&=65535,d(u,m,1-G)}for(let _=0;_<16;_++)S[2*_]=u[_]&255,S[2*_+1]=u[_]>>8}function b(S,P){for(let m=0;m<16;m++)S[m]=P[2*m]+(P[2*m+1]<<8);S[15]&=32767}function I(S,P,m){for(let u=0;u<16;u++)S[u]=P[u]+m[u]}function C(S,P,m){for(let u=0;u<16;u++)S[u]=P[u]-m[u]}function $(S,P,m){let u,_,G=0,V=0,se=0,ce=0,ge=0,T=0,q=0,le=0,te=0,W=0,ee=0,Y=0,re=0,Oe=0,ie=0,we=0,he=0,_e=0,j=0,M=0,A=0,h=0,x=0,ne=0,fe=0,Se=0,ze=0,ke=0,De=0,pt=0,gt=0,je=m[0],xe=m[1],Le=m[2],Ue=m[3],qe=m[4],Ce=m[5],Fe=m[6],Ie=m[7],Ae=m[8],Ke=m[9],Pe=m[10],Ve=m[11],We=m[12],et=m[13],tt=m[14],Je=m[15];u=P[0],G+=u*je,V+=u*xe,se+=u*Le,ce+=u*Ue,ge+=u*qe,T+=u*Ce,q+=u*Fe,le+=u*Ie,te+=u*Ae,W+=u*Ke,ee+=u*Pe,Y+=u*Ve,re+=u*We,Oe+=u*et,ie+=u*tt,we+=u*Je,u=P[1],V+=u*je,se+=u*xe,ce+=u*Le,ge+=u*Ue,T+=u*qe,q+=u*Ce,le+=u*Fe,te+=u*Ie,W+=u*Ae,ee+=u*Ke,Y+=u*Pe,re+=u*Ve,Oe+=u*We,ie+=u*et,we+=u*tt,he+=u*Je,u=P[2],se+=u*je,ce+=u*xe,ge+=u*Le,T+=u*Ue,q+=u*qe,le+=u*Ce,te+=u*Fe,W+=u*Ie,ee+=u*Ae,Y+=u*Ke,re+=u*Pe,Oe+=u*Ve,ie+=u*We,we+=u*et,he+=u*tt,_e+=u*Je,u=P[3],ce+=u*je,ge+=u*xe,T+=u*Le,q+=u*Ue,le+=u*qe,te+=u*Ce,W+=u*Fe,ee+=u*Ie,Y+=u*Ae,re+=u*Ke,Oe+=u*Pe,ie+=u*Ve,we+=u*We,he+=u*et,_e+=u*tt,j+=u*Je,u=P[4],ge+=u*je,T+=u*xe,q+=u*Le,le+=u*Ue,te+=u*qe,W+=u*Ce,ee+=u*Fe,Y+=u*Ie,re+=u*Ae,Oe+=u*Ke,ie+=u*Pe,we+=u*Ve,he+=u*We,_e+=u*et,j+=u*tt,M+=u*Je,u=P[5],T+=u*je,q+=u*xe,le+=u*Le,te+=u*Ue,W+=u*qe,ee+=u*Ce,Y+=u*Fe,re+=u*Ie,Oe+=u*Ae,ie+=u*Ke,we+=u*Pe,he+=u*Ve,_e+=u*We,j+=u*et,M+=u*tt,A+=u*Je,u=P[6],q+=u*je,le+=u*xe,te+=u*Le,W+=u*Ue,ee+=u*qe,Y+=u*Ce,re+=u*Fe,Oe+=u*Ie,ie+=u*Ae,we+=u*Ke,he+=u*Pe,_e+=u*Ve,j+=u*We,M+=u*et,A+=u*tt,h+=u*Je,u=P[7],le+=u*je,te+=u*xe,W+=u*Le,ee+=u*Ue,Y+=u*qe,re+=u*Ce,Oe+=u*Fe,ie+=u*Ie,we+=u*Ae,he+=u*Ke,_e+=u*Pe,j+=u*Ve,M+=u*We,A+=u*et,h+=u*tt,x+=u*Je,u=P[8],te+=u*je,W+=u*xe,ee+=u*Le,Y+=u*Ue,re+=u*qe,Oe+=u*Ce,ie+=u*Fe,we+=u*Ie,he+=u*Ae,_e+=u*Ke,j+=u*Pe,M+=u*Ve,A+=u*We,h+=u*et,x+=u*tt,ne+=u*Je,u=P[9],W+=u*je,ee+=u*xe,Y+=u*Le,re+=u*Ue,Oe+=u*qe,ie+=u*Ce,we+=u*Fe,he+=u*Ie,_e+=u*Ae,j+=u*Ke,M+=u*Pe,A+=u*Ve,h+=u*We,x+=u*et,ne+=u*tt,fe+=u*Je,u=P[10],ee+=u*je,Y+=u*xe,re+=u*Le,Oe+=u*Ue,ie+=u*qe,we+=u*Ce,he+=u*Fe,_e+=u*Ie,j+=u*Ae,M+=u*Ke,A+=u*Pe,h+=u*Ve,x+=u*We,ne+=u*et,fe+=u*tt,Se+=u*Je,u=P[11],Y+=u*je,re+=u*xe,Oe+=u*Le,ie+=u*Ue,we+=u*qe,he+=u*Ce,_e+=u*Fe,j+=u*Ie,M+=u*Ae,A+=u*Ke,h+=u*Pe,x+=u*Ve,ne+=u*We,fe+=u*et,Se+=u*tt,ze+=u*Je,u=P[12],re+=u*je,Oe+=u*xe,ie+=u*Le,we+=u*Ue,he+=u*qe,_e+=u*Ce,j+=u*Fe,M+=u*Ie,A+=u*Ae,h+=u*Ke,x+=u*Pe,ne+=u*Ve,fe+=u*We,Se+=u*et,ze+=u*tt,ke+=u*Je,u=P[13],Oe+=u*je,ie+=u*xe,we+=u*Le,he+=u*Ue,_e+=u*qe,j+=u*Ce,M+=u*Fe,A+=u*Ie,h+=u*Ae,x+=u*Ke,ne+=u*Pe,fe+=u*Ve,Se+=u*We,ze+=u*et,ke+=u*tt,De+=u*Je,u=P[14],ie+=u*je,we+=u*xe,he+=u*Le,_e+=u*Ue,j+=u*qe,M+=u*Ce,A+=u*Fe,h+=u*Ie,x+=u*Ae,ne+=u*Ke,fe+=u*Pe,Se+=u*Ve,ze+=u*We,ke+=u*et,De+=u*tt,pt+=u*Je,u=P[15],we+=u*je,he+=u*xe,_e+=u*Le,j+=u*Ue,M+=u*qe,A+=u*Ce,h+=u*Fe,x+=u*Ie,ne+=u*Ae,fe+=u*Ke,Se+=u*Pe,ze+=u*Ve,ke+=u*We,De+=u*et,pt+=u*tt,gt+=u*Je,G+=38*he,V+=38*_e,se+=38*j,ce+=38*M,ge+=38*A,T+=38*h,q+=38*x,le+=38*ne,te+=38*fe,W+=38*Se,ee+=38*ze,Y+=38*ke,re+=38*De,Oe+=38*pt,ie+=38*gt,_=1,u=G+_+65535,_=Math.floor(u/65536),G=u-_*65536,u=V+_+65535,_=Math.floor(u/65536),V=u-_*65536,u=se+_+65535,_=Math.floor(u/65536),se=u-_*65536,u=ce+_+65535,_=Math.floor(u/65536),ce=u-_*65536,u=ge+_+65535,_=Math.floor(u/65536),ge=u-_*65536,u=T+_+65535,_=Math.floor(u/65536),T=u-_*65536,u=q+_+65535,_=Math.floor(u/65536),q=u-_*65536,u=le+_+65535,_=Math.floor(u/65536),le=u-_*65536,u=te+_+65535,_=Math.floor(u/65536),te=u-_*65536,u=W+_+65535,_=Math.floor(u/65536),W=u-_*65536,u=ee+_+65535,_=Math.floor(u/65536),ee=u-_*65536,u=Y+_+65535,_=Math.floor(u/65536),Y=u-_*65536,u=re+_+65535,_=Math.floor(u/65536),re=u-_*65536,u=Oe+_+65535,_=Math.floor(u/65536),Oe=u-_*65536,u=ie+_+65535,_=Math.floor(u/65536),ie=u-_*65536,u=we+_+65535,_=Math.floor(u/65536),we=u-_*65536,G+=_-1+37*(_-1),_=1,u=G+_+65535,_=Math.floor(u/65536),G=u-_*65536,u=V+_+65535,_=Math.floor(u/65536),V=u-_*65536,u=se+_+65535,_=Math.floor(u/65536),se=u-_*65536,u=ce+_+65535,_=Math.floor(u/65536),ce=u-_*65536,u=ge+_+65535,_=Math.floor(u/65536),ge=u-_*65536,u=T+_+65535,_=Math.floor(u/65536),T=u-_*65536,u=q+_+65535,_=Math.floor(u/65536),q=u-_*65536,u=le+_+65535,_=Math.floor(u/65536),le=u-_*65536,u=te+_+65535,_=Math.floor(u/65536),te=u-_*65536,u=W+_+65535,_=Math.floor(u/65536),W=u-_*65536,u=ee+_+65535,_=Math.floor(u/65536),ee=u-_*65536,u=Y+_+65535,_=Math.floor(u/65536),Y=u-_*65536,u=re+_+65535,_=Math.floor(u/65536),re=u-_*65536,u=Oe+_+65535,_=Math.floor(u/65536),Oe=u-_*65536,u=ie+_+65535,_=Math.floor(u/65536),ie=u-_*65536,u=we+_+65535,_=Math.floor(u/65536),we=u-_*65536,G+=_-1+37*(_-1),S[0]=G,S[1]=V,S[2]=se,S[3]=ce,S[4]=ge,S[5]=T,S[6]=q,S[7]=le,S[8]=te,S[9]=W,S[10]=ee,S[11]=Y,S[12]=re,S[13]=Oe,S[14]=ie,S[15]=we}function N(S,P){$(S,P,P)}function H(S,P){const m=s();for(let u=0;u<16;u++)m[u]=P[u];for(let u=253;u>=0;u--)N(m,m),u!==2&&u!==4&&$(m,m,P);for(let u=0;u<16;u++)S[u]=m[u]}function K(S,P){const m=new Uint8Array(32),u=new Float64Array(80),_=s(),G=s(),V=s(),se=s(),ce=s(),ge=s();for(let te=0;te<31;te++)m[te]=S[te];m[31]=S[31]&127|64,m[0]&=248,b(u,P);for(let te=0;te<16;te++)G[te]=u[te];_[0]=se[0]=1;for(let te=254;te>=0;--te){const W=m[te>>>3]>>>(te&7)&1;d(_,G,W),d(V,se,W),I(ce,_,V),C(_,_,V),I(V,G,se),C(G,G,se),N(se,ce),N(ge,_),$(_,V,_),$(V,G,ce),I(ce,_,V),C(_,_,V),N(G,_),C(V,se,ge),$(_,V,l),I(_,_,se),$(V,V,_),$(_,se,ge),$(se,G,u),N(G,ce),d(_,G,W),d(V,se,W)}for(let te=0;te<16;te++)u[te+16]=_[te],u[te+32]=V[te],u[te+48]=G[te],u[te+64]=se[te];const T=u.subarray(32),q=u.subarray(16);H(T,T),$(q,q,T);const le=new Uint8Array(32);return v(le,q),le}n.scalarMult=K;function B(S){return K(S,a)}n.scalarMultBase=B;function oe(S){if(S.length!==n.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${n.SECRET_KEY_LENGTH} bytes`);const P=new Uint8Array(S);return{publicKey:B(P),secretKey:P}}n.generateKeyPairFromSeed=oe;function R(S){const P=(0,t.randomBytes)(32,S),m=oe(P);return(0,r.wipe)(P),m}n.generateKeyPair=R;function D(S,P,m=!1){if(S.length!==n.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(P.length!==n.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const u=K(S,P);if(m){let _=0;for(let G=0;G<u.length;G++)_|=u[G];if(_===0)throw new Error("X25519: invalid shared key")}return u}n.sharedKey=D})(vu);var lt={};Object.defineProperty(lt,"__esModule",{value:!0});lt.getLocalStorage=lt.getLocalStorageOrThrow=lt.getCrypto=lt.getCryptoOrThrow=Td=lt.getLocation=lt.getLocationOrThrow=yu=lt.getNavigator=lt.getNavigatorOrThrow=Rd=lt.getDocument=lt.getDocumentOrThrow=lt.getFromWindowOrThrow=lt.getFromWindow=void 0;function sn(n){let t;return typeof window<"u"&&typeof window[n]<"u"&&(t=window[n]),t}lt.getFromWindow=sn;function $n(n){const t=sn(n);if(!t)throw new Error(`${n} is not defined in Window`);return t}lt.getFromWindowOrThrow=$n;function qw(){return $n("document")}lt.getDocumentOrThrow=qw;function Hw(){return sn("document")}var Rd=lt.getDocument=Hw;function zw(){return $n("navigator")}lt.getNavigatorOrThrow=zw;function Kw(){return sn("navigator")}var yu=lt.getNavigator=Kw;function Bw(){return $n("location")}lt.getLocationOrThrow=Bw;function kw(){return sn("location")}var Td=lt.getLocation=kw;function Vw(){return $n("crypto")}lt.getCryptoOrThrow=Vw;function Gw(){return sn("crypto")}lt.getCrypto=Gw;function Ww(){return $n("localStorage")}lt.getLocalStorageOrThrow=Ww;function Yw(){return sn("localStorage")}lt.getLocalStorage=Yw;var _u={};Object.defineProperty(_u,"__esModule",{value:!0});var Ld=_u.getWindowMetadata=void 0;const cf=lt;function Jw(){let n,t;try{n=cf.getDocumentOrThrow(),t=cf.getLocationOrThrow()}catch{return null}function r(){const C=n.getElementsByTagName("link"),$=[];for(let N=0;N<C.length;N++){const H=C[N],K=H.getAttribute("rel");if(K&&K.toLowerCase().indexOf("icon")>-1){const B=H.getAttribute("href");if(B)if(B.toLowerCase().indexOf("https:")===-1&&B.toLowerCase().indexOf("http:")===-1&&B.indexOf("//")!==0){let oe=t.protocol+"//"+t.host;if(B.indexOf("/")===0)oe+=B;else{const R=t.pathname.split("/");R.pop();const D=R.join("/");oe+=D+"/"+B}$.push(oe)}else if(B.indexOf("//")===0){const oe=t.protocol+B;$.push(oe)}else $.push(B)}}return $}function s(...C){const $=n.getElementsByTagName("meta");for(let N=0;N<$.length;N++){const H=$[N],K=["itemprop","property","name"].map(B=>H.getAttribute(B)).filter(B=>B?C.includes(B):!1);if(K.length&&K){const B=H.getAttribute("content");if(B)return B}}return""}function a(){let C=s("name","og:site_name","og:title","twitter:title");return C||(C=n.title),C}function l(){return s("description","og:description","twitter:description","keywords")}const p=a(),d=l(),v=t.origin,b=r();return{description:d,url:v,icons:b,name:p}}Ld=_u.getWindowMetadata=Jw;var ms={},Qw=n=>encodeURIComponent(n).replace(/[!'()*]/g,t=>`%${t.charCodeAt(0).toString(16).toUpperCase()}`),Ud="%[a-f0-9]{2}",uf=new RegExp("("+Ud+")|([^%]+?)","gi"),hf=new RegExp("("+Ud+")+","gi");function eu(n,t){try{return[decodeURIComponent(n.join(""))]}catch{}if(n.length===1)return n;t=t||1;var r=n.slice(0,t),s=n.slice(t);return Array.prototype.concat.call([],eu(r),eu(s))}function Xw(n){try{return decodeURIComponent(n)}catch{for(var t=n.match(uf)||[],r=1;r<t.length;r++)n=eu(t,r).join(""),t=n.match(uf)||[];return n}}function Zw(n){for(var t={"%FE%FF":"","%FF%FE":""},r=hf.exec(n);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch{var s=Xw(r[0]);s!==r[0]&&(t[r[0]]=s)}r=hf.exec(n)}t["%C2"]="";for(var a=Object.keys(t),l=0;l<a.length;l++){var p=a[l];n=n.replace(new RegExp(p,"g"),t[p])}return n}var eb=function(n){if(typeof n!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof n+"`");try{return n=n.replace(/\+/g," "),decodeURIComponent(n)}catch{return Zw(n)}},tb=(n,t)=>{if(!(typeof n=="string"&&typeof t=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(t==="")return[n];const r=n.indexOf(t);return r===-1?[n]:[n.slice(0,r),n.slice(r+t.length)]},rb=function(n,t){for(var r={},s=Object.keys(n),a=Array.isArray(t),l=0;l<s.length;l++){var p=s[l],d=n[p];(a?t.indexOf(p)!==-1:t(p,d,n))&&(r[p]=d)}return r};(function(n){const t=Qw,r=eb,s=tb,a=rb,l=R=>R==null,p=Symbol("encodeFragmentIdentifier");function d(R){switch(R.arrayFormat){case"index":return D=>(S,P)=>{const m=S.length;return P===void 0||R.skipNull&&P===null||R.skipEmptyString&&P===""?S:P===null?[...S,[I(D,R),"[",m,"]"].join("")]:[...S,[I(D,R),"[",I(m,R),"]=",I(P,R)].join("")]};case"bracket":return D=>(S,P)=>P===void 0||R.skipNull&&P===null||R.skipEmptyString&&P===""?S:P===null?[...S,[I(D,R),"[]"].join("")]:[...S,[I(D,R),"[]=",I(P,R)].join("")];case"colon-list-separator":return D=>(S,P)=>P===void 0||R.skipNull&&P===null||R.skipEmptyString&&P===""?S:P===null?[...S,[I(D,R),":list="].join("")]:[...S,[I(D,R),":list=",I(P,R)].join("")];case"comma":case"separator":case"bracket-separator":{const D=R.arrayFormat==="bracket-separator"?"[]=":"=";return S=>(P,m)=>m===void 0||R.skipNull&&m===null||R.skipEmptyString&&m===""?P:(m=m===null?"":m,P.length===0?[[I(S,R),D,I(m,R)].join("")]:[[P,I(m,R)].join(R.arrayFormatSeparator)])}default:return D=>(S,P)=>P===void 0||R.skipNull&&P===null||R.skipEmptyString&&P===""?S:P===null?[...S,I(D,R)]:[...S,[I(D,R),"=",I(P,R)].join("")]}}function v(R){let D;switch(R.arrayFormat){case"index":return(S,P,m)=>{if(D=/\[(\d*)\]$/.exec(S),S=S.replace(/\[\d*\]$/,""),!D){m[S]=P;return}m[S]===void 0&&(m[S]={}),m[S][D[1]]=P};case"bracket":return(S,P,m)=>{if(D=/(\[\])$/.exec(S),S=S.replace(/\[\]$/,""),!D){m[S]=P;return}if(m[S]===void 0){m[S]=[P];return}m[S]=[].concat(m[S],P)};case"colon-list-separator":return(S,P,m)=>{if(D=/(:list)$/.exec(S),S=S.replace(/:list$/,""),!D){m[S]=P;return}if(m[S]===void 0){m[S]=[P];return}m[S]=[].concat(m[S],P)};case"comma":case"separator":return(S,P,m)=>{const u=typeof P=="string"&&P.includes(R.arrayFormatSeparator),_=typeof P=="string"&&!u&&C(P,R).includes(R.arrayFormatSeparator);P=_?C(P,R):P;const G=u||_?P.split(R.arrayFormatSeparator).map(V=>C(V,R)):P===null?P:C(P,R);m[S]=G};case"bracket-separator":return(S,P,m)=>{const u=/(\[\])$/.test(S);if(S=S.replace(/\[\]$/,""),!u){m[S]=P&&C(P,R);return}const _=P===null?[]:P.split(R.arrayFormatSeparator).map(G=>C(G,R));if(m[S]===void 0){m[S]=_;return}m[S]=[].concat(m[S],_)};default:return(S,P,m)=>{if(m[S]===void 0){m[S]=P;return}m[S]=[].concat(m[S],P)}}}function b(R){if(typeof R!="string"||R.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function I(R,D){return D.encode?D.strict?t(R):encodeURIComponent(R):R}function C(R,D){return D.decode?r(R):R}function $(R){return Array.isArray(R)?R.sort():typeof R=="object"?$(Object.keys(R)).sort((D,S)=>Number(D)-Number(S)).map(D=>R[D]):R}function N(R){const D=R.indexOf("#");return D!==-1&&(R=R.slice(0,D)),R}function H(R){let D="";const S=R.indexOf("#");return S!==-1&&(D=R.slice(S)),D}function K(R){R=N(R);const D=R.indexOf("?");return D===-1?"":R.slice(D+1)}function B(R,D){return D.parseNumbers&&!Number.isNaN(Number(R))&&typeof R=="string"&&R.trim()!==""?R=Number(R):D.parseBooleans&&R!==null&&(R.toLowerCase()==="true"||R.toLowerCase()==="false")&&(R=R.toLowerCase()==="true"),R}function oe(R,D){D=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},D),b(D.arrayFormatSeparator);const S=v(D),P=Object.create(null);if(typeof R!="string"||(R=R.trim().replace(/^[?#&]/,""),!R))return P;for(const m of R.split("&")){if(m==="")continue;let[u,_]=s(D.decode?m.replace(/\+/g," "):m,"=");_=_===void 0?null:["comma","separator","bracket-separator"].includes(D.arrayFormat)?_:C(_,D),S(C(u,D),_,P)}for(const m of Object.keys(P)){const u=P[m];if(typeof u=="object"&&u!==null)for(const _ of Object.keys(u))u[_]=B(u[_],D);else P[m]=B(u,D)}return D.sort===!1?P:(D.sort===!0?Object.keys(P).sort():Object.keys(P).sort(D.sort)).reduce((m,u)=>{const _=P[u];return _&&typeof _=="object"&&!Array.isArray(_)?m[u]=$(_):m[u]=_,m},Object.create(null))}n.extract=K,n.parse=oe,n.stringify=(R,D)=>{if(!R)return"";D=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},D),b(D.arrayFormatSeparator);const S=_=>D.skipNull&&l(R[_])||D.skipEmptyString&&R[_]==="",P=d(D),m={};for(const _ of Object.keys(R))S(_)||(m[_]=R[_]);const u=Object.keys(m);return D.sort!==!1&&u.sort(D.sort),u.map(_=>{const G=R[_];return G===void 0?"":G===null?I(_,D):Array.isArray(G)?G.length===0&&D.arrayFormat==="bracket-separator"?I(_,D)+"[]":G.reduce(P(_),[]).join("&"):I(_,D)+"="+I(G,D)}).filter(_=>_.length>0).join("&")},n.parseUrl=(R,D)=>{D=Object.assign({decode:!0},D);const[S,P]=s(R,"#");return Object.assign({url:S.split("?")[0]||"",query:oe(K(R),D)},D&&D.parseFragmentIdentifier&&P?{fragmentIdentifier:C(P,D)}:{})},n.stringifyUrl=(R,D)=>{D=Object.assign({encode:!0,strict:!0,[p]:!0},D);const S=N(R.url).split("?")[0]||"",P=n.extract(R.url),m=n.parse(P,{sort:!1}),u=Object.assign(m,R.query);let _=n.stringify(u,D);_&&(_=`?${_}`);let G=H(R.url);return R.fragmentIdentifier&&(G=`#${D[p]?I(R.fragmentIdentifier,D):R.fragmentIdentifier}`),`${S}${_}${G}`},n.pick=(R,D,S)=>{S=Object.assign({parseFragmentIdentifier:!0,[p]:!1},S);const{url:P,query:m,fragmentIdentifier:u}=n.parseUrl(R,S);return n.stringifyUrl({url:P,query:a(m,D),fragmentIdentifier:u},S)},n.exclude=(R,D,S)=>{const P=Array.isArray(D)?m=>!D.includes(m):(m,u)=>!D(m,u);return n.pick(R,P,S)}})(ms);const ib={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function nb(n,t=[]){const r=[];return Object.keys(n).forEach(s=>{if(t.length&&!t.includes(s))return;const a=n[s];r.push(...a.accounts)}),r}function Fd(n,t){return n.includes(":")?[n]:t.chains||[]}const $d="base10",cr="base16",tu="base64pad",mu="utf8",Dd=0,on=1,sb=0,lf=1,ru=12,wu=32;function ob(){const n=vu.generateKeyPair();return{privateKey:ur(n.secretKey,cr),publicKey:ur(n.publicKey,cr)}}function iu(){const n=Fn.randomBytes(wu);return ur(n,cr)}function ab(n,t){const r=vu.sharedKey(_r(n,cr),_r(t,cr)),s=new jw(Xo.SHA256,r).expand(wu);return ur(s,cr)}function cb(n){const t=Xo.hash(_r(n,cr));return ur(t,cr)}function Tn(n){const t=Xo.hash(_r(n,mu));return ur(t,cr)}function ub(n){return _r(`${n}`,$d)}function Ss(n){return Number(ur(n,$d))}function hb(n){const t=ub(typeof n.type<"u"?n.type:Dd);if(Ss(t)===on&&typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof n.senderPublicKey<"u"?_r(n.senderPublicKey,cr):void 0,s=typeof n.iv<"u"?_r(n.iv,cr):Fn.randomBytes(ru),a=new pu.ChaCha20Poly1305(_r(n.symKey,cr)).seal(s,_r(n.message,mu));return fb({type:t,sealed:a,iv:s,senderPublicKey:r})}function lb(n){const t=new pu.ChaCha20Poly1305(_r(n.symKey,cr)),{sealed:r,iv:s}=Ko(n.encoded),a=t.open(s,r);if(a===null)throw new Error("Failed to decrypt");return ur(a,mu)}function fb(n){if(Ss(n.type)===on){if(typeof n.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ur(Wc([n.type,n.senderPublicKey,n.iv,n.sealed]),tu)}return ur(Wc([n.type,n.iv,n.sealed]),tu)}function Ko(n){const t=_r(n,tu),r=t.slice(sb,lf),s=lf;if(Ss(r)===on){const d=s+wu,v=d+ru,b=t.slice(s,d),I=t.slice(d,v),C=t.slice(v);return{type:r,sealed:C,iv:I,senderPublicKey:b}}const a=s+ru,l=t.slice(s,a),p=t.slice(a);return{type:r,sealed:p,iv:l}}function db(n,t){const r=Ko(n);return Md({type:Ss(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ur(r.senderPublicKey,cr):void 0,receiverPublicKey:t==null?void 0:t.receiverPublicKey})}function Md(n){const t=(n==null?void 0:n.type)||Dd;if(t===on){if(typeof(n==null?void 0:n.senderPublicKey)>"u")throw new Error("missing sender public key");if(typeof(n==null?void 0:n.receiverPublicKey)>"u")throw new Error("missing receiver public key")}return{type:t,senderPublicKey:n==null?void 0:n.senderPublicKey,receiverPublicKey:n==null?void 0:n.receiverPublicKey}}function ff(n){return n.type===on&&typeof n.senderPublicKey=="string"&&typeof n.receiverPublicKey=="string"}var pb=Object.defineProperty,df=Object.getOwnPropertySymbols,gb=Object.prototype.hasOwnProperty,vb=Object.prototype.propertyIsEnumerable,pf=(n,t,r)=>t in n?pb(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,gf=(n,t)=>{for(var r in t||(t={}))gb.call(t,r)&&pf(n,r,t[r]);if(df)for(var r of df(t))vb.call(t,r)&&pf(n,r,t[r]);return n};const yb="ReactNative",Or={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},_b="js";function bu(){return typeof Rn<"u"&&typeof Rn.versions<"u"&&typeof Rn.versions.node<"u"}function Zo(){return!Rd()&&!!yu()&&navigator.product===yb}function xs(){return!bu()&&!!yu()}function Os(){return Zo()?Or.reactNative:bu()?Or.node:xs()?Or.browser:Or.unknown}function mb(n,t){let r=ms.parse(n);return r=gf(gf({},r),t),n=ms.stringify(r),n}function wb(){return Ld()||{name:"",description:"",url:"",icons:[""]}}function bb(){if(Os()===Or.reactNative&&typeof bt<"u"&&typeof(bt==null?void 0:bt.Platform)<"u"){const{OS:r,Version:s}=bt.Platform;return[r,s].join("-")}const n=Q_();if(n===null)return"unknown";const t=n.os?n.os.replace(" ","").toLowerCase():"unknown";return n.type==="browser"?[t,n.name,n.version].join("-"):[t,n.version].join("-")}function Eb(){var n;const t=Os();return t===Or.browser?[t,((n=Td())==null?void 0:n.host)||"unknown"].join(":"):t}function Ib(n,t,r){const s=bb(),a=Eb();return[[n,t].join("-"),[_b,r].join("-"),s,a].join("/")}function Sb({protocol:n,version:t,relayUrl:r,sdkVersion:s,auth:a,projectId:l,useOnCloseEvent:p}){const d=r.split("?"),v=Ib(n,t,s),b={auth:a,ua:v,projectId:l,useOnCloseEvent:p||void 0},I=mb(d[1]||"",b);return d[0]+"?"+I}function rn(n,t){return n.filter(r=>t.includes(r)).length===n.length}function jd(n){return Object.fromEntries(n.entries())}function qd(n){return new Map(Object.entries(n))}function Nn(n=ye.FIVE_MINUTES,t){const r=ye.toMiliseconds(n||ye.FIVE_MINUTES);let s,a,l;return{resolve:p=>{l&&s&&(clearTimeout(l),s(p))},reject:p=>{l&&a&&(clearTimeout(l),a(p))},done:()=>new Promise((p,d)=>{l=setTimeout(()=>{d(new Error(t))},r),s=p,a=d})}}function ws(n,t,r){return new Promise(async(s,a)=>{const l=setTimeout(()=>a(new Error(r)),t);try{const p=await n;s(p)}catch(p){a(p)}clearTimeout(l)})}function Hd(n,t){if(typeof t=="string"&&t.startsWith(`${n}:`))return t;if(n.toLowerCase()==="topic"){if(typeof t!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${t}`}else if(n.toLowerCase()==="id"){if(typeof t!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${t}`}throw new Error(`Unknown expirer target type: ${n}`)}function xb(n){return Hd("topic",n)}function Ob(n){return Hd("id",n)}function zd(n){const[t,r]=n.split(":"),s={id:void 0,topic:void 0};if(t==="topic"&&typeof r=="string")s.topic=r;else if(t==="id"&&Number.isInteger(Number(r)))s.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${t}:${r}`);return s}function Gr(n,t){return ye.fromMiliseconds((t||Date.now())+ye.toMiliseconds(n))}function Li(n){return Date.now()>=ye.toMiliseconds(n)}function zt(n,t){return`${n}${t?`:${t}`:""}`}function Dc(n=[],t=[]){return[...new Set([...n,...t])]}async function Pb({id:n,topic:t,wcDeepLink:r}){try{if(!r)return;const s=typeof r=="string"?JSON.parse(r):r;let a=s==null?void 0:s.href;if(typeof a!="string")return;a.endsWith("/")&&(a=a.slice(0,-1));const l=`${a}/wc?requestId=${n}&sessionTopic=${t}`,p=Os();p===Or.browser?l.startsWith("https://")?window.open(l,"_blank","noreferrer noopener"):window.open(l,"_self","noreferrer noopener"):p===Or.reactNative&&typeof(bt==null?void 0:bt.Linking)<"u"&&await bt.Linking.openURL(l)}catch(s){console.error(s)}}const Cb="irn";function nu(n){return(n==null?void 0:n.relay)||{protocol:Cb}}function Do(n){const t=ib[n];if(typeof t>"u")throw new Error(`Relay Protocol not supported: ${n}`);return t}var Ab=Object.defineProperty,vf=Object.getOwnPropertySymbols,Nb=Object.prototype.hasOwnProperty,Rb=Object.prototype.propertyIsEnumerable,yf=(n,t,r)=>t in n?Ab(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Tb=(n,t)=>{for(var r in t||(t={}))Nb.call(t,r)&&yf(n,r,t[r]);if(vf)for(var r of vf(t))Rb.call(t,r)&&yf(n,r,t[r]);return n};function Lb(n,t="-"){const r={},s="relay"+t;return Object.keys(n).forEach(a=>{if(a.startsWith(s)){const l=a.replace(s,""),p=n[a];r[l]=p}}),r}function Ub(n){const t=n.indexOf(":"),r=n.indexOf("?")!==-1?n.indexOf("?"):void 0,s=n.substring(0,t),a=n.substring(t+1,r).split("@"),l=typeof r<"u"?n.substring(r):"",p=ms.parse(l);return{protocol:s,topic:Fb(a[0]),version:parseInt(a[1],10),symKey:p.symKey,relay:Lb(p)}}function Fb(n){return n.startsWith("//")?n.substring(2):n}function $b(n,t="-"){const r="relay",s={};return Object.keys(n).forEach(a=>{const l=r+t+a;n[a]&&(s[l]=n[a])}),s}function Db(n){return`${n.protocol}:${n.topic}@${n.version}?`+ms.stringify(Tb({symKey:n.symKey},$b(n.relay)))}function Dn(n){const t=[];return n.forEach(r=>{const[s,a]=r.split(":");t.push(`${s}:${a}`)}),t}function Mb(n){const t=[];return Object.values(n).forEach(r=>{t.push(...Dn(r.accounts))}),t}function jb(n,t){const r=[];return Object.values(n).forEach(s=>{Dn(s.accounts).includes(t)&&r.push(...s.methods)}),r}function qb(n,t){const r=[];return Object.values(n).forEach(s=>{Dn(s.accounts).includes(t)&&r.push(...s.events)}),r}function Hb(n,t){const r=Mo(n,t);if(r)throw new Error(r.message);const s={};for(const[a,l]of Object.entries(n))s[a]={methods:l.methods,events:l.events,chains:l.accounts.map(p=>`${p.split(":")[0]}:${p.split(":")[1]}`)};return s}function Eu(n){return n.includes(":")}function gs(n){return Eu(n)?n.split(":")[0]:n}const zb={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Kb={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function ue(n,t){const{message:r,code:s}=Kb[n];return{message:t?`${r} ${t}`:r,code:s}}function Lt(n,t){const{message:r,code:s}=zb[n];return{message:t?`${r} ${t}`:r,code:s}}function ni(n,t){return Array.isArray(n)?typeof t<"u"&&n.length?n.every(t):!0:!1}function Ln(n){return Object.getPrototypeOf(n)===Object.prototype&&Object.keys(n).length}function ar(n){return typeof n>"u"}function Gt(n,t){return t&&ar(n)?!0:typeof n=="string"&&!!n.trim().length}function Iu(n,t){return t&&ar(n)?!0:typeof n=="number"&&!isNaN(n)}function Bb(n,t){const{requiredNamespaces:r}=t,s=Object.keys(n.namespaces),a=Object.keys(r);let l=!0;return rn(a,s)?(s.forEach(p=>{const{accounts:d,methods:v,events:b}=n.namespaces[p],I=Dn(d),C=r[p];(!rn(Fd(p,C),I)||!rn(C.methods,v)||!rn(C.events,b))&&(l=!1)}),l):!1}function Bo(n){return Gt(n,!1)&&n.includes(":")?n.split(":").length===2:!1}function kb(n){if(Gt(n,!1)&&n.includes(":")){const t=n.split(":");if(t.length===3){const r=t[0]+":"+t[1];return!!t[2]&&Bo(r)}}return!1}function Vb(n){if(Gt(n,!1))try{return typeof new URL(n)<"u"}catch{return!1}return!1}function Gb(n){var t;return(t=n==null?void 0:n.proposer)==null?void 0:t.publicKey}function Wb(n){return n==null?void 0:n.topic}function Yb(n,t){let r=null;return Gt(n==null?void 0:n.publicKey,!1)||(r=ue("MISSING_OR_INVALID",`${t} controller public key should be a string`)),r}function _f(n){let t=!0;return ni(n)?n.length&&(t=n.every(r=>Gt(r,!1))):t=!1,t}function Jb(n,t,r){let s=null;return ni(t)&&t.length?t.forEach(a=>{s||Bo(a)||(s=Lt("UNSUPPORTED_CHAINS",`${r}, chain ${a} should be a string and conform to "namespace:chainId" format`))}):Bo(n)||(s=Lt("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),s}function Qb(n,t,r){let s=null;return Object.entries(n).forEach(([a,l])=>{if(s)return;const p=Jb(a,Fd(a,l),`${t} ${r}`);p&&(s=p)}),s}function Xb(n,t){let r=null;return ni(n)?n.forEach(s=>{r||kb(s)||(r=Lt("UNSUPPORTED_ACCOUNTS",`${t}, account ${s} should be a string and conform to "namespace:chainId:address" format`))}):r=Lt("UNSUPPORTED_ACCOUNTS",`${t}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function Zb(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=Xb(s==null?void 0:s.accounts,`${t} namespace`);a&&(r=a)}),r}function eE(n,t){let r=null;return _f(n==null?void 0:n.methods)?_f(n==null?void 0:n.events)||(r=Lt("UNSUPPORTED_EVENTS",`${t}, events should be an array of strings or empty array for no events`)):r=Lt("UNSUPPORTED_METHODS",`${t}, methods should be an array of strings or empty array for no methods`),r}function Kd(n,t){let r=null;return Object.values(n).forEach(s=>{if(r)return;const a=eE(s,`${t}, namespace`);a&&(r=a)}),r}function tE(n,t,r){let s=null;if(n&&Ln(n)){const a=Kd(n,t);a&&(s=a);const l=Qb(n,t,r);l&&(s=l)}else s=ue("MISSING_OR_INVALID",`${t}, ${r} should be an object with data`);return s}function Mo(n,t){let r=null;if(n&&Ln(n)){const s=Kd(n,t);s&&(r=s);const a=Zb(n,t);a&&(r=a)}else r=ue("MISSING_OR_INVALID",`${t}, namespaces should be an object with data`);return r}function Bd(n){return Gt(n.protocol,!0)}function rE(n,t){let r=!1;return t&&!n?r=!0:n&&ni(n)&&n.length&&n.forEach(s=>{r=Bd(s)}),r}function iE(n){return typeof n=="number"}function yr(n){return typeof n<"u"&&typeof n!==null}function nE(n){return!(!n||typeof n!="object"||!n.code||!Iu(n.code,!1)||!n.message||!Gt(n.message,!1))}function sE(n){return!(ar(n)||!Gt(n.method,!1))}function oE(n){return!(ar(n)||ar(n.result)&&ar(n.error)||!Iu(n.id,!1)||!Gt(n.jsonrpc,!1))}function aE(n){return!(ar(n)||!Gt(n.name,!1))}function mf(n,t){return!(!Bo(t)||!Mb(n).includes(t))}function cE(n,t,r){return Gt(r,!1)?jb(n,t).includes(r):!1}function uE(n,t,r){return Gt(r,!1)?qb(n,t).includes(r):!1}function wf(n,t,r){let s=null;const a=hE(n),l=lE(t),p=Object.keys(a),d=Object.keys(l),v=bf(Object.keys(n)),b=bf(Object.keys(t)),I=v.filter(C=>!b.includes(C));return I.length&&(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${I.toString()}
      Received: ${Object.keys(t).toString()}`)),rn(p,d)||(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${p.toString()}
      Approved: ${d.toString()}`)),Object.keys(t).forEach(C=>{if(!C.includes(":")||s)return;const $=Dn(t[C].accounts);$.includes(C)||(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${C}
        Required: ${C}
        Approved: ${$.toString()}`))}),p.forEach(C=>{s||(rn(a[C].methods,l[C].methods)?rn(a[C].events,l[C].events)||(s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${C}`)):s=ue("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${C}`))}),s}function hE(n){const t={};return Object.keys(n).forEach(r=>{var s;r.includes(":")?t[r]=n[r]:(s=n[r].chains)==null||s.forEach(a=>{t[a]={methods:n[r].methods,events:n[r].events}})}),t}function bf(n){return[...new Set(n.map(t=>t.includes(":")?t.split(":")[0]:t))]}function lE(n){const t={};return Object.keys(n).forEach(r=>{if(r.includes(":"))t[r]=n[r];else{const s=Dn(n[r].accounts);s==null||s.forEach(a=>{t[a]={accounts:n[r].accounts.filter(l=>l.includes(`${a}:`)),methods:n[r].methods,events:n[r].events}})}}),t}function fE(n,t){return Iu(n,!1)&&n<=t.max&&n>=t.min}function Ef(){const n=Os();return new Promise(t=>{switch(n){case Or.browser:t(dE());break;case Or.reactNative:t(pE());break;case Or.node:t(gE());break;default:t(!0)}})}function dE(){return xs()&&(navigator==null?void 0:navigator.onLine)}async function pE(){if(Zo()&&typeof bt<"u"&&bt!=null&&bt.NetInfo){const n=await(bt==null?void 0:bt.NetInfo.fetch());return n==null?void 0:n.isConnected}return!0}function gE(){return!0}function vE(n){switch(Os()){case Or.browser:yE(n);break;case Or.reactNative:_E(n);break}}function yE(n){xs()&&(window.addEventListener("online",()=>n(!0)),window.addEventListener("offline",()=>n(!1)))}function _E(n){var t;Zo()&&typeof bt<"u"&&bt!=null&&bt.NetInfo&&((t=bt)==null||t.NetInfo.addEventListener(r=>n(r==null?void 0:r.isConnected)))}const Mc={};let Lo=class{static get(t){return Mc[t]}static set(t,r){Mc[t]=r}static delete(t){delete Mc[t]}};const mE="PARSE_ERROR",wE="INVALID_REQUEST",bE="METHOD_NOT_FOUND",EE="INVALID_PARAMS",kd="INTERNAL_ERROR",Su="SERVER_ERROR",IE=[-32700,-32600,-32601,-32602,-32603],ys={[mE]:{code:-32700,message:"Parse error"},[wE]:{code:-32600,message:"Invalid Request"},[bE]:{code:-32601,message:"Method not found"},[EE]:{code:-32602,message:"Invalid params"},[kd]:{code:-32603,message:"Internal error"},[Su]:{code:-32e3,message:"Server error"}},Vd=Su;function SE(n){return IE.includes(n)}function If(n){return Object.keys(ys).includes(n)?ys[n]:ys[Vd]}function xE(n){const t=Object.values(ys).find(r=>r.code===n);return t||ys[Vd]}function Gd(n,t,r){return n.message.includes("getaddrinfo ENOTFOUND")||n.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${t}`):n}var Wd={},yi={},Sf;function OE(){if(Sf)return yi;Sf=1,Object.defineProperty(yi,"__esModule",{value:!0}),yi.isBrowserCryptoAvailable=yi.getSubtleCrypto=yi.getBrowerCrypto=void 0;function n(){return(xr===null||xr===void 0?void 0:xr.crypto)||(xr===null||xr===void 0?void 0:xr.msCrypto)||{}}yi.getBrowerCrypto=n;function t(){const s=n();return s.subtle||s.webkitSubtle}yi.getSubtleCrypto=t;function r(){return!!n()&&!!t()}return yi.isBrowserCryptoAvailable=r,yi}var _i={},xf;function PE(){if(xf)return _i;xf=1,Object.defineProperty(_i,"__esModule",{value:!0}),_i.isBrowser=_i.isNode=_i.isReactNative=void 0;function n(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}_i.isReactNative=n;function t(){return typeof Rn<"u"&&typeof Rn.versions<"u"&&typeof Rn.versions.node<"u"}_i.isNode=t;function r(){return!n()&&!t()}return _i.isBrowser=r,_i}(function(n){Object.defineProperty(n,"__esModule",{value:!0});const t=qr;t.__exportStar(OE(),n),t.__exportStar(PE(),n)})(Wd);function xu(n=3){const t=Date.now()*Math.pow(10,n),r=Math.floor(Math.random()*Math.pow(10,n));return t+r}function Yd(n=6){return BigInt(xu(n))}function bs(n,t,r){return{id:r||xu(),jsonrpc:"2.0",method:n,params:t}}function Ou(n,t){return{id:n,jsonrpc:"2.0",result:t}}function ea(n,t,r){return{id:n,jsonrpc:"2.0",error:CE(t,r)}}function CE(n,t){return typeof n>"u"?If(kd):(typeof n=="string"&&(n=Object.assign(Object.assign({},If(Su)),{message:n})),typeof t<"u"&&(n.data=t),SE(n.code)&&(n=xE(n.code)),n)}class AE{}class NE extends AE{constructor(){super()}}class RE extends NE{constructor(t){super()}}const TE="^https?:",LE="^wss?:";function UE(n){const t=n.match(new RegExp(/^\w+:/,"gi"));if(!(!t||!t.length))return t[0]}function Jd(n,t){const r=UE(n);return typeof r>"u"?!1:new RegExp(t).test(r)}function Of(n){return Jd(n,TE)}function Pf(n){return Jd(n,LE)}function FE(n){return new RegExp("wss?://localhost(:d{2,5})?").test(n)}function Qd(n){return typeof n=="object"&&"id"in n&&"jsonrpc"in n&&n.jsonrpc==="2.0"}function Pu(n){return Qd(n)&&"method"in n}function ta(n){return Qd(n)&&(bi(n)||Wr(n))}function bi(n){return"result"in n}function Wr(n){return"error"in n}class $i extends RE{constructor(t){super(t),this.events=new jr.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(t),this.connection.connected&&this.registerEventListeners()}async connect(t=this.connection){await this.open(t)}async disconnect(){await this.close()}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async request(t,r){return this.requestStrict(bs(t.method,t.params||[],t.id||Yd().toString()),r)}async requestStrict(t,r){return new Promise(async(s,a)=>{if(!this.connection.connected)try{await this.open()}catch(l){a(l)}this.events.on(`${t.id}`,l=>{Wr(l)?a(l.error):s(l.result)});try{await this.connection.send(t,r)}catch(l){a(l)}})}setConnection(t=this.connection){return t}onPayload(t){this.events.emit("payload",t),ta(t)?this.events.emit(`${t.id}`,t):this.events.emit("message",{type:t.method,data:t.params})}onClose(t){t&&t.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${t.code} ${t.reason?`(${t.reason})`:""}`)),this.events.emit("disconnect")}async open(t=this.connection){this.connection===t&&this.connection.connected||(this.connection.connected&&this.close(),typeof t=="string"&&(await this.connection.open(t),t=this.connection),this.connection=this.setConnection(t),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",t=>this.onPayload(t)),this.connection.on("close",t=>this.onClose(t)),this.connection.on("error",t=>this.events.emit("error",t)),this.connection.on("register_error",t=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const $E=()=>typeof WebSocket<"u"?WebSocket:typeof bt<"u"&&typeof bt.WebSocket<"u"?bt.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),DE=()=>typeof WebSocket<"u"||typeof bt<"u"&&typeof bt.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Cf=n=>n.split("?")[0],Af=10,ME=$E();class jE{constructor(t){if(this.url=t,this.events=new jr.EventEmitter,this.registering=!1,!Pf(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);this.url=t}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){return new Promise((t,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=s=>{this.onClose(s),t()},this.socket.close()})}async send(t,r){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(_s(t))}catch(s){this.onError(t.id,s)}}register(t=this.url){if(!Pf(t))throw new Error(`Provided URL is not compatible with WebSocket connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),a(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return a(new Error("WebSocket connection is missing or invalid"));s(this.socket)})})}return this.url=t,this.registering=!0,new Promise((r,s)=>{const a=Wd.isReactNative()?void 0:{rejectUnauthorized:!FE(t)},l=new ME(t,[],a);DE()?l.onerror=p=>{const d=p;s(this.emitError(d.error))}:l.on("error",p=>{s(this.emitError(p))}),l.onopen=()=>{this.onOpen(l),r(l)}})}onOpen(t){t.onmessage=r=>this.onPayload(r),t.onclose=r=>this.onClose(r),this.socket=t,this.registering=!1,this.events.emit("open")}onClose(t){this.socket=void 0,this.registering=!1,this.events.emit("close",t)}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?fu(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),l=ea(t,a);this.events.emit("payload",l)}parseError(t,r=this.url){return Gd(t,Cf(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Af&&this.events.setMaxListeners(Af)}emitError(t){const r=this.parseError(new Error((t==null?void 0:t.message)||`WebSocket connection failed for host: ${Cf(this.url)}`));return this.events.emit("register_error",r),r}}var ko={exports:{}};ko.exports;(function(n,t){var r=200,s="__lodash_hash_undefined__",a=1,l=2,p=9007199254740991,d="[object Arguments]",v="[object Array]",b="[object AsyncFunction]",I="[object Boolean]",C="[object Date]",$="[object Error]",N="[object Function]",H="[object GeneratorFunction]",K="[object Map]",B="[object Number]",oe="[object Null]",R="[object Object]",D="[object Promise]",S="[object Proxy]",P="[object RegExp]",m="[object Set]",u="[object String]",_="[object Symbol]",G="[object Undefined]",V="[object WeakMap]",se="[object ArrayBuffer]",ce="[object DataView]",ge="[object Float32Array]",T="[object Float64Array]",q="[object Int8Array]",le="[object Int16Array]",te="[object Int32Array]",W="[object Uint8Array]",ee="[object Uint8ClampedArray]",Y="[object Uint16Array]",re="[object Uint32Array]",Oe=/[\\^$.*+?()[\]{}|]/g,ie=/^\[object .+?Constructor\]$/,we=/^(?:0|[1-9]\d*)$/,he={};he[ge]=he[T]=he[q]=he[le]=he[te]=he[W]=he[ee]=he[Y]=he[re]=!0,he[d]=he[v]=he[se]=he[I]=he[ce]=he[C]=he[$]=he[N]=he[K]=he[B]=he[R]=he[P]=he[m]=he[u]=he[V]=!1;var _e=typeof xr=="object"&&xr&&xr.Object===Object&&xr,j=typeof self=="object"&&self&&self.Object===Object&&self,M=_e||j||Function("return this")(),A=t&&!t.nodeType&&t,h=A&&!0&&n&&!n.nodeType&&n,x=h&&h.exports===A,ne=x&&_e.process,fe=function(){try{return ne&&ne.binding&&ne.binding("util")}catch{}}(),Se=fe&&fe.isTypedArray;function ze(w,L){for(var X=-1,de=w==null?0:w.length,at=0,Re=[];++X<de;){var ft=w[X];L(ft,X,w)&&(Re[at++]=ft)}return Re}function ke(w,L){for(var X=-1,de=L.length,at=w.length;++X<de;)w[at+X]=L[X];return w}function De(w,L){for(var X=-1,de=w==null?0:w.length;++X<de;)if(L(w[X],X,w))return!0;return!1}function pt(w,L){for(var X=-1,de=Array(w);++X<w;)de[X]=L(X);return de}function gt(w){return function(L){return w(L)}}function je(w,L){return w.has(L)}function xe(w,L){return w==null?void 0:w[L]}function Le(w){var L=-1,X=Array(w.size);return w.forEach(function(de,at){X[++L]=[at,de]}),X}function Ue(w,L){return function(X){return w(L(X))}}function qe(w){var L=-1,X=Array(w.size);return w.forEach(function(de){X[++L]=de}),X}var Ce=Array.prototype,Fe=Function.prototype,Ie=Object.prototype,Ae=M["__core-js_shared__"],Ke=Fe.toString,Pe=Ie.hasOwnProperty,Ve=function(){var w=/[^.]+$/.exec(Ae&&Ae.keys&&Ae.keys.IE_PROTO||"");return w?"Symbol(src)_1."+w:""}(),We=Ie.toString,et=RegExp("^"+Ke.call(Pe).replace(Oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),tt=x?M.Buffer:void 0,Je=M.Symbol,er=M.Uint8Array,hr=Ie.propertyIsEnumerable,Yr=Ce.splice,tr=Je?Je.toStringTag:void 0,si=Object.getOwnPropertySymbols,Ei=tt?tt.isBuffer:void 0,Mi=Ue(Object.keys,Object),Et=mr(M,"DataView"),vt=mr(M,"Map"),It=mr(M,"Promise"),St=mr(M,"Set"),mt=mr(M,"WeakMap"),yt=mr(Object,"create"),Ft=ai(Et),$t=ai(vt),xt=ai(It),Dt=ai(St),Ot=ai(mt),At=Je?Je.prototype:void 0,Pt=At?At.valueOf:void 0;function ht(w){var L=-1,X=w==null?0:w.length;for(this.clear();++L<X;){var de=w[L];this.set(de[0],de[1])}}function Mt(){this.__data__=yt?yt(null):{},this.size=0}function jt(w){var L=this.has(w)&&delete this.__data__[w];return this.size-=L?1:0,L}function na(w){var L=this.__data__;if(yt){var X=L[w];return X===s?void 0:X}return Pe.call(L,w)?L[w]:void 0}function sa(w){var L=this.__data__;return yt?L[w]!==void 0:Pe.call(L,w)}function oa(w,L){var X=this.__data__;return this.size+=this.has(w)?0:1,X[w]=yt&&L===void 0?s:L,this}ht.prototype.clear=Mt,ht.prototype.delete=jt,ht.prototype.get=na,ht.prototype.has=sa,ht.prototype.set=oa;function Cr(w){var L=-1,X=w==null?0:w.length;for(this.clear();++L<X;){var de=w[L];this.set(de[0],de[1])}}function aa(){this.__data__=[],this.size=0}function ca(w){var L=this.__data__,X=ji(L,w);if(X<0)return!1;var de=L.length-1;return X==de?L.pop():Yr.call(L,X,1),--this.size,!0}function ua(w){var L=this.__data__,X=ji(L,w);return X<0?void 0:L[X][1]}function ha(w){return ji(this.__data__,w)>-1}function la(w,L){var X=this.__data__,de=ji(X,w);return de<0?(++this.size,X.push([w,L])):X[de][1]=L,this}Cr.prototype.clear=aa,Cr.prototype.delete=ca,Cr.prototype.get=ua,Cr.prototype.has=ha,Cr.prototype.set=la;function oi(w){var L=-1,X=w==null?0:w.length;for(this.clear();++L<X;){var de=w[L];this.set(de[0],de[1])}}function cn(){this.size=0,this.__data__={hash:new ht,map:new(vt||Cr),string:new ht}}function fa(w){var L=Ii(this,w).delete(w);return this.size-=L?1:0,L}function un(w){return Ii(this,w).get(w)}function da(w){return Ii(this,w).has(w)}function pa(w,L){var X=Ii(this,w),de=X.size;return X.set(w,L),this.size+=X.size==de?0:1,this}oi.prototype.clear=cn,oi.prototype.delete=fa,oi.prototype.get=un,oi.prototype.has=da,oi.prototype.set=pa;function hn(w){var L=-1,X=w==null?0:w.length;for(this.__data__=new oi;++L<X;)this.add(w[L])}function Cs(w){return this.__data__.set(w,s),this}function As(w){return this.__data__.has(w)}hn.prototype.add=hn.prototype.push=Cs,hn.prototype.has=As;function Hr(w){var L=this.__data__=new Cr(w);this.size=L.size}function ga(){this.__data__=new Cr,this.size=0}function va(w){var L=this.__data__,X=L.delete(w);return this.size=L.size,X}function ya(w){return this.__data__.get(w)}function _a(w){return this.__data__.has(w)}function Ns(w,L){var X=this.__data__;if(X instanceof Cr){var de=X.__data__;if(!vt||de.length<r-1)return de.push([w,L]),this.size=++X.size,this;X=this.__data__=new oi(de)}return X.set(w,L),this.size=X.size,this}Hr.prototype.clear=ga,Hr.prototype.delete=va,Hr.prototype.get=ya,Hr.prototype.has=_a,Hr.prototype.set=Ns;function Rs(w,L){var X=dn(w),de=!X&&Ks(w),at=!X&&!de&&qn(w),Re=!X&&!de&&!at&&Vs(w),ft=X||de||at||Re,qt=ft?pt(w.length,String):[],Qe=qt.length;for(var ct in w)(L||Pe.call(w,ct))&&!(ft&&(ct=="length"||at&&(ct=="offset"||ct=="parent")||Re&&(ct=="buffer"||ct=="byteLength"||ct=="byteOffset")||Ms(ct,Qe)))&&qt.push(ct);return qt}function ji(w,L){for(var X=w.length;X--;)if(zs(w[X][0],L))return X;return-1}function Mn(w,L,X){var de=L(w);return dn(w)?de:ke(de,X(w))}function qi(w){return w==null?w===void 0?G:oe:tr&&tr in Object(w)?$s(w):ba(w)}function jn(w){return zi(w)&&qi(w)==d}function Hi(w,L,X,de,at){return w===L?!0:w==null||L==null||!zi(w)&&!zi(L)?w!==w&&L!==L:Ts(w,L,X,de,Hi,at)}function Ts(w,L,X,de,at,Re){var ft=dn(w),qt=dn(L),Qe=ft?v:Jr(w),ct=qt?v:Jr(L);Qe=Qe==d?R:Qe,ct=ct==d?R:ct;var Nt=Qe==R,lr=ct==R,Ht=Qe==ct;if(Ht&&qn(w)){if(!qn(L))return!1;ft=!0,Nt=!1}if(Ht&&!Nt)return Re||(Re=new Hr),ft||Vs(w)?ln(w,L,X,de,at,Re):wa(w,L,Qe,X,de,at,Re);if(!(X&a)){var dt=Nt&&Pe.call(w,"__wrapped__"),rr=lr&&Pe.call(L,"__wrapped__");if(dt||rr){var zr=dt?w.value():w,Ar=rr?L.value():L;return Re||(Re=new Hr),at(zr,Ar,X,de,Re)}}return Ht?(Re||(Re=new Hr),Fs(w,L,X,de,at,Re)):!1}function ma(w){if(!ks(w)||qs(w))return!1;var L=pn(w)?et:ie;return L.test(ai(w))}function Ls(w){return zi(w)&&Bs(w.length)&&!!he[qi(w)]}function Us(w){if(!Hs(w))return Mi(w);var L=[];for(var X in Object(w))Pe.call(w,X)&&X!="constructor"&&L.push(X);return L}function ln(w,L,X,de,at,Re){var ft=X&a,qt=w.length,Qe=L.length;if(qt!=Qe&&!(ft&&Qe>qt))return!1;var ct=Re.get(w);if(ct&&Re.get(L))return ct==L;var Nt=-1,lr=!0,Ht=X&l?new hn:void 0;for(Re.set(w,L),Re.set(L,w);++Nt<qt;){var dt=w[Nt],rr=L[Nt];if(de)var zr=ft?de(rr,dt,Nt,L,w,Re):de(dt,rr,Nt,w,L,Re);if(zr!==void 0){if(zr)continue;lr=!1;break}if(Ht){if(!De(L,function(Ar,Qr){if(!je(Ht,Qr)&&(dt===Ar||at(dt,Ar,X,de,Re)))return Ht.push(Qr)})){lr=!1;break}}else if(!(dt===rr||at(dt,rr,X,de,Re))){lr=!1;break}}return Re.delete(w),Re.delete(L),lr}function wa(w,L,X,de,at,Re,ft){switch(X){case ce:if(w.byteLength!=L.byteLength||w.byteOffset!=L.byteOffset)return!1;w=w.buffer,L=L.buffer;case se:return!(w.byteLength!=L.byteLength||!Re(new er(w),new er(L)));case I:case C:case B:return zs(+w,+L);case $:return w.name==L.name&&w.message==L.message;case P:case u:return w==L+"";case K:var qt=Le;case m:var Qe=de&a;if(qt||(qt=qe),w.size!=L.size&&!Qe)return!1;var ct=ft.get(w);if(ct)return ct==L;de|=l,ft.set(w,L);var Nt=ln(qt(w),qt(L),de,at,Re,ft);return ft.delete(w),Nt;case _:if(Pt)return Pt.call(w)==Pt.call(L)}return!1}function Fs(w,L,X,de,at,Re){var ft=X&a,qt=fn(w),Qe=qt.length,ct=fn(L),Nt=ct.length;if(Qe!=Nt&&!ft)return!1;for(var lr=Qe;lr--;){var Ht=qt[lr];if(!(ft?Ht in L:Pe.call(L,Ht)))return!1}var dt=Re.get(w);if(dt&&Re.get(L))return dt==L;var rr=!0;Re.set(w,L),Re.set(L,w);for(var zr=ft;++lr<Qe;){Ht=qt[lr];var Ar=w[Ht],Qr=L[Ht];if(de)var Hn=ft?de(Qr,Ar,Ht,L,w,Re):de(Ar,Qr,Ht,w,L,Re);if(!(Hn===void 0?Ar===Qr||at(Ar,Qr,X,de,Re):Hn)){rr=!1;break}zr||(zr=Ht=="constructor")}if(rr&&!zr){var Ki=w.constructor,kt=L.constructor;Ki!=kt&&"constructor"in w&&"constructor"in L&&!(typeof Ki=="function"&&Ki instanceof Ki&&typeof kt=="function"&&kt instanceof kt)&&(rr=!1)}return Re.delete(w),Re.delete(L),rr}function fn(w){return Mn(w,Sa,Ds)}function Ii(w,L){var X=w.__data__;return js(L)?X[typeof L=="string"?"string":"hash"]:X.map}function mr(w,L){var X=xe(w,L);return ma(X)?X:void 0}function $s(w){var L=Pe.call(w,tr),X=w[tr];try{w[tr]=void 0;var de=!0}catch{}var at=We.call(w);return de&&(L?w[tr]=X:delete w[tr]),at}var Ds=si?function(w){return w==null?[]:(w=Object(w),ze(si(w),function(L){return hr.call(w,L)}))}:ot,Jr=qi;(Et&&Jr(new Et(new ArrayBuffer(1)))!=ce||vt&&Jr(new vt)!=K||It&&Jr(It.resolve())!=D||St&&Jr(new St)!=m||mt&&Jr(new mt)!=V)&&(Jr=function(w){var L=qi(w),X=L==R?w.constructor:void 0,de=X?ai(X):"";if(de)switch(de){case Ft:return ce;case $t:return K;case xt:return D;case Dt:return m;case Ot:return V}return L});function Ms(w,L){return L=L??p,!!L&&(typeof w=="number"||we.test(w))&&w>-1&&w%1==0&&w<L}function js(w){var L=typeof w;return L=="string"||L=="number"||L=="symbol"||L=="boolean"?w!=="__proto__":w===null}function qs(w){return!!Ve&&Ve in w}function Hs(w){var L=w&&w.constructor,X=typeof L=="function"&&L.prototype||Ie;return w===X}function ba(w){return We.call(w)}function ai(w){if(w!=null){try{return Ke.call(w)}catch{}try{return w+""}catch{}}return""}function zs(w,L){return w===L||w!==w&&L!==L}var Ks=jn(function(){return arguments}())?jn:function(w){return zi(w)&&Pe.call(w,"callee")&&!hr.call(w,"callee")},dn=Array.isArray;function Ea(w){return w!=null&&Bs(w.length)&&!pn(w)}var qn=Ei||st;function Ia(w,L){return Hi(w,L)}function pn(w){if(!ks(w))return!1;var L=qi(w);return L==N||L==H||L==b||L==S}function Bs(w){return typeof w=="number"&&w>-1&&w%1==0&&w<=p}function ks(w){var L=typeof w;return w!=null&&(L=="object"||L=="function")}function zi(w){return w!=null&&typeof w=="object"}var Vs=Se?gt(Se):Ls;function Sa(w){return Ea(w)?Rs(w):Us(w)}function ot(){return[]}function st(){return!1}n.exports=Ia})(ko,ko.exports);var qE=ko.exports;const HE=X_(qE);function zE(n,t){if(n.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),s=0;s<r.length;s++)r[s]=255;for(var a=0;a<n.length;a++){var l=n.charAt(a),p=l.charCodeAt(0);if(r[p]!==255)throw new TypeError(l+" is ambiguous");r[p]=a}var d=n.length,v=n.charAt(0),b=Math.log(d)/Math.log(256),I=Math.log(256)/Math.log(d);function C(H){if(H instanceof Uint8Array||(ArrayBuffer.isView(H)?H=new Uint8Array(H.buffer,H.byteOffset,H.byteLength):Array.isArray(H)&&(H=Uint8Array.from(H))),!(H instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(H.length===0)return"";for(var K=0,B=0,oe=0,R=H.length;oe!==R&&H[oe]===0;)oe++,K++;for(var D=(R-oe)*I+1>>>0,S=new Uint8Array(D);oe!==R;){for(var P=H[oe],m=0,u=D-1;(P!==0||m<B)&&u!==-1;u--,m++)P+=256*S[u]>>>0,S[u]=P%d>>>0,P=P/d>>>0;if(P!==0)throw new Error("Non-zero carry");B=m,oe++}for(var _=D-B;_!==D&&S[_]===0;)_++;for(var G=v.repeat(K);_<D;++_)G+=n.charAt(S[_]);return G}function $(H){if(typeof H!="string")throw new TypeError("Expected String");if(H.length===0)return new Uint8Array;var K=0;if(H[K]!==" "){for(var B=0,oe=0;H[K]===v;)B++,K++;for(var R=(H.length-K)*b+1>>>0,D=new Uint8Array(R);H[K];){var S=r[H.charCodeAt(K)];if(S===255)return;for(var P=0,m=R-1;(S!==0||P<oe)&&m!==-1;m--,P++)S+=d*D[m]>>>0,D[m]=S%256>>>0,S=S/256>>>0;if(S!==0)throw new Error("Non-zero carry");oe=P,K++}if(H[K]!==" "){for(var u=R-oe;u!==R&&D[u]===0;)u++;for(var _=new Uint8Array(B+(R-u)),G=B;u!==R;)_[G++]=D[u++];return _}}}function N(H){var K=$(H);if(K)return K;throw new Error(`Non-${t} character`)}return{encode:C,decodeUnsafe:$,decode:N}}var KE=zE,BE=KE;const Xd=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},kE=n=>new TextEncoder().encode(n),VE=n=>new TextDecoder().decode(n);class GE{constructor(t,r,s){this.name=t,this.prefix=r,this.baseEncode=s}encode(t){if(t instanceof Uint8Array)return`${this.prefix}${this.baseEncode(t)}`;throw Error("Unknown type, must be binary type")}}class WE{constructor(t,r,s){if(this.name=t,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=s}decode(t){if(typeof t=="string"){if(t.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(t)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(t.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(t){return Zd(this,t)}}class YE{constructor(t){this.decoders=t}or(t){return Zd(this,t)}decode(t){const r=t[0],s=this.decoders[r];if(s)return s.decode(t);throw RangeError(`Unable to decode multibase string ${JSON.stringify(t)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Zd=(n,t)=>new YE({...n.decoders||{[n.prefix]:n},...t.decoders||{[t.prefix]:t}});class JE{constructor(t,r,s,a){this.name=t,this.prefix=r,this.baseEncode=s,this.baseDecode=a,this.encoder=new GE(t,r,s),this.decoder=new WE(t,r,a)}encode(t){return this.encoder.encode(t)}decode(t){return this.decoder.decode(t)}}const ra=({name:n,prefix:t,encode:r,decode:s})=>new JE(n,t,r,s),Ps=({prefix:n,name:t,alphabet:r})=>{const{encode:s,decode:a}=BE(r,t);return ra({prefix:n,name:t,encode:s,decode:l=>Xd(a(l))})},QE=(n,t,r,s)=>{const a={};for(let I=0;I<t.length;++I)a[t[I]]=I;let l=n.length;for(;n[l-1]==="=";)--l;const p=new Uint8Array(l*r/8|0);let d=0,v=0,b=0;for(let I=0;I<l;++I){const C=a[n[I]];if(C===void 0)throw new SyntaxError(`Non-${s} character`);v=v<<r|C,d+=r,d>=8&&(d-=8,p[b++]=255&v>>d)}if(d>=r||255&v<<8-d)throw new SyntaxError("Unexpected end of data");return p},XE=(n,t,r)=>{const s=t[t.length-1]==="=",a=(1<<r)-1;let l="",p=0,d=0;for(let v=0;v<n.length;++v)for(d=d<<8|n[v],p+=8;p>r;)p-=r,l+=t[a&d>>p];if(p&&(l+=t[a&d<<r-p]),s)for(;l.length*r&7;)l+="=";return l},Yt=({name:n,prefix:t,bitsPerChar:r,alphabet:s})=>ra({prefix:t,name:n,encode(a){return XE(a,s,r)},decode(a){return QE(a,s,r,n)}}),ZE=ra({prefix:"\0",name:"identity",encode:n=>VE(n),decode:n=>kE(n)});var e6=Object.freeze({__proto__:null,identity:ZE});const t6=Yt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var r6=Object.freeze({__proto__:null,base2:t6});const i6=Yt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var n6=Object.freeze({__proto__:null,base8:i6});const s6=Ps({prefix:"9",name:"base10",alphabet:"0123456789"});var o6=Object.freeze({__proto__:null,base10:s6});const a6=Yt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),c6=Yt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var u6=Object.freeze({__proto__:null,base16:a6,base16upper:c6});const h6=Yt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),l6=Yt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),f6=Yt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),d6=Yt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),p6=Yt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),g6=Yt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),v6=Yt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),y6=Yt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),_6=Yt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var m6=Object.freeze({__proto__:null,base32:h6,base32upper:l6,base32pad:f6,base32padupper:d6,base32hex:p6,base32hexupper:g6,base32hexpad:v6,base32hexpadupper:y6,base32z:_6});const w6=Ps({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),b6=Ps({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var E6=Object.freeze({__proto__:null,base36:w6,base36upper:b6});const I6=Ps({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),S6=Ps({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var x6=Object.freeze({__proto__:null,base58btc:I6,base58flickr:S6});const O6=Yt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),P6=Yt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),C6=Yt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),A6=Yt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var N6=Object.freeze({__proto__:null,base64:O6,base64pad:P6,base64url:C6,base64urlpad:A6});const ep=Array.from(""),R6=ep.reduce((n,t,r)=>(n[r]=t,n),[]),T6=ep.reduce((n,t,r)=>(n[t.codePointAt(0)]=r,n),[]);function L6(n){return n.reduce((t,r)=>(t+=R6[r],t),"")}function U6(n){const t=[];for(const r of n){const s=T6[r.codePointAt(0)];if(s===void 0)throw new Error(`Non-base256emoji character: ${r}`);t.push(s)}return new Uint8Array(t)}const F6=ra({prefix:"",name:"base256emoji",encode:L6,decode:U6});var $6=Object.freeze({__proto__:null,base256emoji:F6}),D6=tp,Nf=128,M6=127,j6=~M6,q6=Math.pow(2,31);function tp(n,t,r){t=t||[],r=r||0;for(var s=r;n>=q6;)t[r++]=n&255|Nf,n/=128;for(;n&j6;)t[r++]=n&255|Nf,n>>>=7;return t[r]=n|0,tp.bytes=r-s+1,t}var H6=su,z6=128,Rf=127;function su(n,s){var r=0,s=s||0,a=0,l=s,p,d=n.length;do{if(l>=d)throw su.bytes=0,new RangeError("Could not decode varint");p=n[l++],r+=a<28?(p&Rf)<<a:(p&Rf)*Math.pow(2,a),a+=7}while(p>=z6);return su.bytes=l-s,r}var K6=Math.pow(2,7),B6=Math.pow(2,14),k6=Math.pow(2,21),V6=Math.pow(2,28),G6=Math.pow(2,35),W6=Math.pow(2,42),Y6=Math.pow(2,49),J6=Math.pow(2,56),Q6=Math.pow(2,63),X6=function(n){return n<K6?1:n<B6?2:n<k6?3:n<V6?4:n<G6?5:n<W6?6:n<Y6?7:n<J6?8:n<Q6?9:10},Z6={encode:D6,decode:H6,encodingLength:X6},rp=Z6;const Tf=(n,t,r=0)=>(rp.encode(n,t,r),t),Lf=n=>rp.encodingLength(n),ou=(n,t)=>{const r=t.byteLength,s=Lf(n),a=s+Lf(r),l=new Uint8Array(a+r);return Tf(n,l,0),Tf(r,l,s),l.set(t,a),new e2(n,r,t,l)};class e2{constructor(t,r,s,a){this.code=t,this.size=r,this.digest=s,this.bytes=a}}const ip=({name:n,code:t,encode:r})=>new t2(n,t,r);class t2{constructor(t,r,s){this.name=t,this.code=r,this.encode=s}digest(t){if(t instanceof Uint8Array){const r=this.encode(t);return r instanceof Uint8Array?ou(this.code,r):r.then(s=>ou(this.code,s))}else throw Error("Unknown type, must be binary type")}}const np=n=>async t=>new Uint8Array(await crypto.subtle.digest(n,t)),r2=ip({name:"sha2-256",code:18,encode:np("SHA-256")}),i2=ip({name:"sha2-512",code:19,encode:np("SHA-512")});var n2=Object.freeze({__proto__:null,sha256:r2,sha512:i2});const sp=0,s2="identity",op=Xd,o2=n=>ou(sp,op(n)),a2={code:sp,name:s2,encode:op,digest:o2};var c2=Object.freeze({__proto__:null,identity:a2});new TextEncoder,new TextDecoder;const Uf={...e6,...r6,...n6,...o6,...u6,...m6,...E6,...x6,...N6,...$6};({...n2,...c2});function ap(n){return globalThis.Buffer!=null?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n}function u2(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?ap(globalThis.Buffer.allocUnsafe(n)):new Uint8Array(n)}function cp(n,t,r,s){return{name:n,prefix:t,encoder:{name:n,prefix:t,encode:r},decoder:{decode:s}}}const Ff=cp("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),jc=cp("ascii","a",n=>{let t="a";for(let r=0;r<n.length;r++)t+=String.fromCharCode(n[r]);return t},n=>{n=n.substring(1);const t=u2(n.length);for(let r=0;r<n.length;r++)t[r]=n.charCodeAt(r);return t}),h2={utf8:Ff,"utf-8":Ff,hex:Uf.base16,latin1:jc,ascii:jc,binary:jc,...Uf};function l2(n,t="utf8"){const r=h2[t];if(!r)throw new Error(`Unsupported encoding "${t}"`);return(t==="utf8"||t==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?ap(globalThis.Buffer.from(n,"utf-8")):r.decoder.decode(`${r.prefix}${n}`)}const up="wc",f2=2,Cu="core",Ui=`${up}@2:${Cu}:`,d2={name:Cu,logger:"error"},p2={database:":memory:"},g2="crypto",$f="client_ed25519_seed",v2=ye.ONE_DAY,y2="keychain",_2="0.3",m2="messages",w2="0.3",b2=ye.SIX_HOURS,E2="publisher",hp="irn",I2="error",lp="wss://relay.walletconnect.com",Df="wss://relay.walletconnect.org",S2="relayer",Zt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},x2="_subscription",mi={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},O2=ye.ONE_SECOND,P2="2.10.0",C2=1e4,A2="0.3",N2="WALLETCONNECT_CLIENT_ID",ii={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},R2="subscription",T2="0.3",L2=ye.FIVE_SECONDS*1e3,U2="pairing",F2="0.3",hs={wc_pairingDelete:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:0},res:{ttl:ye.ONE_DAY,prompt:!1,tag:0}}},ri={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$2="history",D2="0.3",M2="expirer",Dr={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},j2="0.3",qc="verify-api",jo="https://verify.walletconnect.com",Mf="https://verify.walletconnect.org";class q2{constructor(t,r){this.core=t,this.logger=r,this.keychain=new Map,this.name=y2,this.version=_2,this.initialized=!1,this.storagePrefix=Ui,this.init=async()=>{if(!this.initialized){const s=await this.getKeyChain();typeof s<"u"&&(this.keychain=s),this.initialized=!0}},this.has=s=>(this.isInitialized(),this.keychain.has(s)),this.set=async(s,a)=>{this.isInitialized(),this.keychain.set(s,a),await this.persist()},this.get=s=>{this.isInitialized();const a=this.keychain.get(s);if(typeof a>"u"){const{message:l}=ue("NO_MATCHING_KEY",`${this.name}: ${s}`);throw new Error(l)}return a},this.del=async s=>{this.isInitialized(),this.keychain.delete(s),await this.persist()},this.core=t,this.logger=Ze.generateChildLogger(r,this.name)}get context(){return Ze.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(t){await this.core.storage.setItem(this.storageKey,jd(t))}async getKeyChain(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?qd(t):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class H2{constructor(t,r,s){this.core=t,this.logger=r,this.name=g2,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),l=sf(a);return xd(l.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=ob();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const l=await this.getClientSeed(),p=sf(l),d=iu();return await Ow(d,a,v2,p)},this.generateSharedKey=(a,l,p)=>{this.isInitialized();const d=this.getPrivateKey(a),v=ab(d,l);return this.setSymKey(v,p)},this.setSymKey=async(a,l)=>{this.isInitialized();const p=l||cb(a);return await this.keychain.set(p,a),p},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,l,p)=>{this.isInitialized();const d=Md(p),v=_s(l);if(ff(d)){const $=d.senderPublicKey,N=d.receiverPublicKey;a=await this.generateSharedKey($,N)}const b=this.getSymKey(a),{type:I,senderPublicKey:C}=d;return hb({type:I,symKey:b,message:v,senderPublicKey:C})},this.decode=async(a,l,p)=>{this.isInitialized();const d=db(l,p);if(ff(d)){const v=d.receiverPublicKey,b=d.senderPublicKey;a=await this.generateSharedKey(v,b)}try{const v=this.getSymKey(a),b=lb({symKey:v,encoded:l});return fu(b)}catch(v){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(v)}},this.getPayloadType=a=>{const l=Ko(a);return Ss(l.type)},this.getPayloadSenderPublicKey=a=>{const l=Ko(a);return l.senderPublicKey?ur(l.senderPublicKey,cr):void 0},this.core=t,this.logger=Ze.generateChildLogger(r,this.name),this.keychain=s||new q2(this.core,this.logger)}get context(){return Ze.getLoggerContext(this.logger)}async setPrivateKey(t,r){return await this.keychain.set(t,r),t}getPrivateKey(t){return this.keychain.get(t)}async getClientSeed(){let t="";try{t=this.keychain.get($f)}catch{t=iu(),await this.keychain.set($f,t)}return l2(t,"base16")}getSymKey(t){return this.keychain.get(t)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class z2 extends Am{constructor(t,r){super(t,r),this.logger=t,this.core=r,this.messages=new Map,this.name=m2,this.version=w2,this.initialized=!1,this.storagePrefix=Ui,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const s=await this.getRelayerMessages();typeof s<"u"&&(this.messages=s),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(s){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(s)}finally{this.initialized=!0}}},this.set=async(s,a)=>{this.isInitialized();const l=Tn(a);let p=this.messages.get(s);return typeof p>"u"&&(p={}),typeof p[l]<"u"||(p[l]=a,this.messages.set(s,p),await this.persist()),l},this.get=s=>{this.isInitialized();let a=this.messages.get(s);return typeof a>"u"&&(a={}),a},this.has=(s,a)=>{this.isInitialized();const l=this.get(s),p=Tn(a);return typeof l[p]<"u"},this.del=async s=>{this.isInitialized(),this.messages.delete(s),await this.persist()},this.logger=Ze.generateChildLogger(t,this.name),this.core=r}get context(){return Ze.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(t){await this.core.storage.setItem(this.storageKey,jd(t))}async getRelayerMessages(){const t=await this.core.storage.getItem(this.storageKey);return typeof t<"u"?qd(t):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class K2 extends Nm{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.events=new jr.EventEmitter,this.name=E2,this.queue=new Map,this.publishTimeout=ye.toMiliseconds(ye.TEN_SECONDS),this.needsTransportRestart=!1,this.publish=async(s,a,l)=>{var p;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:l}});try{const d=(l==null?void 0:l.ttl)||b2,v=nu(l),b=(l==null?void 0:l.prompt)||!1,I=(l==null?void 0:l.tag)||0,C=(l==null?void 0:l.id)||Yd().toString(),$={topic:s,message:a,opts:{ttl:d,relay:v,prompt:b,tag:I,id:C}},N=setTimeout(()=>this.queue.set(C,$),this.publishTimeout);try{await await ws(this.rpcPublish(s,a,d,v,b,I,C),this.publishTimeout,"Failed to publish payload, please try again."),this.removeRequestFromQueue(C),this.relayer.events.emit(Zt.publish,$)}catch(H){if(this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0,(p=l==null?void 0:l.internal)!=null&&p.throwOnFailedPublish)throw this.removeRequestFromQueue(C),H;return}finally{clearTimeout(N)}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:s,message:a,opts:l}})}catch(d){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(d),d}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.relayer=t,this.logger=Ze.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ze.getLoggerContext(this.logger)}rpcPublish(t,r,s,a,l,p,d){var v,b,I,C;const $={method:Do(a.protocol).publish,params:{topic:t,message:r,ttl:s,prompt:l,tag:p},id:d};return ar((v=$.params)==null?void 0:v.prompt)&&((b=$.params)==null||delete b.prompt),ar((I=$.params)==null?void 0:I.tag)&&((C=$.params)==null||delete C.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:$}),this.relayer.request($)}removeRequestFromQueue(t){this.queue.delete(t)}checkQueue(){this.queue.forEach(async t=>{const{topic:r,message:s,opts:a}=t;await this.publish(r,s,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Un.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Zt.connection_stalled);return}this.checkQueue()}),this.relayer.on(Zt.message_ack,t=>{this.removeRequestFromQueue(t.id.toString())})}}class B2{constructor(){this.map=new Map,this.set=(t,r)=>{const s=this.get(t);this.exists(t,r)||this.map.set(t,[...s,r])},this.get=t=>this.map.get(t)||[],this.exists=(t,r)=>this.get(t).includes(r),this.delete=(t,r)=>{if(typeof r>"u"){this.map.delete(t);return}if(!this.map.has(t))return;const s=this.get(t);if(!this.exists(t,r))return;const a=s.filter(l=>l!==r);if(!a.length){this.map.delete(t);return}this.map.set(t,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var k2=Object.defineProperty,V2=Object.defineProperties,G2=Object.getOwnPropertyDescriptors,jf=Object.getOwnPropertySymbols,W2=Object.prototype.hasOwnProperty,Y2=Object.prototype.propertyIsEnumerable,qf=(n,t,r)=>t in n?k2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,ls=(n,t)=>{for(var r in t||(t={}))W2.call(t,r)&&qf(n,r,t[r]);if(jf)for(var r of jf(t))Y2.call(t,r)&&qf(n,r,t[r]);return n},Hc=(n,t)=>V2(n,G2(t));class J2 extends Lm{constructor(t,r){super(t,r),this.relayer=t,this.logger=r,this.subscriptions=new Map,this.topicMap=new B2,this.events=new jr.EventEmitter,this.name=R2,this.version=T2,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Ui,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}});try{const l=nu(a),p={topic:s,relay:l};this.pending.set(s,p);const d=await this.rpcSubscribe(s,l);return this.onSubscribe(d,p),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:s,opts:a}}),d}catch(l){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(l),l}},this.unsubscribe=async(s,a)=>{await this.restartToComplete(),this.isInitialized(),typeof(a==null?void 0:a.id)<"u"?await this.unsubscribeById(s,a.id,a):await this.unsubscribeByTopic(s,a)},this.isSubscribed=async s=>this.topics.includes(s)?!0:await new Promise((a,l)=>{const p=new ye.Watch;p.start(this.pendingSubscriptionWatchLabel);const d=setInterval(()=>{!this.pending.has(s)&&this.topics.includes(s)&&(clearInterval(d),p.stop(this.pendingSubscriptionWatchLabel),a(!0)),p.elapsed(this.pendingSubscriptionWatchLabel)>=L2&&(clearInterval(d),p.stop(this.pendingSubscriptionWatchLabel),l(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=t,this.logger=Ze.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ze.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(t,r){let s=!1;try{s=this.getSubscription(t).topic===r}catch{}return s}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(t,r){const s=this.topicMap.get(t);await Promise.all(s.map(async a=>await this.unsubscribeById(t,a,r)))}async unsubscribeById(t,r,s){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}});try{const a=nu(s);await this.rpcUnsubscribe(t,r,a);const l=Lt("USER_DISCONNECTED",`${this.name}, ${t}`);await this.onUnsubscribe(t,r,l),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:t,id:r,opts:s}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(t,r){const s={method:Do(r.protocol).subscribe,params:{topic:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{await await ws(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Zt.connection_stalled)}return Tn(t+this.clientId)}async rpcBatchSubscribe(t){if(!t.length)return;const r=t[0].relay,s={method:Do(r.protocol).batchSubscribe,params:{topics:t.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s});try{return await await ws(this.relayer.request(s),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(Zt.connection_stalled)}}rpcUnsubscribe(t,r,s){const a={method:Do(s.protocol).unsubscribe,params:{topic:t,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(t,r){this.setSubscription(t,Hc(ls({},r),{id:t})),this.pending.delete(r.topic)}onBatchSubscribe(t){t.length&&t.forEach(r=>{this.setSubscription(r.id,ls({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(t,r,s){this.events.removeAllListeners(r),this.hasSubscription(r,t)&&this.deleteSubscription(r,s),await this.relayer.messages.del(t)}async setRelayerSubscriptions(t){await this.relayer.core.storage.setItem(this.storageKey,t)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(t,r){this.subscriptions.has(t)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:t,subscription:r}),this.addSubscription(t,r))}addSubscription(t,r){this.subscriptions.set(t,ls({},r)),this.topicMap.set(r.topic,t),this.events.emit(ii.created,r)}getSubscription(t){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:t});const r=this.subscriptions.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}deleteSubscription(t,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:t,reason:r});const s=this.getSubscription(t);this.subscriptions.delete(t),this.topicMap.delete(s.topic,t),this.events.emit(ii.deleted,Hc(ls({},s),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ii.sync)}async reset(){if(this.cached.length){const t=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<t;r++){const s=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(s)}}this.events.emit(ii.resubscribed)}async restore(){try{const t=await this.getRelayerSubscriptions();if(typeof t>"u"||!t.length)return;if(this.subscriptions.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(t){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(t)}}async batchSubscribe(t){if(!t.length)return;const r=await this.rpcBatchSubscribe(t);ni(r)&&this.onBatchSubscribe(r.map((s,a)=>Hc(ls({},t[a]),{id:s})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||this.relayer.transportExplicitlyClosed)return;const t=[];this.pending.forEach(r=>{t.push(r)}),await this.batchSubscribe(t)}registerEventListeners(){this.relayer.core.heartbeat.on(Un.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(Zt.connect,async()=>{await this.onConnect()}),this.relayer.on(Zt.disconnect,()=>{this.onDisconnect()}),this.events.on(ii.created,async t=>{const r=ii.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()}),this.events.on(ii.deleted,async t=>{const r=ii.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}async restartToComplete(){this.restartInProgress&&await new Promise(t=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),t())},this.pollingInterval)})}}var Q2=Object.defineProperty,Hf=Object.getOwnPropertySymbols,X2=Object.prototype.hasOwnProperty,Z2=Object.prototype.propertyIsEnumerable,zf=(n,t,r)=>t in n?Q2(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,e5=(n,t)=>{for(var r in t||(t={}))X2.call(t,r)&&zf(n,r,t[r]);if(Hf)for(var r of Hf(t))Z2.call(t,r)&&zf(n,r,t[r]);return n};class t5 extends Rm{constructor(t){super(t),this.protocol="wc",this.version=2,this.events=new jr.EventEmitter,this.name=S2,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.hasExperiencedNetworkDisruption=!1,this.request=async r=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(r)}catch(s){throw this.logger.debug("Failed to Publish Request"),this.logger.error(s),s}},this.onPayloadHandler=r=>{this.onProviderPayload(r)},this.onConnectHandler=()=>{this.events.emit(Zt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(Zt.error,r)},this.registerProviderListeners=()=>{this.provider.on(mi.payload,this.onPayloadHandler),this.provider.on(mi.connect,this.onConnectHandler),this.provider.on(mi.disconnect,this.onDisconnectHandler),this.provider.on(mi.error,this.onProviderErrorHandler)},this.core=t.core,this.logger=typeof t.logger<"u"&&typeof t.logger!="string"?Ze.generateChildLogger(t.logger,this.name):Ze.pino(Ze.getDefaultLoggerOptions({level:t.logger||I2})),this.messages=new z2(this.logger,t.core),this.subscriber=new J2(this,this.logger),this.publisher=new K2(this,this.logger),this.relayUrl=(t==null?void 0:t.relayUrl)||lp,this.projectId=t.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Df}...`),await this.restartTransport(Df)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},C2)}get context(){return Ze.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(t,r,s){this.isInitialized(),await this.publisher.publish(t,r,s),await this.recordMessageEvent({topic:t,message:r,publishedAt:Date.now()})}async subscribe(t,r){var s;this.isInitialized();let a=((s=this.subscriber.topicMap.get(t))==null?void 0:s[0])||"";return a||(await Promise.all([new Promise(l=>{this.subscriber.once(ii.created,p=>{p.topic===t&&l()})}),new Promise(async l=>{a=await this.subscriber.subscribe(t,r),l()})]),a)}async unsubscribe(t,r){this.isInitialized(),await this.subscriber.unsubscribe(t,r)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async transportClose(){this.transportExplicitlyClosed=!0,this.hasExperiencedNetworkDisruption&&this.connected?await ws(this.provider.disconnect(),1e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.connected&&await this.provider.disconnect()}async transportOpen(t){if(this.transportExplicitlyClosed=!1,await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress){t&&t!==this.relayUrl&&(this.relayUrl=t,await this.transportClose(),await this.createProvider()),this.connectionAttemptInProgress=!0;try{await Promise.all([new Promise(r=>{if(!this.initialized)return r();this.subscriber.once(ii.resubscribed,()=>{r()})}),new Promise(async(r,s)=>{try{await ws(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`)}catch(a){s(a);return}r()})])}catch(r){this.logger.error(r);const s=r;if(!this.isConnectionStalled(s.message))throw r;this.provider.events.emit(mi.disconnect)}finally{this.connectionAttemptInProgress=!1,this.hasExperiencedNetworkDisruption=!1}}}async restartTransport(t){await this.confirmOnlineStateOrThrow(),!this.connectionAttemptInProgress&&(this.relayUrl=t||this.relayUrl,await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ef())throw new Error("No internet connection detected. Please restart your network and try again.")}isConnectionStalled(t){return this.staleConnectionErrors.some(r=>t.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const t=await this.core.crypto.signJWT(this.relayUrl);this.provider=new $i(new jE(Sb({sdkVersion:P2,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:t,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(t){const{topic:r,message:s}=t;await this.messages.set(r,s)}async shouldIgnoreMessageEvent(t){const{topic:r,message:s}=t;if(!s||s.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${s}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const a=this.messages.has(r,s);return a&&this.logger.debug(`Ignoring duplicate message: ${s}`),a}async onProviderPayload(t){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:t}),Pu(t)){if(!t.method.endsWith(x2))return;const r=t.params,{topic:s,message:a,publishedAt:l}=r.data,p={topic:s,message:a,publishedAt:l};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(e5({type:"event",event:r.id},p)),this.events.emit(r.id,p),await this.acknowledgePayload(t),await this.onMessageEvent(p)}else ta(t)&&this.events.emit(Zt.message_ack,t)}async onMessageEvent(t){await this.shouldIgnoreMessageEvent(t)||(this.events.emit(Zt.message,t),await this.recordMessageEvent(t))}async acknowledgePayload(t){const r=Ou(t.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(mi.payload,this.onPayloadHandler),this.provider.off(mi.connect,this.onConnectHandler),this.provider.off(mi.disconnect,this.onDisconnectHandler),this.provider.off(mi.error,this.onProviderErrorHandler)}async registerEventListeners(){this.events.on(Zt.connection_stalled,()=>{this.restartTransport().catch(r=>this.logger.error(r))});let t=await Ef();vE(async r=>{this.initialized&&t!==r&&(t=r,r?await this.restartTransport().catch(s=>this.logger.error(s)):(this.hasExperiencedNetworkDisruption=!0,await this.transportClose().catch(s=>this.logger.error(s))))})}onProviderDisconnect(){this.events.emit(Zt.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||(this.logger.info("attemptToReconnect called. Connecting..."),setTimeout(async()=>{await this.restartTransport().catch(t=>this.logger.error(t))},ye.toMiliseconds(O2)))}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}async toEstablishConnection(){if(await this.confirmOnlineStateOrThrow(),!this.connected){if(this.connectionAttemptInProgress)return await new Promise(t=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),t())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var r5=Object.defineProperty,Kf=Object.getOwnPropertySymbols,i5=Object.prototype.hasOwnProperty,n5=Object.prototype.propertyIsEnumerable,Bf=(n,t,r)=>t in n?r5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,kf=(n,t)=>{for(var r in t||(t={}))i5.call(t,r)&&Bf(n,r,t[r]);if(Kf)for(var r of Kf(t))n5.call(t,r)&&Bf(n,r,t[r]);return n};class ia extends Tm{constructor(t,r,s,a=Ui,l=void 0){super(t,r,s,a),this.core=t,this.logger=r,this.name=s,this.map=new Map,this.version=A2,this.cached=[],this.initialized=!1,this.storagePrefix=Ui,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(p=>{this.getKey&&p!==null&&!ar(p)?this.map.set(this.getKey(p),p):Gb(p)?this.map.set(p.id,p):Wb(p)&&this.map.set(p.topic,p)}),this.cached=[],this.initialized=!0)},this.set=async(p,d)=>{this.isInitialized(),this.map.has(p)?await this.update(p,d):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:p,value:d}),this.map.set(p,d),await this.persist())},this.get=p=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:p}),this.getData(p)),this.getAll=p=>(this.isInitialized(),p?this.values.filter(d=>Object.keys(p).every(v=>HE(d[v],p[v]))):this.values),this.update=async(p,d)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:p,update:d});const v=kf(kf({},this.getData(p)),d);this.map.set(p,v),await this.persist()},this.delete=async(p,d)=>{this.isInitialized(),this.map.has(p)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:p,reason:d}),this.map.delete(p),await this.persist())},this.logger=Ze.generateChildLogger(r,this.name),this.storagePrefix=a,this.getKey=l}get context(){return Ze.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(t){await this.core.storage.setItem(this.storageKey,t)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(t){const r=this.map.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const t=await this.getDataStore();if(typeof t>"u"||!t.length)return;if(this.map.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(t){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(t)}}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class s5{constructor(t,r){this.core=t,this.logger=r,this.name=U2,this.version=F2,this.events=new lu,this.initialized=!1,this.storagePrefix=Ui,this.ignoredPayloadTypes=[on],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:s})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...s])]},this.create=async()=>{this.isInitialized();const s=iu(),a=await this.core.crypto.setSymKey(s),l=Gr(ye.FIVE_MINUTES),p={protocol:hp},d={topic:a,expiry:l,relay:p,active:!1},v=Db({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:s,relay:p});return await this.pairings.set(a,d),await this.core.relayer.subscribe(a),this.core.expirer.set(a,l),{topic:a,uri:v}},this.pair=async s=>{this.isInitialized(),this.isValidPair(s);const{topic:a,symKey:l,relay:p}=Ub(s.uri);if(this.pairings.keys.includes(a))throw new Error(`Pairing already exists: ${a}`);if(this.core.crypto.hasKeys(a))throw new Error(`Keychain already exists: ${a}`);const d=Gr(ye.FIVE_MINUTES),v={topic:a,relay:p,expiry:d,active:!1};return await this.pairings.set(a,v),await this.core.crypto.setSymKey(l,a),await this.core.relayer.subscribe(a,{relay:p}),this.core.expirer.set(a,d),s.activatePairing&&await this.activate({topic:a}),v},this.activate=async({topic:s})=>{this.isInitialized();const a=Gr(ye.THIRTY_DAYS);await this.pairings.update(s,{active:!0,expiry:a}),this.core.expirer.set(s,a)},this.ping=async s=>{this.isInitialized(),await this.isValidPing(s);const{topic:a}=s;if(this.pairings.keys.includes(a)){const l=await this.sendRequest(a,"wc_pairingPing",{}),{done:p,resolve:d,reject:v}=Nn();this.events.once(zt("pairing_ping",l),({error:b})=>{b?v(b):d()}),await p()}},this.updateExpiry=async({topic:s,expiry:a})=>{this.isInitialized(),await this.pairings.update(s,{expiry:a})},this.updateMetadata=async({topic:s,metadata:a})=>{this.isInitialized(),await this.pairings.update(s,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async s=>{this.isInitialized(),await this.isValidDisconnect(s);const{topic:a}=s;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",Lt("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(s,a,l)=>{const p=bs(a,l),d=await this.core.crypto.encode(s,p),v=hs[a].req;return this.core.history.set(s,p),this.core.relayer.publish(s,d,v),p.id},this.sendResult=async(s,a,l)=>{const p=Ou(s,l),d=await this.core.crypto.encode(a,p),v=await this.core.history.get(a,s),b=hs[v.request.method].res;await this.core.relayer.publish(a,d,b),await this.core.history.resolve(p)},this.sendError=async(s,a,l)=>{const p=ea(s,l),d=await this.core.crypto.encode(a,p),v=await this.core.history.get(a,s),b=hs[v.request.method]?hs[v.request.method].res:hs.unregistered_method.res;await this.core.relayer.publish(a,d,b),await this.core.history.resolve(p)},this.deletePairing=async(s,a)=>{await this.core.relayer.unsubscribe(s),await Promise.all([this.pairings.delete(s,Lt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(s),a?Promise.resolve():this.core.expirer.del(s)])},this.cleanup=async()=>{const s=this.pairings.getAll().filter(a=>Li(a.expiry));await Promise.all(s.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=s=>{const{topic:a,payload:l}=s;switch(l.method){case"wc_pairingPing":return this.onPairingPingRequest(a,l);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,l);default:return this.onUnknownRpcMethodRequest(a,l)}},this.onRelayEventResponse=async s=>{const{topic:a,payload:l}=s,p=(await this.core.history.get(a,l.id)).request.method;switch(p){case"wc_pairingPing":return this.onPairingPingResponse(a,l);default:return this.onUnknownRpcMethodResponse(p)}},this.onPairingPingRequest=async(s,a)=>{const{id:l}=a;try{this.isValidPing({topic:s}),await this.sendResult(l,s,!0),this.events.emit("pairing_ping",{id:l,topic:s})}catch(p){await this.sendError(l,s,p),this.logger.error(p)}},this.onPairingPingResponse=(s,a)=>{const{id:l}=a;setTimeout(()=>{bi(a)?this.events.emit(zt("pairing_ping",l),{}):Wr(a)&&this.events.emit(zt("pairing_ping",l),{error:a.error})},500)},this.onPairingDeleteRequest=async(s,a)=>{const{id:l}=a;try{this.isValidDisconnect({topic:s}),await this.deletePairing(s),this.events.emit("pairing_delete",{id:l,topic:s})}catch(p){await this.sendError(l,s,p),this.logger.error(p)}},this.onUnknownRpcMethodRequest=async(s,a)=>{const{id:l,method:p}=a;try{if(this.registeredMethods.includes(p))return;const d=Lt("WC_METHOD_UNSUPPORTED",p);await this.sendError(l,s,d),this.logger.error(d)}catch(d){await this.sendError(l,s,d),this.logger.error(d)}},this.onUnknownRpcMethodResponse=s=>{this.registeredMethods.includes(s)||this.logger.error(Lt("WC_METHOD_UNSUPPORTED",s))},this.isValidPair=s=>{if(!yr(s)){const{message:a}=ue("MISSING_OR_INVALID",`pair() params: ${s}`);throw new Error(a)}if(!Vb(s.uri)){const{message:a}=ue("MISSING_OR_INVALID",`pair() uri: ${s.uri}`);throw new Error(a)}},this.isValidPing=async s=>{if(!yr(s)){const{message:l}=ue("MISSING_OR_INVALID",`ping() params: ${s}`);throw new Error(l)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidDisconnect=async s=>{if(!yr(s)){const{message:l}=ue("MISSING_OR_INVALID",`disconnect() params: ${s}`);throw new Error(l)}const{topic:a}=s;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async s=>{if(!Gt(s,!1)){const{message:a}=ue("MISSING_OR_INVALID",`pairing topic should be a string: ${s}`);throw new Error(a)}if(!this.pairings.keys.includes(s)){const{message:a}=ue("NO_MATCHING_KEY",`pairing topic doesn't exist: ${s}`);throw new Error(a)}if(Li(this.pairings.get(s).expiry)){await this.deletePairing(s);const{message:a}=ue("EXPIRED",`pairing topic: ${s}`);throw new Error(a)}},this.core=t,this.logger=Ze.generateChildLogger(r,this.name),this.pairings=new ia(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ze.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}registerRelayerEvents(){this.core.relayer.on(Zt.message,async t=>{const{topic:r,message:s}=t;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(s)))return;const a=await this.core.crypto.decode(r,s);try{Pu(a)?(this.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):ta(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.core.history.delete(r,a.id))}catch(l){this.logger.error(l)}})}registerExpirerEvents(){this.core.expirer.on(Dr.expired,async t=>{const{topic:r}=zd(t.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit("pairing_expire",{topic:r}))})}}class o5 extends Cm{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.records=new Map,this.events=new jr.EventEmitter,this.name=$2,this.version=D2,this.cached=[],this.initialized=!1,this.storagePrefix=Ui,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.records.set(s.id,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(s,a,l)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:s,request:a,chainId:l}),this.records.has(a.id))return;const p={id:a.id,topic:s,request:{method:a.method,params:a.params||null},chainId:l,expiry:Gr(ye.THIRTY_DAYS)};this.records.set(p.id,p),this.events.emit(ri.created,p)},this.resolve=async s=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:s}),!this.records.has(s.id))return;const a=await this.getRecord(s.id);typeof a.response>"u"&&(a.response=Wr(s)?{error:s.error}:{result:s.result},this.records.set(a.id,a),this.events.emit(ri.updated,a))},this.get=async(s,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:s,id:a}),await this.getRecord(a)),this.delete=(s,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(l=>{if(l.topic===s){if(typeof a<"u"&&l.id!==a)return;this.records.delete(l.id),this.events.emit(ri.deleted,l)}})},this.exists=async(s,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===s:!1),this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ze.generateChildLogger(r,this.name)}get context(){return Ze.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const t=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const s={topic:r.topic,request:bs(r.request.method,r.request.params,r.id),chainId:r.chainId};return t.push(s)}),t}async setJsonRpcRecords(t){await this.core.storage.setItem(this.storageKey,t)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(t){this.isInitialized();const r=this.records.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw new Error(s)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ri.sync)}async restore(){try{const t=await this.getJsonRpcRecords();if(typeof t>"u"||!t.length)return;if(this.records.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(t){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(t)}}registerEventListeners(){this.events.on(ri.created,t=>{const r=ri.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(ri.updated,t=>{const r=ri.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.events.on(ri.deleted,t=>{const r=ri.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:t}),this.persist()}),this.core.heartbeat.on(Un.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(t=>{ye.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.delete(t.topic,t.id))})}catch(t){this.logger.warn(t)}}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class a5 extends Um{constructor(t,r){super(t,r),this.core=t,this.logger=r,this.expirations=new Map,this.events=new jr.EventEmitter,this.name=M2,this.version=j2,this.cached=[],this.initialized=!1,this.storagePrefix=Ui,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(s=>this.expirations.set(s.target,s)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=s=>{try{const a=this.formatTarget(s);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(s,a)=>{this.isInitialized();const l=this.formatTarget(s),p={target:l,expiry:a};this.expirations.set(l,p),this.checkExpiry(l,p),this.events.emit(Dr.created,{target:l,expiration:p})},this.get=s=>{this.isInitialized();const a=this.formatTarget(s);return this.getExpiration(a)},this.del=s=>{if(this.isInitialized(),this.has(s)){const a=this.formatTarget(s),l=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Dr.deleted,{target:a,expiration:l})}},this.on=(s,a)=>{this.events.on(s,a)},this.once=(s,a)=>{this.events.once(s,a)},this.off=(s,a)=>{this.events.off(s,a)},this.removeListener=(s,a)=>{this.events.removeListener(s,a)},this.logger=Ze.generateChildLogger(r,this.name)}get context(){return Ze.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(t){if(typeof t=="string")return xb(t);if(typeof t=="number")return Ob(t);const{message:r}=ue("UNKNOWN_TYPE",`Target type: ${typeof t}`);throw new Error(r)}async setExpirations(t){await this.core.storage.setItem(this.storageKey,t)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Dr.sync)}async restore(){try{const t=await this.getExpirations();if(typeof t>"u"||!t.length)return;if(this.expirations.size){const{message:r}=ue("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=t,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(t){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(t)}}getExpiration(t){const r=this.expirations.get(t);if(!r){const{message:s}=ue("NO_MATCHING_KEY",`${this.name}: ${t}`);throw this.logger.error(s),new Error(s)}return r}checkExpiry(t,r){const{expiry:s}=r;ye.toMiliseconds(s)-Date.now()<=0&&this.expire(t,r)}expire(t,r){this.expirations.delete(t),this.events.emit(Dr.expired,{target:t,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((t,r)=>this.checkExpiry(r,t))}registerEventListeners(){this.core.heartbeat.on(Un.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Dr.created,t=>{const r=Dr.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Dr.expired,t=>{const r=Dr.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()}),this.events.on(Dr.deleted,t=>{const r=Dr.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:t}),this.persist()})}isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}}}class c5 extends Fm{constructor(t,r){super(t,r),this.projectId=t,this.logger=r,this.name=qc,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async s=>{if(this.verifyDisabled||Zo()||!xs())return;const a=(s==null?void 0:s.verifyUrl)||jo;this.verifyUrl!==a&&this.removeIframe(),this.verifyUrl=a;try{await this.createIframe()}catch(l){this.logger.warn(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.warn(l)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Mf;try{await this.createIframe()}catch(l){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(l),this.verifyDisabled=!0}}},this.register=async s=>{this.initialized?this.sendPost(s.attestationId):(this.addToQueue(s.attestationId),await this.init())},this.resolve=async s=>{if(this.isDevEnv)return"";const a=(s==null?void 0:s.verifyUrl)||jo;let l="";try{l=await this.fetchAttestation(s.attestationId,a)}catch(p){this.logger.warn(`failed to resolve attestation: ${s.attestationId} from url: ${a}`),this.logger.warn(p),l=await this.fetchAttestation(s.attestationId,Mf)}return l},this.fetchAttestation=async(s,a)=>{var l;this.logger.info(`resolving attestation: ${s} from url: ${a}`);const p=this.startAbortTimer(ye.ONE_SECOND*2),d=await fetch(`${a}/attestation/${s}`,{signal:this.abortController.signal});return clearTimeout(p),d.status===200?(l=await d.json())==null?void 0:l.origin:""},this.addToQueue=s=>{this.queue.push(s)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(s=>this.sendPost(s)),this.queue=[])},this.sendPost=s=>{var a;try{if(!this.iframe)return;(a=this.iframe.contentWindow)==null||a.postMessage(s,"*"),this.logger.info(`postMessage sent: ${s} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let s;const a=l=>{l.data==="verify_ready"&&(this.initialized=!0,this.processQueue(),window.removeEventListener("message",a),s())};await Promise.race([new Promise(l=>{if(document.getElementById(qc))return l();window.addEventListener("message",a);const p=document.createElement("iframe");p.id=qc,p.src=`${this.verifyUrl}/${this.projectId}`,p.style.display="none",document.body.append(p),this.iframe=p,s=l}),new Promise((l,p)=>setTimeout(()=>{window.removeEventListener("message",a),p("verify iframe load timeout")},ye.toMiliseconds(ye.FIVE_SECONDS)))])},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.logger=Ze.generateChildLogger(r,this.name),this.verifyUrl=jo,this.abortController=new AbortController,this.isDevEnv=bu()&&{}.IS_VITEST}get context(){return Ze.getLoggerContext(this.logger)}startAbortTimer(t){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),ye.toMiliseconds(t))}}var u5=Object.defineProperty,Vf=Object.getOwnPropertySymbols,h5=Object.prototype.hasOwnProperty,l5=Object.prototype.propertyIsEnumerable,Gf=(n,t,r)=>t in n?u5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Wf=(n,t)=>{for(var r in t||(t={}))h5.call(t,r)&&Gf(n,r,t[r]);if(Vf)for(var r of Vf(t))l5.call(t,r)&&Gf(n,r,t[r]);return n};class Au extends Pm{constructor(t){super(t),this.protocol=up,this.version=f2,this.name=Cu,this.events=new jr.EventEmitter,this.initialized=!1,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.projectId=t==null?void 0:t.projectId,this.relayUrl=(t==null?void 0:t.relayUrl)||lp;const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ze.pino(Ze.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||d2.logger}));this.logger=Ze.generateChildLogger(r,this.name),this.heartbeat=new Un.HeartBeat,this.crypto=new H2(this,this.logger,t==null?void 0:t.keychain),this.history=new o5(this,this.logger),this.expirer=new a5(this,this.logger),this.storage=t!=null&&t.storage?t.storage:new hm(Wf(Wf({},p2),t==null?void 0:t.storageOptions)),this.relayer=new t5({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new s5(this,this.logger),this.verify=new c5(this.projectId||"",this.logger)}static async init(t){const r=new Au(t);await r.initialize();const s=await r.crypto.getClientId();return await r.storage.setItem(N2,s),r}get context(){return Ze.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(t){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,t),this.logger.error(t.message),t}}}const f5=Au,fp="wc",dp=2,pp="client",Nu=`${fp}@${dp}:${pp}:`,zc={name:pp,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},Yf="WALLETCONNECT_DEEPLINK_CHOICE",d5="proposal",gp="Proposal expired",p5="session",Uo=ye.SEVEN_DAYS,g5="engine",fs={wc_sessionPropose:{req:{ttl:ye.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1104},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1106},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:ye.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:ye.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:ye.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:ye.ONE_DAY,prompt:!1,tag:1112},res:{ttl:ye.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:ye.THIRTY_SECONDS,prompt:!1,tag:1115}}},Kc={min:ye.FIVE_MINUTES,max:ye.SEVEN_DAYS},wi={idle:"IDLE",active:"ACTIVE"},v5="request",y5=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var _5=Object.defineProperty,m5=Object.defineProperties,w5=Object.getOwnPropertyDescriptors,Jf=Object.getOwnPropertySymbols,b5=Object.prototype.hasOwnProperty,E5=Object.prototype.propertyIsEnumerable,Qf=(n,t,r)=>t in n?_5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,vr=(n,t)=>{for(var r in t||(t={}))b5.call(t,r)&&Qf(n,r,t[r]);if(Jf)for(var r of Jf(t))E5.call(t,r)&&Qf(n,r,t[r]);return n},ds=(n,t)=>m5(n,w5(t));class I5 extends Dm{constructor(t){super(t),this.name=g5,this.events=new lu,this.initialized=!1,this.ignoredPayloadTypes=[on],this.requestQueue={state:wi.idle,queue:[]},this.sessionRequestQueue={state:wi.idle,queue:[]},this.requestQueueDelay=ye.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(fs)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},ye.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const s=ds(vr({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(s);const{pairingTopic:a,requiredNamespaces:l,optionalNamespaces:p,sessionProperties:d,relays:v}=s;let b=a,I,C=!1;if(b&&(C=this.client.core.pairing.pairings.get(b).active),!b||!C){const{topic:D,uri:S}=await this.client.core.pairing.create();b=D,I=S}const $=await this.client.core.crypto.generateKeyPair(),N=vr({requiredNamespaces:l,optionalNamespaces:p,relays:v??[{protocol:hp}],proposer:{publicKey:$,metadata:this.client.metadata}},d&&{sessionProperties:d}),{reject:H,resolve:K,done:B}=Nn(ye.FIVE_MINUTES,gp);if(this.events.once(zt("session_connect"),async({error:D,session:S})=>{if(D)H(D);else if(S){S.self.publicKey=$;const P=ds(vr({},S),{requiredNamespaces:S.requiredNamespaces,optionalNamespaces:S.optionalNamespaces});await this.client.session.set(S.topic,P),await this.setExpiry(S.topic,S.expiry),b&&await this.client.core.pairing.updateMetadata({topic:b,metadata:S.peer.metadata}),K(P)}}),!b){const{message:D}=ue("NO_MATCHING_KEY",`connect() pairing topic: ${b}`);throw new Error(D)}const oe=await this.sendRequest({topic:b,method:"wc_sessionPropose",params:N}),R=Gr(ye.FIVE_MINUTES);return await this.setProposal(oe,vr({id:oe,expiry:R},N)),{uri:I,approval:B}},this.pair=async r=>(await this.isInitialized(),await this.client.core.pairing.pair(r)),this.approve=async r=>{await this.isInitialized(),await this.isValidApprove(r);const{id:s,relayProtocol:a,namespaces:l,sessionProperties:p}=r,d=this.client.proposal.get(s);let{pairingTopic:v,proposer:b,requiredNamespaces:I,optionalNamespaces:C}=d;v=v||"",Ln(I)||(I=Hb(l,"approve()"));const $=await this.client.core.crypto.generateKeyPair(),N=b.publicKey,H=await this.client.core.crypto.generateSharedKey($,N);v&&s&&(await this.client.core.pairing.updateMetadata({topic:v,metadata:b.metadata}),await this.sendResult({id:s,topic:v,result:{relay:{protocol:a??"irn"},responderPublicKey:$}}),await this.client.proposal.delete(s,Lt("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:v}));const K=vr({relay:{protocol:a??"irn"},namespaces:l,requiredNamespaces:I,optionalNamespaces:C,pairingTopic:v,controller:{publicKey:$,metadata:this.client.metadata},expiry:Gr(Uo)},p&&{sessionProperties:p});await this.client.core.relayer.subscribe(H),await this.sendRequest({topic:H,method:"wc_sessionSettle",params:K,throwOnFailedPublish:!0});const B=ds(vr({},K),{topic:H,pairingTopic:v,acknowledged:!1,self:K.controller,peer:{publicKey:b.publicKey,metadata:b.metadata},controller:$});return await this.client.session.set(H,B),await this.setExpiry(H,Gr(Uo)),{topic:H,acknowledged:()=>new Promise(oe=>setTimeout(()=>oe(this.client.session.get(H)),500))}},this.reject=async r=>{await this.isInitialized(),await this.isValidReject(r);const{id:s,reason:a}=r,{pairingTopic:l}=this.client.proposal.get(s);l&&(await this.sendError(s,l,a),await this.client.proposal.delete(s,Lt("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized(),await this.isValidUpdate(r);const{topic:s,namespaces:a}=r,l=await this.sendRequest({topic:s,method:"wc_sessionUpdate",params:{namespaces:a}}),{done:p,resolve:d,reject:v}=Nn();return this.events.once(zt("session_update",l),({error:b})=>{b?v(b):d()}),await this.client.session.update(s,{namespaces:a}),{acknowledged:p}},this.extend=async r=>{await this.isInitialized(),await this.isValidExtend(r);const{topic:s}=r,a=await this.sendRequest({topic:s,method:"wc_sessionExtend",params:{}}),{done:l,resolve:p,reject:d}=Nn();return this.events.once(zt("session_extend",a),({error:v})=>{v?d(v):p()}),await this.setExpiry(s,Gr(Uo)),{acknowledged:l}},this.request=async r=>{await this.isInitialized(),await this.isValidRequest(r);const{chainId:s,request:a,topic:l,expiry:p}=r,d=xu(),{done:v,resolve:b,reject:I}=Nn(p);return this.events.once(zt("session_request",d),({error:C,result:$})=>{C?I(C):b($)}),await Promise.all([new Promise(async C=>{await this.sendRequest({clientRpcId:d,topic:l,method:"wc_sessionRequest",params:{request:a,chainId:s},expiry:p,throwOnFailedPublish:!0}).catch($=>I($)),this.client.events.emit("session_request_sent",{topic:l,request:a,chainId:s,id:d}),C()}),new Promise(async C=>{const $=await this.client.core.storage.getItem(Yf);Pb({id:d,topic:l,wcDeepLink:$}),C()}),v()]).then(C=>C[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:s,response:a}=r,{id:l}=a;bi(a)?await this.sendResult({id:l,topic:s,result:a.result,throwOnFailedPublish:!0}):Wr(a)&&await this.sendError(l,s,a.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.client.session.keys.includes(s)){const a=await this.sendRequest({topic:s,method:"wc_sessionPing",params:{}}),{done:l,resolve:p,reject:d}=Nn();this.events.once(zt("session_ping",a),({error:v})=>{v?d(v):p()}),await l()}else this.client.core.pairing.pairings.keys.includes(s)&&await this.client.core.pairing.ping({topic:s})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:s,event:a,chainId:l}=r;await this.sendRequest({topic:s,method:"wc_sessionEvent",params:{event:a,chainId:l}})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.client.session.keys.includes(s)?(await this.sendRequest({topic:s,method:"wc_sessionDelete",params:Lt("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession(s)):await this.client.core.pairing.disconnect({topic:s})},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(s=>Bb(s,r))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const s=this.client.core.pairing.pairings.get(r.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(l=>{var p,d;return((p=l.peerMetadata)==null?void 0:p.url)&&((d=l.peerMetadata)==null?void 0:d.url)===r.peer.metadata.url&&l.topic&&l.topic!==s.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(l=>this.client.core.pairing.disconnect({topic:l.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(s){this.client.logger.error(s)}},this.deleteSession=async(r,s)=>{const{self:a}=this.client.session.get(r);await this.client.core.relayer.unsubscribe(r),this.client.session.delete(r,Lt("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(r)&&await this.client.core.crypto.deleteSymKey(r),s||this.client.core.expirer.del(r),this.client.core.storage.removeItem(Yf).catch(l=>this.client.logger.warn(l))},this.deleteProposal=async(r,s)=>{await Promise.all([this.client.proposal.delete(r,Lt("USER_DISCONNECTED")),s?Promise.resolve():this.client.core.expirer.del(r)])},this.deletePendingSessionRequest=async(r,s,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,s),a?Promise.resolve():this.client.core.expirer.del(r)]),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(l=>l.id!==r),a&&(this.sessionRequestQueue.state=wi.idle)},this.setExpiry=async(r,s)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:s}),this.client.core.expirer.set(r,s)},this.setProposal=async(r,s)=>{await this.client.proposal.set(r,s),this.client.core.expirer.set(r,s.expiry)},this.setPendingSessionRequest=async r=>{const s=fs.wc_sessionRequest.req.ttl,{id:a,topic:l,params:p}=r;await this.client.pendingRequest.set(a,{id:a,topic:l,params:p}),s&&this.client.core.expirer.set(a,Gr(s))},this.sendRequest=async r=>{const{topic:s,method:a,params:l,expiry:p,relayRpcId:d,clientRpcId:v,throwOnFailedPublish:b}=r,I=bs(a,l,v);if(xs()&&y5.includes(a)){const N=Tn(JSON.stringify(I));this.client.core.verify.register({attestationId:N})}const C=await this.client.core.crypto.encode(s,I),$=fs[a].req;return p&&($.ttl=p),d&&($.id=d),this.client.core.history.set(s,I),b?($.internal=ds(vr({},$.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(s,C,$)):this.client.core.relayer.publish(s,C,$).catch(N=>this.client.logger.error(N)),I.id},this.sendResult=async r=>{const{id:s,topic:a,result:l,throwOnFailedPublish:p}=r,d=Ou(s,l),v=await this.client.core.crypto.encode(a,d),b=await this.client.core.history.get(a,s),I=fs[b.request.method].res;p?(I.internal=ds(vr({},I.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(a,v,I)):this.client.core.relayer.publish(a,v,I).catch(C=>this.client.logger.error(C)),await this.client.core.history.resolve(d)},this.sendError=async(r,s,a)=>{const l=ea(r,a),p=await this.client.core.crypto.encode(s,l),d=await this.client.core.history.get(s,r),v=fs[d.request.method].res;this.client.core.relayer.publish(s,p,v),await this.client.core.history.resolve(l)},this.cleanup=async()=>{const r=[],s=[];this.client.session.getAll().forEach(a=>{Li(a.expiry)&&r.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Li(a.expiry)&&s.push(a.id)}),await Promise.all([...r.map(a=>this.deleteSession(a)),...s.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===wi.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=wi.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(s=>setTimeout(s,300))}catch(s){this.client.logger.warn(s)}}this.requestQueue.state=wi.idle},this.processRequest=r=>{const{topic:s,payload:a}=r,l=a.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeRequest(s,a);case"wc_sessionSettle":return this.onSessionSettleRequest(s,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(s,a);case"wc_sessionExtend":return this.onSessionExtendRequest(s,a);case"wc_sessionPing":return this.onSessionPingRequest(s,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(s,a);case"wc_sessionRequest":return this.onSessionRequest(s,a);case"wc_sessionEvent":return this.onSessionEventRequest(s,a);default:return this.client.logger.info(`Unsupported request method ${l}`)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:a}=r,l=(await this.client.core.history.get(s,a.id)).request.method;switch(l){case"wc_sessionPropose":return this.onSessionProposeResponse(s,a);case"wc_sessionSettle":return this.onSessionSettleResponse(s,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(s,a);case"wc_sessionExtend":return this.onSessionExtendResponse(s,a);case"wc_sessionPing":return this.onSessionPingResponse(s,a);case"wc_sessionRequest":return this.onSessionRequestResponse(s,a);default:return this.client.logger.info(`Unsupported response method ${l}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:s}=r,{message:a}=ue("MISSING_OR_INVALID",`Decoded payload on topic ${s} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(r,s)=>{const{params:a,id:l}=s;try{this.isValidConnect(vr({},s.params));const p=Gr(ye.FIVE_MINUTES),d=vr({id:l,pairingTopic:r,expiry:p},a);await this.setProposal(l,d);const v=Tn(JSON.stringify(s)),b=await this.getVerifyContext(v,d.proposer.metadata);this.client.events.emit("session_proposal",{id:l,params:d,verifyContext:b})}catch(p){await this.sendError(l,r,p),this.client.logger.error(p)}},this.onSessionProposeResponse=async(r,s)=>{const{id:a}=s;if(bi(s)){const{result:l}=s;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:l});const p=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:p});const d=p.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:d});const v=l.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:v});const b=await this.client.core.crypto.generateSharedKey(d,v);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:b});const I=await this.client.core.relayer.subscribe(b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:I}),await this.client.core.pairing.activate({topic:r})}else Wr(s)&&(await this.client.proposal.delete(a,Lt("USER_DISCONNECTED")),this.events.emit(zt("session_connect"),{error:s.error}))},this.onSessionSettleRequest=async(r,s)=>{const{id:a,params:l}=s;try{this.isValidSessionSettleRequest(l);const{relay:p,controller:d,expiry:v,namespaces:b,requiredNamespaces:I,optionalNamespaces:C,sessionProperties:$,pairingTopic:N}=s.params,H=vr({topic:r,relay:p,expiry:v,namespaces:b,acknowledged:!0,pairingTopic:N,requiredNamespaces:I,optionalNamespaces:C,controller:d.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:d.publicKey,metadata:d.metadata}},$&&{sessionProperties:$});await this.sendResult({id:s.id,topic:r,result:!0}),this.events.emit(zt("session_connect"),{session:H}),this.cleanupDuplicatePairings(H)}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionSettleResponse=async(r,s)=>{const{id:a}=s;bi(s)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(zt("session_approve",a),{})):Wr(s)&&(await this.client.session.delete(r,Lt("USER_DISCONNECTED")),this.events.emit(zt("session_approve",a),{error:s.error}))},this.onSessionUpdateRequest=async(r,s)=>{const{params:a,id:l}=s;try{const p=`${r}_session_update`,d=Lo.get(p);if(d&&this.isRequestOutOfSync(d,l)){this.client.logger.info(`Discarding out of sync request - ${l}`);return}this.isValidUpdate(vr({topic:r},a)),await this.client.session.update(r,{namespaces:a.namespaces}),await this.sendResult({id:l,topic:r,result:!0}),this.client.events.emit("session_update",{id:l,topic:r,params:a}),Lo.set(p,l)}catch(p){await this.sendError(l,r,p),this.client.logger.error(p)}},this.isRequestOutOfSync=(r,s)=>parseInt(s.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,s)=>{const{id:a}=s;bi(s)?this.events.emit(zt("session_update",a),{}):Wr(s)&&this.events.emit(zt("session_update",a),{error:s.error})},this.onSessionExtendRequest=async(r,s)=>{const{id:a}=s;try{this.isValidExtend({topic:r}),await this.setExpiry(r,Gr(Uo)),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_extend",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionExtendResponse=(r,s)=>{const{id:a}=s;bi(s)?this.events.emit(zt("session_extend",a),{}):Wr(s)&&this.events.emit(zt("session_extend",a),{error:s.error})},this.onSessionPingRequest=async(r,s)=>{const{id:a}=s;try{this.isValidPing({topic:r}),await this.sendResult({id:a,topic:r,result:!0}),this.client.events.emit("session_ping",{id:a,topic:r})}catch(l){await this.sendError(a,r,l),this.client.logger.error(l)}},this.onSessionPingResponse=(r,s)=>{const{id:a}=s;setTimeout(()=>{bi(s)?this.events.emit(zt("session_ping",a),{}):Wr(s)&&this.events.emit(zt("session_ping",a),{error:s.error})},500)},this.onSessionDeleteRequest=async(r,s)=>{const{id:a}=s;try{this.isValidDisconnect({topic:r,reason:s.params}),await Promise.all([new Promise(l=>{this.client.core.relayer.once(Zt.publish,async()=>{l(await this.deleteSession(r))})}),this.sendResult({id:a,topic:r,result:!0})]),this.client.events.emit("session_delete",{id:a,topic:r})}catch(l){this.client.logger.error(l)}},this.onSessionRequest=async(r,s)=>{const{id:a,params:l}=s;try{this.isValidRequest(vr({topic:r},l)),await this.setPendingSessionRequest({id:a,topic:r,params:l}),this.addSessionRequestToSessionRequestQueue({id:a,topic:r,params:l}),await this.processSessionRequestQueue()}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.onSessionRequestResponse=(r,s)=>{const{id:a}=s;bi(s)?this.events.emit(zt("session_request",a),{result:s.result}):Wr(s)&&this.events.emit(zt("session_request",a),{error:s.error})},this.onSessionEventRequest=async(r,s)=>{const{id:a,params:l}=s;try{const p=`${r}_session_event_${l.event.name}`,d=Lo.get(p);if(d&&this.isRequestOutOfSync(d,a)){this.client.logger.info(`Discarding out of sync request - ${a}`);return}this.isValidEmit(vr({topic:r},l)),this.client.events.emit("session_event",{id:a,topic:r,params:l}),Lo.set(p,a)}catch(p){await this.sendError(a,r,p),this.client.logger.error(p)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=wi.idle,this.processSessionRequestQueue()},ye.toMiliseconds(this.requestQueueDelay))},this.processSessionRequestQueue=async()=>{if(this.sessionRequestQueue.state===wi.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{const{id:s,topic:a,params:l}=r,p=Tn(JSON.stringify(bs("wc_sessionRequest",l,s))),d=this.client.session.get(a),v=await this.getVerifyContext(p,d.peer.metadata);this.sessionRequestQueue.state=wi.active,this.client.events.emit("session_request",{id:s,topic:a,params:l,verifyContext:v})}catch(s){this.client.logger.error(s)}},this.isValidConnect=async r=>{if(!yr(r)){const{message:v}=ue("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(v)}const{pairingTopic:s,requiredNamespaces:a,optionalNamespaces:l,sessionProperties:p,relays:d}=r;if(ar(s)||await this.isValidPairingTopic(s),!rE(d,!0)){const{message:v}=ue("MISSING_OR_INVALID",`connect() relays: ${d}`);throw new Error(v)}!ar(a)&&Ln(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!ar(l)&&Ln(l)!==0&&this.validateNamespaces(l,"optionalNamespaces"),ar(p)||this.validateSessionProps(p,"sessionProperties")},this.validateNamespaces=(r,s)=>{const a=tE(r,"connect()",s);if(a)throw new Error(a.message)},this.isValidApprove=async r=>{if(!yr(r))throw new Error(ue("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:s,namespaces:a,relayProtocol:l,sessionProperties:p}=r;await this.isValidProposalId(s);const d=this.client.proposal.get(s),v=Mo(a,"approve()");if(v)throw new Error(v.message);const b=wf(d.requiredNamespaces,a,"approve()");if(b)throw new Error(b.message);if(!Gt(l,!0)){const{message:I}=ue("MISSING_OR_INVALID",`approve() relayProtocol: ${l}`);throw new Error(I)}ar(p)||this.validateSessionProps(p,"sessionProperties")},this.isValidReject=async r=>{if(!yr(r)){const{message:l}=ue("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(l)}const{id:s,reason:a}=r;if(await this.isValidProposalId(s),!nE(a)){const{message:l}=ue("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidSessionSettleRequest=r=>{if(!yr(r)){const{message:b}=ue("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(b)}const{relay:s,controller:a,namespaces:l,expiry:p}=r;if(!Bd(s)){const{message:b}=ue("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(b)}const d=Yb(a,"onSessionSettleRequest()");if(d)throw new Error(d.message);const v=Mo(l,"onSessionSettleRequest()");if(v)throw new Error(v.message);if(Li(p)){const{message:b}=ue("EXPIRED","onSessionSettleRequest()");throw new Error(b)}},this.isValidUpdate=async r=>{if(!yr(r)){const{message:v}=ue("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(v)}const{topic:s,namespaces:a}=r;await this.isValidSessionTopic(s);const l=this.client.session.get(s),p=Mo(a,"update()");if(p)throw new Error(p.message);const d=wf(l.requiredNamespaces,a,"update()");if(d)throw new Error(d.message)},this.isValidExtend=async r=>{if(!yr(r)){const{message:a}=ue("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionTopic(s)},this.isValidRequest=async r=>{if(!yr(r)){const{message:v}=ue("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(v)}const{topic:s,request:a,chainId:l,expiry:p}=r;await this.isValidSessionTopic(s);const{namespaces:d}=this.client.session.get(s);if(!mf(d,l)){const{message:v}=ue("MISSING_OR_INVALID",`request() chainId: ${l}`);throw new Error(v)}if(!sE(a)){const{message:v}=ue("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(v)}if(!cE(d,l,a.method)){const{message:v}=ue("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(v)}if(p&&!fE(p,Kc)){const{message:v}=ue("MISSING_OR_INVALID",`request() expiry: ${p}. Expiry must be a number (in seconds) between ${Kc.min} and ${Kc.max}`);throw new Error(v)}},this.isValidRespond=async r=>{if(!yr(r)){const{message:l}=ue("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(l)}const{topic:s,response:a}=r;if(await this.isValidSessionTopic(s),!oE(a)){const{message:l}=ue("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(l)}},this.isValidPing=async r=>{if(!yr(r)){const{message:a}=ue("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.isValidEmit=async r=>{if(!yr(r)){const{message:d}=ue("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(d)}const{topic:s,event:a,chainId:l}=r;await this.isValidSessionTopic(s);const{namespaces:p}=this.client.session.get(s);if(!mf(p,l)){const{message:d}=ue("MISSING_OR_INVALID",`emit() chainId: ${l}`);throw new Error(d)}if(!aE(a)){const{message:d}=ue("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}if(!uE(p,l,a.name)){const{message:d}=ue("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(d)}},this.isValidDisconnect=async r=>{if(!yr(r)){const{message:a}=ue("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(a)}const{topic:s}=r;await this.isValidSessionOrPairingTopic(s)},this.getVerifyContext=async(r,s)=>{const a={verified:{verifyUrl:s.verifyUrl||jo,validation:"UNKNOWN",origin:s.url||""}};try{const l=await this.client.core.verify.resolve({attestationId:r,verifyUrl:s.verifyUrl});l&&(a.verified.origin=l,a.verified.validation=l===new URL(s.url).origin?"VALID":"INVALID")}catch(l){this.client.logger.error(l)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(r,s)=>{Object.values(r).forEach(a=>{if(!Gt(a,!1)){const{message:l}=ue("MISSING_OR_INVALID",`${s} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(l)}})}}async isInitialized(){if(!this.initialized){const{message:t}=ue("NOT_INITIALIZED",this.name);throw new Error(t)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(Zt.message,async t=>{const{topic:r,message:s}=t;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(s)))return;const a=await this.client.core.crypto.decode(r,s);try{Pu(a)?(this.client.core.history.set(r,a),this.onRelayEventRequest({topic:r,payload:a})):ta(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:r,payload:a}),this.client.core.history.delete(r,a.id)):this.onRelayEventUnknownPayload({topic:r,payload:a})}catch(l){this.client.logger.error(l)}})}registerExpirerEvents(){this.client.core.expirer.on(Dr.expired,async t=>{const{topic:r,id:s}=zd(t.target);if(s&&this.client.pendingRequest.keys.includes(s))return await this.deletePendingSessionRequest(s,ue("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession(r,!0),this.client.events.emit("session_expire",{topic:r})):s&&(await this.deleteProposal(s,!0),this.client.events.emit("proposal_expire",{id:s}))})}isValidPairingTopic(t){if(!Gt(t,!1)){const{message:r}=ue("MISSING_OR_INVALID",`pairing topic should be a string: ${t}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(t)){const{message:r}=ue("NO_MATCHING_KEY",`pairing topic doesn't exist: ${t}`);throw new Error(r)}if(Li(this.client.core.pairing.pairings.get(t).expiry)){const{message:r}=ue("EXPIRED",`pairing topic: ${t}`);throw new Error(r)}}async isValidSessionTopic(t){if(!Gt(t,!1)){const{message:r}=ue("MISSING_OR_INVALID",`session topic should be a string: ${t}`);throw new Error(r)}if(!this.client.session.keys.includes(t)){const{message:r}=ue("NO_MATCHING_KEY",`session topic doesn't exist: ${t}`);throw new Error(r)}if(Li(this.client.session.get(t).expiry)){await this.deleteSession(t);const{message:r}=ue("EXPIRED",`session topic: ${t}`);throw new Error(r)}}async isValidSessionOrPairingTopic(t){if(this.client.session.keys.includes(t))await this.isValidSessionTopic(t);else if(this.client.core.pairing.pairings.keys.includes(t))this.isValidPairingTopic(t);else if(Gt(t,!1)){const{message:r}=ue("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${t}`);throw new Error(r)}else{const{message:r}=ue("MISSING_OR_INVALID",`session or pairing topic should be a string: ${t}`);throw new Error(r)}}async isValidProposalId(t){if(!iE(t)){const{message:r}=ue("MISSING_OR_INVALID",`proposal id should be a number: ${t}`);throw new Error(r)}if(!this.client.proposal.keys.includes(t)){const{message:r}=ue("NO_MATCHING_KEY",`proposal id doesn't exist: ${t}`);throw new Error(r)}if(Li(this.client.proposal.get(t).expiry)){await this.deleteProposal(t);const{message:r}=ue("EXPIRED",`proposal id: ${t}`);throw new Error(r)}}}class S5 extends ia{constructor(t,r){super(t,r,d5,Nu),this.core=t,this.logger=r}}class x5 extends ia{constructor(t,r){super(t,r,p5,Nu),this.core=t,this.logger=r}}class O5 extends ia{constructor(t,r){super(t,r,v5,Nu,s=>s.id),this.core=t,this.logger=r}}let P5=class vp extends $m{constructor(t){super(t),this.protocol=fp,this.version=dp,this.name=zc.name,this.events=new jr.EventEmitter,this.on=(s,a)=>this.events.on(s,a),this.once=(s,a)=>this.events.once(s,a),this.off=(s,a)=>this.events.off(s,a),this.removeListener=(s,a)=>this.events.removeListener(s,a),this.removeAllListeners=s=>this.events.removeAllListeners(s),this.connect=async s=>{try{return await this.engine.connect(s)}catch(a){throw this.logger.error(a.message),a}},this.pair=async s=>{try{return await this.engine.pair(s)}catch(a){throw this.logger.error(a.message),a}},this.approve=async s=>{try{return await this.engine.approve(s)}catch(a){throw this.logger.error(a.message),a}},this.reject=async s=>{try{return await this.engine.reject(s)}catch(a){throw this.logger.error(a.message),a}},this.update=async s=>{try{return await this.engine.update(s)}catch(a){throw this.logger.error(a.message),a}},this.extend=async s=>{try{return await this.engine.extend(s)}catch(a){throw this.logger.error(a.message),a}},this.request=async s=>{try{return await this.engine.request(s)}catch(a){throw this.logger.error(a.message),a}},this.respond=async s=>{try{return await this.engine.respond(s)}catch(a){throw this.logger.error(a.message),a}},this.ping=async s=>{try{return await this.engine.ping(s)}catch(a){throw this.logger.error(a.message),a}},this.emit=async s=>{try{return await this.engine.emit(s)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async s=>{try{return await this.engine.disconnect(s)}catch(a){throw this.logger.error(a.message),a}},this.find=s=>{try{return this.engine.find(s)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(s){throw this.logger.error(s.message),s}},this.name=(t==null?void 0:t.name)||zc.name,this.metadata=(t==null?void 0:t.metadata)||wb();const r=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ze.pino(Ze.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||zc.logger}));this.core=(t==null?void 0:t.core)||new f5(t),this.logger=Ze.generateChildLogger(r,this.name),this.session=new x5(this.core,this.logger),this.proposal=new S5(this.core,this.logger),this.pendingRequest=new O5(this.core,this.logger),this.engine=new I5(this)}static async init(t){const r=new vp(t);return await r.initialize(),r}get context(){return Ze.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(t){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(t.message),t}}};const C5={Accept:"application/json","Content-Type":"application/json"},A5="POST",Xf={headers:C5,method:A5},Zf=10;class an{constructor(t,r=!1){if(this.url=t,this.disableProviderPing=r,this.events=new jr.EventEmitter,this.isAvailable=!1,this.registering=!1,!Of(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);this.url=t,this.disableProviderPing=r}get connected(){return this.isAvailable}get connecting(){return this.registering}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}off(t,r){this.events.off(t,r)}removeListener(t,r){this.events.removeListener(t,r)}async open(t=this.url){await this.register(t)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(t,r){this.isAvailable||await this.register();try{const s=_s(t),l=await(await Tl(this.url,Object.assign(Object.assign({},Xf),{body:s}))).json();this.onPayload({data:l})}catch(s){this.onError(t.id,s)}}async register(t=this.url){if(!Of(t))throw new Error(`Provided URL is not compatible with HTTP connection: ${t}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((s,a)=>{this.events.once("register_error",l=>{this.resetMaxListeners(),a(l)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));s()})})}this.url=t,this.registering=!0;try{if(!this.disableProviderPing){const r=_s({id:1,jsonrpc:"2.0",method:"test",params:[]});await Tl(t,Object.assign(Object.assign({},Xf),{body:r}))}this.onOpen()}catch(r){const s=this.parseError(r);throw this.events.emit("register_error",s),this.onClose(),s}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(t){if(typeof t.data>"u")return;const r=typeof t.data=="string"?fu(t.data):t.data;this.events.emit("payload",r)}onError(t,r){const s=this.parseError(r),a=s.message||s.toString(),l=ea(t,a);this.events.emit("payload",l)}parseError(t,r=this.url){return Gd(t,r,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>Zf&&this.events.setMaxListeners(Zf)}}const ed="error",N5="wss://relay.walletconnect.com",R5="wc",T5="universal_provider",td=`${R5}@2:${T5}:`,L5="https://rpc.walletconnect.com/v1",Di={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var ps=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof bt<"u"?bt:typeof self<"u"?self:{},au={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(n,t){(function(){var r,s="4.17.21",a=200,l="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",p="Expected a function",d="Invalid `variable` option passed into `_.template`",v="__lodash_hash_undefined__",b=500,I="__lodash_placeholder__",C=1,$=2,N=4,H=1,K=2,B=1,oe=2,R=4,D=8,S=16,P=32,m=64,u=128,_=256,G=512,V=30,se="...",ce=800,ge=16,T=1,q=2,le=3,te=1/0,W=9007199254740991,ee=17976931348623157e292,Y=0/0,re=4294967295,Oe=re-1,ie=re>>>1,we=[["ary",u],["bind",B],["bindKey",oe],["curry",D],["curryRight",S],["flip",G],["partial",P],["partialRight",m],["rearg",_]],he="[object Arguments]",_e="[object Array]",j="[object AsyncFunction]",M="[object Boolean]",A="[object Date]",h="[object DOMException]",x="[object Error]",ne="[object Function]",fe="[object GeneratorFunction]",Se="[object Map]",ze="[object Number]",ke="[object Null]",De="[object Object]",pt="[object Promise]",gt="[object Proxy]",je="[object RegExp]",xe="[object Set]",Le="[object String]",Ue="[object Symbol]",qe="[object Undefined]",Ce="[object WeakMap]",Fe="[object WeakSet]",Ie="[object ArrayBuffer]",Ae="[object DataView]",Ke="[object Float32Array]",Pe="[object Float64Array]",Ve="[object Int8Array]",We="[object Int16Array]",et="[object Int32Array]",tt="[object Uint8Array]",Je="[object Uint8ClampedArray]",er="[object Uint16Array]",hr="[object Uint32Array]",Yr=/\b__p \+= '';/g,tr=/\b(__p \+=) '' \+/g,si=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ei=/&(?:amp|lt|gt|quot|#39);/g,Mi=/[&<>"']/g,Et=RegExp(Ei.source),vt=RegExp(Mi.source),It=/<%-([\s\S]+?)%>/g,St=/<%([\s\S]+?)%>/g,mt=/<%=([\s\S]+?)%>/g,yt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ft=/^\w*$/,$t=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,xt=/[\\^$.*+?()[\]{}|]/g,Dt=RegExp(xt.source),Ot=/^\s+/,At=/\s/,Pt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,ht=/\{\n\/\* \[wrapped with (.+)\] \*/,Mt=/,? & /,jt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,na=/[()=,{}\[\]\/\s]/,sa=/\\(\\)?/g,oa=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,Cr=/\w*$/,aa=/^[-+]0x[0-9a-f]+$/i,ca=/^0b[01]+$/i,ua=/^\[object .+?Constructor\]$/,ha=/^0o[0-7]+$/i,la=/^(?:0|[1-9]\d*)$/,oi=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,cn=/($^)/,fa=/['\n\r\u2028\u2029\\]/g,un="\\ud800-\\udfff",da="\\u0300-\\u036f",pa="\\ufe20-\\ufe2f",hn="\\u20d0-\\u20ff",Cs=da+pa+hn,As="\\u2700-\\u27bf",Hr="a-z\\xdf-\\xf6\\xf8-\\xff",ga="\\xac\\xb1\\xd7\\xf7",va="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ya="\\u2000-\\u206f",_a=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Ns="A-Z\\xc0-\\xd6\\xd8-\\xde",Rs="\\ufe0e\\ufe0f",ji=ga+va+ya+_a,Mn="[']",qi="["+un+"]",jn="["+ji+"]",Hi="["+Cs+"]",Ts="\\d+",ma="["+As+"]",Ls="["+Hr+"]",Us="[^"+un+ji+Ts+As+Hr+Ns+"]",ln="\\ud83c[\\udffb-\\udfff]",wa="(?:"+Hi+"|"+ln+")",Fs="[^"+un+"]",fn="(?:\\ud83c[\\udde6-\\uddff]){2}",Ii="[\\ud800-\\udbff][\\udc00-\\udfff]",mr="["+Ns+"]",$s="\\u200d",Ds="(?:"+Ls+"|"+Us+")",Jr="(?:"+mr+"|"+Us+")",Ms="(?:"+Mn+"(?:d|ll|m|re|s|t|ve))?",js="(?:"+Mn+"(?:D|LL|M|RE|S|T|VE))?",qs=wa+"?",Hs="["+Rs+"]?",ba="(?:"+$s+"(?:"+[Fs,fn,Ii].join("|")+")"+Hs+qs+")*",ai="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",zs="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ks=Hs+qs+ba,dn="(?:"+[ma,fn,Ii].join("|")+")"+Ks,Ea="(?:"+[Fs+Hi+"?",Hi,fn,Ii,qi].join("|")+")",qn=RegExp(Mn,"g"),Ia=RegExp(Hi,"g"),pn=RegExp(ln+"(?="+ln+")|"+Ea+Ks,"g"),Bs=RegExp([mr+"?"+Ls+"+"+Ms+"(?="+[jn,mr,"$"].join("|")+")",Jr+"+"+js+"(?="+[jn,mr+Ds,"$"].join("|")+")",mr+"?"+Ds+"+"+Ms,mr+"+"+js,zs,ai,Ts,dn].join("|"),"g"),ks=RegExp("["+$s+un+Cs+Rs+"]"),zi=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Vs=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Sa=-1,ot={};ot[Ke]=ot[Pe]=ot[Ve]=ot[We]=ot[et]=ot[tt]=ot[Je]=ot[er]=ot[hr]=!0,ot[he]=ot[_e]=ot[Ie]=ot[M]=ot[Ae]=ot[A]=ot[x]=ot[ne]=ot[Se]=ot[ze]=ot[De]=ot[je]=ot[xe]=ot[Le]=ot[Ce]=!1;var st={};st[he]=st[_e]=st[Ie]=st[Ae]=st[M]=st[A]=st[Ke]=st[Pe]=st[Ve]=st[We]=st[et]=st[Se]=st[ze]=st[De]=st[je]=st[xe]=st[Le]=st[Ue]=st[tt]=st[Je]=st[er]=st[hr]=!0,st[x]=st[ne]=st[Ce]=!1;var w={:"A",:"A",:"A",:"A",:"A",:"A",:"a",:"a",:"a",:"a",:"a",:"a",:"C",:"c",:"D",:"d",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"N",:"n",:"O",:"O",:"O",:"O",:"O",:"O",:"o",:"o",:"o",:"o",:"o",:"o",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"Y",:"y",:"y",:"Ae",:"ae",:"Th",:"th",:"ss",:"A",:"A",:"A",:"a",:"a",:"a",:"C",:"C",:"C",:"C",:"c",:"c",:"c",:"c",:"D",:"D",:"d",:"d",:"E",:"E",:"E",:"E",:"E",:"e",:"e",:"e",:"e",:"e",:"G",:"G",:"G",:"G",:"g",:"g",:"g",:"g",:"H",:"H",:"h",:"h",:"I",:"I",:"I",:"I",:"I",:"i",:"i",:"i",:"i",:"i",:"J",:"j",:"K",:"k",:"k",:"L",:"L",:"L",:"L",:"L",:"l",:"l",:"l",:"l",:"l",:"N",:"N",:"N",:"N",:"n",:"n",:"n",:"n",:"O",:"O",:"O",:"o",:"o",:"o",:"R",:"R",:"R",:"r",:"r",:"r",:"S",:"S",:"S",:"S",:"s",:"s",:"s",:"s",:"T",:"T",:"T",:"t",:"t",:"t",:"U",:"U",:"U",:"U",:"U",:"U",:"u",:"u",:"u",:"u",:"u",:"u",:"W",:"w",:"Y",:"y",:"Y",:"Z",:"Z",:"Z",:"z",:"z",:"z",:"IJ",:"ij",:"Oe",:"oe",:"'n",:"s"},L={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},X={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},de={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},at=parseFloat,Re=parseInt,ft=typeof ps=="object"&&ps&&ps.Object===Object&&ps,qt=typeof self=="object"&&self&&self.Object===Object&&self,Qe=ft||qt||Function("return this")(),ct=t&&!t.nodeType&&t,Nt=ct&&!0&&n&&!n.nodeType&&n,lr=Nt&&Nt.exports===ct,Ht=lr&&ft.process,dt=function(){try{var U=Nt&&Nt.require&&Nt.require("util").types;return U||Ht&&Ht.binding&&Ht.binding("util")}catch{}}(),rr=dt&&dt.isArrayBuffer,zr=dt&&dt.isDate,Ar=dt&&dt.isMap,Qr=dt&&dt.isRegExp,Hn=dt&&dt.isSet,Ki=dt&&dt.isTypedArray;function kt(U,k,z){switch(z.length){case 0:return U.call(k);case 1:return U.call(k,z[0]);case 2:return U.call(k,z[0],z[1]);case 3:return U.call(k,z[0],z[1],z[2])}return U.apply(k,z)}function mp(U,k,z,pe){for(var Ne=-1,rt=U==null?0:U.length;++Ne<rt;){var Kt=U[Ne];k(pe,Kt,z(Kt),U)}return pe}function Nr(U,k){for(var z=-1,pe=U==null?0:U.length;++z<pe&&k(U[z],z,U)!==!1;);return U}function wp(U,k){for(var z=U==null?0:U.length;z--&&k(U[z],z,U)!==!1;);return U}function Lu(U,k){for(var z=-1,pe=U==null?0:U.length;++z<pe;)if(!k(U[z],z,U))return!1;return!0}function Si(U,k){for(var z=-1,pe=U==null?0:U.length,Ne=0,rt=[];++z<pe;){var Kt=U[z];k(Kt,z,U)&&(rt[Ne++]=Kt)}return rt}function Gs(U,k){var z=U==null?0:U.length;return!!z&&gn(U,k,0)>-1}function xa(U,k,z){for(var pe=-1,Ne=U==null?0:U.length;++pe<Ne;)if(z(k,U[pe]))return!0;return!1}function _t(U,k){for(var z=-1,pe=U==null?0:U.length,Ne=Array(pe);++z<pe;)Ne[z]=k(U[z],z,U);return Ne}function xi(U,k){for(var z=-1,pe=k.length,Ne=U.length;++z<pe;)U[Ne+z]=k[z];return U}function Oa(U,k,z,pe){var Ne=-1,rt=U==null?0:U.length;for(pe&&rt&&(z=U[++Ne]);++Ne<rt;)z=k(z,U[Ne],Ne,U);return z}function bp(U,k,z,pe){var Ne=U==null?0:U.length;for(pe&&Ne&&(z=U[--Ne]);Ne--;)z=k(z,U[Ne],Ne,U);return z}function Pa(U,k){for(var z=-1,pe=U==null?0:U.length;++z<pe;)if(k(U[z],z,U))return!0;return!1}var Ep=Ca("length");function Ip(U){return U.split("")}function Sp(U){return U.match(jt)||[]}function Uu(U,k,z){var pe;return z(U,function(Ne,rt,Kt){if(k(Ne,rt,Kt))return pe=rt,!1}),pe}function Ws(U,k,z,pe){for(var Ne=U.length,rt=z+(pe?1:-1);pe?rt--:++rt<Ne;)if(k(U[rt],rt,U))return rt;return-1}function gn(U,k,z){return k===k?$p(U,k,z):Ws(U,Fu,z)}function xp(U,k,z,pe){for(var Ne=z-1,rt=U.length;++Ne<rt;)if(pe(U[Ne],k))return Ne;return-1}function Fu(U){return U!==U}function $u(U,k){var z=U==null?0:U.length;return z?Na(U,k)/z:Y}function Ca(U){return function(k){return k==null?r:k[U]}}function Aa(U){return function(k){return U==null?r:U[k]}}function Du(U,k,z,pe,Ne){return Ne(U,function(rt,Kt,ut){z=pe?(pe=!1,rt):k(z,rt,Kt,ut)}),z}function Op(U,k){var z=U.length;for(U.sort(k);z--;)U[z]=U[z].value;return U}function Na(U,k){for(var z,pe=-1,Ne=U.length;++pe<Ne;){var rt=k(U[pe]);rt!==r&&(z=z===r?rt:z+rt)}return z}function Ra(U,k){for(var z=-1,pe=Array(U);++z<U;)pe[z]=k(z);return pe}function Pp(U,k){return _t(k,function(z){return[z,U[z]]})}function Mu(U){return U&&U.slice(0,zu(U)+1).replace(Ot,"")}function wr(U){return function(k){return U(k)}}function Ta(U,k){return _t(k,function(z){return U[z]})}function zn(U,k){return U.has(k)}function ju(U,k){for(var z=-1,pe=U.length;++z<pe&&gn(k,U[z],0)>-1;);return z}function qu(U,k){for(var z=U.length;z--&&gn(k,U[z],0)>-1;);return z}function Cp(U,k){for(var z=U.length,pe=0;z--;)U[z]===k&&++pe;return pe}var Ap=Aa(w),Np=Aa(L);function Rp(U){return"\\"+de[U]}function Tp(U,k){return U==null?r:U[k]}function vn(U){return ks.test(U)}function Lp(U){return zi.test(U)}function Up(U){for(var k,z=[];!(k=U.next()).done;)z.push(k.value);return z}function La(U){var k=-1,z=Array(U.size);return U.forEach(function(pe,Ne){z[++k]=[Ne,pe]}),z}function Hu(U,k){return function(z){return U(k(z))}}function Oi(U,k){for(var z=-1,pe=U.length,Ne=0,rt=[];++z<pe;){var Kt=U[z];(Kt===k||Kt===I)&&(U[z]=I,rt[Ne++]=z)}return rt}function Ys(U){var k=-1,z=Array(U.size);return U.forEach(function(pe){z[++k]=pe}),z}function Fp(U){var k=-1,z=Array(U.size);return U.forEach(function(pe){z[++k]=[pe,pe]}),z}function $p(U,k,z){for(var pe=z-1,Ne=U.length;++pe<Ne;)if(U[pe]===k)return pe;return-1}function Dp(U,k,z){for(var pe=z+1;pe--;)if(U[pe]===k)return pe;return pe}function yn(U){return vn(U)?jp(U):Ep(U)}function Kr(U){return vn(U)?qp(U):Ip(U)}function zu(U){for(var k=U.length;k--&&At.test(U.charAt(k)););return k}var Mp=Aa(X);function jp(U){for(var k=pn.lastIndex=0;pn.test(U);)++k;return k}function qp(U){return U.match(pn)||[]}function Hp(U){return U.match(Bs)||[]}var zp=function U(k){k=k==null?Qe:_n.defaults(Qe.Object(),k,_n.pick(Qe,Vs));var z=k.Array,pe=k.Date,Ne=k.Error,rt=k.Function,Kt=k.Math,ut=k.Object,Ua=k.RegExp,Kp=k.String,Rr=k.TypeError,Js=z.prototype,Bp=rt.prototype,mn=ut.prototype,Qs=k["__core-js_shared__"],Xs=Bp.toString,nt=mn.hasOwnProperty,kp=0,Ku=function(){var e=/[^.]+$/.exec(Qs&&Qs.keys&&Qs.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Zs=mn.toString,Vp=Xs.call(ut),Gp=Qe._,Wp=Ua("^"+Xs.call(nt).replace(xt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),eo=lr?k.Buffer:r,Pi=k.Symbol,to=k.Uint8Array,Bu=eo?eo.allocUnsafe:r,ro=Hu(ut.getPrototypeOf,ut),ku=ut.create,Vu=mn.propertyIsEnumerable,io=Js.splice,Gu=Pi?Pi.isConcatSpreadable:r,Kn=Pi?Pi.iterator:r,Bi=Pi?Pi.toStringTag:r,no=function(){try{var e=Yi(ut,"defineProperty");return e({},"",{}),e}catch{}}(),Yp=k.clearTimeout!==Qe.clearTimeout&&k.clearTimeout,Jp=pe&&pe.now!==Qe.Date.now&&pe.now,Qp=k.setTimeout!==Qe.setTimeout&&k.setTimeout,so=Kt.ceil,oo=Kt.floor,Fa=ut.getOwnPropertySymbols,Xp=eo?eo.isBuffer:r,Wu=k.isFinite,Zp=Js.join,eg=Hu(ut.keys,ut),Bt=Kt.max,Jt=Kt.min,tg=pe.now,rg=k.parseInt,Yu=Kt.random,ig=Js.reverse,$a=Yi(k,"DataView"),Bn=Yi(k,"Map"),Da=Yi(k,"Promise"),wn=Yi(k,"Set"),kn=Yi(k,"WeakMap"),Vn=Yi(ut,"create"),ao=kn&&new kn,bn={},ng=Ji($a),sg=Ji(Bn),og=Ji(Da),ag=Ji(wn),cg=Ji(kn),co=Pi?Pi.prototype:r,Gn=co?co.valueOf:r,Ju=co?co.toString:r;function g(e){if(Ct(e)&&!Te(e)&&!(e instanceof Ye)){if(e instanceof Tr)return e;if(nt.call(e,"__wrapped__"))return Qh(e)}return new Tr(e)}var En=function(){function e(){}return function(i){if(!wt(i))return{};if(ku)return ku(i);e.prototype=i;var o=new e;return e.prototype=r,o}}();function uo(){}function Tr(e,i){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!i,this.__index__=0,this.__values__=r}g.templateSettings={escape:It,evaluate:St,interpolate:mt,variable:"",imports:{_:g}},g.prototype=uo.prototype,g.prototype.constructor=g,Tr.prototype=En(uo.prototype),Tr.prototype.constructor=Tr;function Ye(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=re,this.__views__=[]}function ug(){var e=new Ye(this.__wrapped__);return e.__actions__=fr(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=fr(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=fr(this.__views__),e}function hg(){if(this.__filtered__){var e=new Ye(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function lg(){var e=this.__wrapped__.value(),i=this.__dir__,o=Te(e),c=i<0,f=o?e.length:0,y=I0(0,f,this.__views__),E=y.start,O=y.end,F=O-E,J=c?O:E-1,Q=this.__iteratees__,Z=Q.length,ae=0,ve=Jt(F,this.__takeCount__);if(!o||!c&&f==F&&ve==F)return wh(e,this.__actions__);var be=[];e:for(;F--&&ae<ve;){J+=i;for(var He=-1,Ee=e[J];++He<Z;){var Ge=Q[He],Xe=Ge.iteratee,Ir=Ge.type,sr=Xe(Ee);if(Ir==q)Ee=sr;else if(!sr){if(Ir==T)continue e;break e}}be[ae++]=Ee}return be}Ye.prototype=En(uo.prototype),Ye.prototype.constructor=Ye;function ki(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function fg(){this.__data__=Vn?Vn(null):{},this.size=0}function dg(e){var i=this.has(e)&&delete this.__data__[e];return this.size-=i?1:0,i}function pg(e){var i=this.__data__;if(Vn){var o=i[e];return o===v?r:o}return nt.call(i,e)?i[e]:r}function gg(e){var i=this.__data__;return Vn?i[e]!==r:nt.call(i,e)}function vg(e,i){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=Vn&&i===r?v:i,this}ki.prototype.clear=fg,ki.prototype.delete=dg,ki.prototype.get=pg,ki.prototype.has=gg,ki.prototype.set=vg;function ci(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function yg(){this.__data__=[],this.size=0}function _g(e){var i=this.__data__,o=ho(i,e);if(o<0)return!1;var c=i.length-1;return o==c?i.pop():io.call(i,o,1),--this.size,!0}function mg(e){var i=this.__data__,o=ho(i,e);return o<0?r:i[o][1]}function wg(e){return ho(this.__data__,e)>-1}function bg(e,i){var o=this.__data__,c=ho(o,e);return c<0?(++this.size,o.push([e,i])):o[c][1]=i,this}ci.prototype.clear=yg,ci.prototype.delete=_g,ci.prototype.get=mg,ci.prototype.has=wg,ci.prototype.set=bg;function ui(e){var i=-1,o=e==null?0:e.length;for(this.clear();++i<o;){var c=e[i];this.set(c[0],c[1])}}function Eg(){this.size=0,this.__data__={hash:new ki,map:new(Bn||ci),string:new ki}}function Ig(e){var i=Io(this,e).delete(e);return this.size-=i?1:0,i}function Sg(e){return Io(this,e).get(e)}function xg(e){return Io(this,e).has(e)}function Og(e,i){var o=Io(this,e),c=o.size;return o.set(e,i),this.size+=o.size==c?0:1,this}ui.prototype.clear=Eg,ui.prototype.delete=Ig,ui.prototype.get=Sg,ui.prototype.has=xg,ui.prototype.set=Og;function Vi(e){var i=-1,o=e==null?0:e.length;for(this.__data__=new ui;++i<o;)this.add(e[i])}function Pg(e){return this.__data__.set(e,v),this}function Cg(e){return this.__data__.has(e)}Vi.prototype.add=Vi.prototype.push=Pg,Vi.prototype.has=Cg;function Br(e){var i=this.__data__=new ci(e);this.size=i.size}function Ag(){this.__data__=new ci,this.size=0}function Ng(e){var i=this.__data__,o=i.delete(e);return this.size=i.size,o}function Rg(e){return this.__data__.get(e)}function Tg(e){return this.__data__.has(e)}function Lg(e,i){var o=this.__data__;if(o instanceof ci){var c=o.__data__;if(!Bn||c.length<a-1)return c.push([e,i]),this.size=++o.size,this;o=this.__data__=new ui(c)}return o.set(e,i),this.size=o.size,this}Br.prototype.clear=Ag,Br.prototype.delete=Ng,Br.prototype.get=Rg,Br.prototype.has=Tg,Br.prototype.set=Lg;function Qu(e,i){var o=Te(e),c=!o&&Qi(e),f=!o&&!c&&Ti(e),y=!o&&!c&&!f&&On(e),E=o||c||f||y,O=E?Ra(e.length,Kp):[],F=O.length;for(var J in e)(i||nt.call(e,J))&&!(E&&(J=="length"||f&&(J=="offset"||J=="parent")||y&&(J=="buffer"||J=="byteLength"||J=="byteOffset")||di(J,F)))&&O.push(J);return O}function Xu(e){var i=e.length;return i?e[Wa(0,i-1)]:r}function Ug(e,i){return So(fr(e),Gi(i,0,e.length))}function Fg(e){return So(fr(e))}function Ma(e,i,o){(o!==r&&!kr(e[i],o)||o===r&&!(i in e))&&hi(e,i,o)}function Wn(e,i,o){var c=e[i];(!(nt.call(e,i)&&kr(c,o))||o===r&&!(i in e))&&hi(e,i,o)}function ho(e,i){for(var o=e.length;o--;)if(kr(e[o][0],i))return o;return-1}function $g(e,i,o,c){return Ci(e,function(f,y,E){i(c,f,o(f),E)}),c}function Zu(e,i){return e&&Zr(i,Vt(i),e)}function Dg(e,i){return e&&Zr(i,pr(i),e)}function hi(e,i,o){i=="__proto__"&&no?no(e,i,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[i]=o}function ja(e,i){for(var o=-1,c=i.length,f=z(c),y=e==null;++o<c;)f[o]=y?r:mc(e,i[o]);return f}function Gi(e,i,o){return e===e&&(o!==r&&(e=e<=o?e:o),i!==r&&(e=e>=i?e:i)),e}function Lr(e,i,o,c,f,y){var E,O=i&C,F=i&$,J=i&N;if(o&&(E=f?o(e,c,f,y):o(e)),E!==r)return E;if(!wt(e))return e;var Q=Te(e);if(Q){if(E=x0(e),!O)return fr(e,E)}else{var Z=Qt(e),ae=Z==ne||Z==fe;if(Ti(e))return Ih(e,O);if(Z==De||Z==he||ae&&!f){if(E=F||ae?{}:zh(e),!O)return F?p0(e,Dg(E,e)):d0(e,Zu(E,e))}else{if(!st[Z])return f?e:{};E=O0(e,Z,O)}}y||(y=new Br);var ve=y.get(e);if(ve)return ve;y.set(e,E),yl(e)?e.forEach(function(Ee){E.add(Lr(Ee,i,o,Ee,e,y))}):gl(e)&&e.forEach(function(Ee,Ge){E.set(Ge,Lr(Ee,i,o,Ge,e,y))});var be=J?F?sc:nc:F?pr:Vt,He=Q?r:be(e);return Nr(He||e,function(Ee,Ge){He&&(Ge=Ee,Ee=e[Ge]),Wn(E,Ge,Lr(Ee,i,o,Ge,e,y))}),E}function Mg(e){var i=Vt(e);return function(o){return eh(o,e,i)}}function eh(e,i,o){var c=o.length;if(e==null)return!c;for(e=ut(e);c--;){var f=o[c],y=i[f],E=e[f];if(E===r&&!(f in e)||!y(E))return!1}return!0}function th(e,i,o){if(typeof e!="function")throw new Rr(p);return ts(function(){e.apply(r,o)},i)}function Yn(e,i,o,c){var f=-1,y=Gs,E=!0,O=e.length,F=[],J=i.length;if(!O)return F;o&&(i=_t(i,wr(o))),c?(y=xa,E=!1):i.length>=a&&(y=zn,E=!1,i=new Vi(i));e:for(;++f<O;){var Q=e[f],Z=o==null?Q:o(Q);if(Q=c||Q!==0?Q:0,E&&Z===Z){for(var ae=J;ae--;)if(i[ae]===Z)continue e;F.push(Q)}else y(i,Z,c)||F.push(Q)}return F}var Ci=Ch(Xr),rh=Ch(Ha,!0);function jg(e,i){var o=!0;return Ci(e,function(c,f,y){return o=!!i(c,f,y),o}),o}function lo(e,i,o){for(var c=-1,f=e.length;++c<f;){var y=e[c],E=i(y);if(E!=null&&(O===r?E===E&&!Er(E):o(E,O)))var O=E,F=y}return F}function qg(e,i,o,c){var f=e.length;for(o=Me(o),o<0&&(o=-o>f?0:f+o),c=c===r||c>f?f:Me(c),c<0&&(c+=f),c=o>c?0:ml(c);o<c;)e[o++]=i;return e}function ih(e,i){var o=[];return Ci(e,function(c,f,y){i(c,f,y)&&o.push(c)}),o}function Wt(e,i,o,c,f){var y=-1,E=e.length;for(o||(o=C0),f||(f=[]);++y<E;){var O=e[y];i>0&&o(O)?i>1?Wt(O,i-1,o,c,f):xi(f,O):c||(f[f.length]=O)}return f}var qa=Ah(),nh=Ah(!0);function Xr(e,i){return e&&qa(e,i,Vt)}function Ha(e,i){return e&&nh(e,i,Vt)}function fo(e,i){return Si(i,function(o){return pi(e[o])})}function Wi(e,i){i=Ni(i,e);for(var o=0,c=i.length;e!=null&&o<c;)e=e[ei(i[o++])];return o&&o==c?e:r}function sh(e,i,o){var c=i(e);return Te(e)?c:xi(c,o(e))}function ir(e){return e==null?e===r?qe:ke:Bi&&Bi in ut(e)?E0(e):F0(e)}function za(e,i){return e>i}function Hg(e,i){return e!=null&&nt.call(e,i)}function zg(e,i){return e!=null&&i in ut(e)}function Kg(e,i,o){return e>=Jt(i,o)&&e<Bt(i,o)}function Ka(e,i,o){for(var c=o?xa:Gs,f=e[0].length,y=e.length,E=y,O=z(y),F=1/0,J=[];E--;){var Q=e[E];E&&i&&(Q=_t(Q,wr(i))),F=Jt(Q.length,F),O[E]=!o&&(i||f>=120&&Q.length>=120)?new Vi(E&&Q):r}Q=e[0];var Z=-1,ae=O[0];e:for(;++Z<f&&J.length<F;){var ve=Q[Z],be=i?i(ve):ve;if(ve=o||ve!==0?ve:0,!(ae?zn(ae,be):c(J,be,o))){for(E=y;--E;){var He=O[E];if(!(He?zn(He,be):c(e[E],be,o)))continue e}ae&&ae.push(be),J.push(ve)}}return J}function Bg(e,i,o,c){return Xr(e,function(f,y,E){i(c,o(f),y,E)}),c}function Jn(e,i,o){i=Ni(i,e),e=Vh(e,i);var c=e==null?e:e[ei(Fr(i))];return c==null?r:kt(c,e,o)}function oh(e){return Ct(e)&&ir(e)==he}function kg(e){return Ct(e)&&ir(e)==Ie}function Vg(e){return Ct(e)&&ir(e)==A}function Qn(e,i,o,c,f){return e===i?!0:e==null||i==null||!Ct(e)&&!Ct(i)?e!==e&&i!==i:Gg(e,i,o,c,Qn,f)}function Gg(e,i,o,c,f,y){var E=Te(e),O=Te(i),F=E?_e:Qt(e),J=O?_e:Qt(i);F=F==he?De:F,J=J==he?De:J;var Q=F==De,Z=J==De,ae=F==J;if(ae&&Ti(e)){if(!Ti(i))return!1;E=!0,Q=!1}if(ae&&!Q)return y||(y=new Br),E||On(e)?jh(e,i,o,c,f,y):w0(e,i,F,o,c,f,y);if(!(o&H)){var ve=Q&&nt.call(e,"__wrapped__"),be=Z&&nt.call(i,"__wrapped__");if(ve||be){var He=ve?e.value():e,Ee=be?i.value():i;return y||(y=new Br),f(He,Ee,o,c,y)}}return ae?(y||(y=new Br),b0(e,i,o,c,f,y)):!1}function Wg(e){return Ct(e)&&Qt(e)==Se}function Ba(e,i,o,c){var f=o.length,y=f,E=!c;if(e==null)return!y;for(e=ut(e);f--;){var O=o[f];if(E&&O[2]?O[1]!==e[O[0]]:!(O[0]in e))return!1}for(;++f<y;){O=o[f];var F=O[0],J=e[F],Q=O[1];if(E&&O[2]){if(J===r&&!(F in e))return!1}else{var Z=new Br;if(c)var ae=c(J,Q,F,e,i,Z);if(!(ae===r?Qn(Q,J,H|K,c,Z):ae))return!1}}return!0}function ah(e){if(!wt(e)||N0(e))return!1;var i=pi(e)?Wp:ua;return i.test(Ji(e))}function Yg(e){return Ct(e)&&ir(e)==je}function Jg(e){return Ct(e)&&Qt(e)==xe}function Qg(e){return Ct(e)&&No(e.length)&&!!ot[ir(e)]}function ch(e){return typeof e=="function"?e:e==null?gr:typeof e=="object"?Te(e)?lh(e[0],e[1]):hh(e):Nl(e)}function ka(e){if(!es(e))return eg(e);var i=[];for(var o in ut(e))nt.call(e,o)&&o!="constructor"&&i.push(o);return i}function Xg(e){if(!wt(e))return U0(e);var i=es(e),o=[];for(var c in e)c=="constructor"&&(i||!nt.call(e,c))||o.push(c);return o}function Va(e,i){return e<i}function uh(e,i){var o=-1,c=dr(e)?z(e.length):[];return Ci(e,function(f,y,E){c[++o]=i(f,y,E)}),c}function hh(e){var i=ac(e);return i.length==1&&i[0][2]?Bh(i[0][0],i[0][1]):function(o){return o===e||Ba(o,e,i)}}function lh(e,i){return uc(e)&&Kh(i)?Bh(ei(e),i):function(o){var c=mc(o,e);return c===r&&c===i?wc(o,e):Qn(i,c,H|K)}}function po(e,i,o,c,f){e!==i&&qa(i,function(y,E){if(f||(f=new Br),wt(y))Zg(e,i,E,o,po,c,f);else{var O=c?c(lc(e,E),y,E+"",e,i,f):r;O===r&&(O=y),Ma(e,E,O)}},pr)}function Zg(e,i,o,c,f,y,E){var O=lc(e,o),F=lc(i,o),J=E.get(F);if(J){Ma(e,o,J);return}var Q=y?y(O,F,o+"",e,i,E):r,Z=Q===r;if(Z){var ae=Te(F),ve=!ae&&Ti(F),be=!ae&&!ve&&On(F);Q=F,ae||ve||be?Te(O)?Q=O:Rt(O)?Q=fr(O):ve?(Z=!1,Q=Ih(F,!0)):be?(Z=!1,Q=Sh(F,!0)):Q=[]:rs(F)||Qi(F)?(Q=O,Qi(O)?Q=wl(O):(!wt(O)||pi(O))&&(Q=zh(F))):Z=!1}Z&&(E.set(F,Q),f(Q,F,c,y,E),E.delete(F)),Ma(e,o,Q)}function fh(e,i){var o=e.length;if(o)return i+=i<0?o:0,di(i,o)?e[i]:r}function dh(e,i,o){i.length?i=_t(i,function(y){return Te(y)?function(E){return Wi(E,y.length===1?y[0]:y)}:y}):i=[gr];var c=-1;i=_t(i,wr(me()));var f=uh(e,function(y,E,O){var F=_t(i,function(J){return J(y)});return{criteria:F,index:++c,value:y}});return Op(f,function(y,E){return f0(y,E,o)})}function e0(e,i){return ph(e,i,function(o,c){return wc(e,c)})}function ph(e,i,o){for(var c=-1,f=i.length,y={};++c<f;){var E=i[c],O=Wi(e,E);o(O,E)&&Xn(y,Ni(E,e),O)}return y}function t0(e){return function(i){return Wi(i,e)}}function Ga(e,i,o,c){var f=c?xp:gn,y=-1,E=i.length,O=e;for(e===i&&(i=fr(i)),o&&(O=_t(e,wr(o)));++y<E;)for(var F=0,J=i[y],Q=o?o(J):J;(F=f(O,Q,F,c))>-1;)O!==e&&io.call(O,F,1),io.call(e,F,1);return e}function gh(e,i){for(var o=e?i.length:0,c=o-1;o--;){var f=i[o];if(o==c||f!==y){var y=f;di(f)?io.call(e,f,1):Qa(e,f)}}return e}function Wa(e,i){return e+oo(Yu()*(i-e+1))}function r0(e,i,o,c){for(var f=-1,y=Bt(so((i-e)/(o||1)),0),E=z(y);y--;)E[c?y:++f]=e,e+=o;return E}function Ya(e,i){var o="";if(!e||i<1||i>W)return o;do i%2&&(o+=e),i=oo(i/2),i&&(e+=e);while(i);return o}function Be(e,i){return fc(kh(e,i,gr),e+"")}function i0(e){return Xu(Pn(e))}function n0(e,i){var o=Pn(e);return So(o,Gi(i,0,o.length))}function Xn(e,i,o,c){if(!wt(e))return e;i=Ni(i,e);for(var f=-1,y=i.length,E=y-1,O=e;O!=null&&++f<y;){var F=ei(i[f]),J=o;if(F==="__proto__"||F==="constructor"||F==="prototype")return e;if(f!=E){var Q=O[F];J=c?c(Q,F,O):r,J===r&&(J=wt(Q)?Q:di(i[f+1])?[]:{})}Wn(O,F,J),O=O[F]}return e}var vh=ao?function(e,i){return ao.set(e,i),e}:gr,s0=no?function(e,i){return no(e,"toString",{configurable:!0,enumerable:!1,value:Ec(i),writable:!0})}:gr;function o0(e){return So(Pn(e))}function Ur(e,i,o){var c=-1,f=e.length;i<0&&(i=-i>f?0:f+i),o=o>f?f:o,o<0&&(o+=f),f=i>o?0:o-i>>>0,i>>>=0;for(var y=z(f);++c<f;)y[c]=e[c+i];return y}function a0(e,i){var o;return Ci(e,function(c,f,y){return o=i(c,f,y),!o}),!!o}function go(e,i,o){var c=0,f=e==null?c:e.length;if(typeof i=="number"&&i===i&&f<=ie){for(;c<f;){var y=c+f>>>1,E=e[y];E!==null&&!Er(E)&&(o?E<=i:E<i)?c=y+1:f=y}return f}return Ja(e,i,gr,o)}function Ja(e,i,o,c){var f=0,y=e==null?0:e.length;if(y===0)return 0;i=o(i);for(var E=i!==i,O=i===null,F=Er(i),J=i===r;f<y;){var Q=oo((f+y)/2),Z=o(e[Q]),ae=Z!==r,ve=Z===null,be=Z===Z,He=Er(Z);if(E)var Ee=c||be;else J?Ee=be&&(c||ae):O?Ee=be&&ae&&(c||!ve):F?Ee=be&&ae&&!ve&&(c||!He):ve||He?Ee=!1:Ee=c?Z<=i:Z<i;Ee?f=Q+1:y=Q}return Jt(y,Oe)}function yh(e,i){for(var o=-1,c=e.length,f=0,y=[];++o<c;){var E=e[o],O=i?i(E):E;if(!o||!kr(O,F)){var F=O;y[f++]=E===0?0:E}}return y}function _h(e){return typeof e=="number"?e:Er(e)?Y:+e}function br(e){if(typeof e=="string")return e;if(Te(e))return _t(e,br)+"";if(Er(e))return Ju?Ju.call(e):"";var i=e+"";return i=="0"&&1/e==-te?"-0":i}function Ai(e,i,o){var c=-1,f=Gs,y=e.length,E=!0,O=[],F=O;if(o)E=!1,f=xa;else if(y>=a){var J=i?null:_0(e);if(J)return Ys(J);E=!1,f=zn,F=new Vi}else F=i?[]:O;e:for(;++c<y;){var Q=e[c],Z=i?i(Q):Q;if(Q=o||Q!==0?Q:0,E&&Z===Z){for(var ae=F.length;ae--;)if(F[ae]===Z)continue e;i&&F.push(Z),O.push(Q)}else f(F,Z,o)||(F!==O&&F.push(Z),O.push(Q))}return O}function Qa(e,i){return i=Ni(i,e),e=Vh(e,i),e==null||delete e[ei(Fr(i))]}function mh(e,i,o,c){return Xn(e,i,o(Wi(e,i)),c)}function vo(e,i,o,c){for(var f=e.length,y=c?f:-1;(c?y--:++y<f)&&i(e[y],y,e););return o?Ur(e,c?0:y,c?y+1:f):Ur(e,c?y+1:0,c?f:y)}function wh(e,i){var o=e;return o instanceof Ye&&(o=o.value()),Oa(i,function(c,f){return f.func.apply(f.thisArg,xi([c],f.args))},o)}function Xa(e,i,o){var c=e.length;if(c<2)return c?Ai(e[0]):[];for(var f=-1,y=z(c);++f<c;)for(var E=e[f],O=-1;++O<c;)O!=f&&(y[f]=Yn(y[f]||E,e[O],i,o));return Ai(Wt(y,1),i,o)}function bh(e,i,o){for(var c=-1,f=e.length,y=i.length,E={};++c<f;){var O=c<y?i[c]:r;o(E,e[c],O)}return E}function Za(e){return Rt(e)?e:[]}function ec(e){return typeof e=="function"?e:gr}function Ni(e,i){return Te(e)?e:uc(e,i)?[e]:Jh(it(e))}var c0=Be;function Ri(e,i,o){var c=e.length;return o=o===r?c:o,!i&&o>=c?e:Ur(e,i,o)}var Eh=Yp||function(e){return Qe.clearTimeout(e)};function Ih(e,i){if(i)return e.slice();var o=e.length,c=Bu?Bu(o):new e.constructor(o);return e.copy(c),c}function tc(e){var i=new e.constructor(e.byteLength);return new to(i).set(new to(e)),i}function u0(e,i){var o=i?tc(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)}function h0(e){var i=new e.constructor(e.source,Cr.exec(e));return i.lastIndex=e.lastIndex,i}function l0(e){return Gn?ut(Gn.call(e)):{}}function Sh(e,i){var o=i?tc(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)}function xh(e,i){if(e!==i){var o=e!==r,c=e===null,f=e===e,y=Er(e),E=i!==r,O=i===null,F=i===i,J=Er(i);if(!O&&!J&&!y&&e>i||y&&E&&F&&!O&&!J||c&&E&&F||!o&&F||!f)return 1;if(!c&&!y&&!J&&e<i||J&&o&&f&&!c&&!y||O&&o&&f||!E&&f||!F)return-1}return 0}function f0(e,i,o){for(var c=-1,f=e.criteria,y=i.criteria,E=f.length,O=o.length;++c<E;){var F=xh(f[c],y[c]);if(F){if(c>=O)return F;var J=o[c];return F*(J=="desc"?-1:1)}}return e.index-i.index}function Oh(e,i,o,c){for(var f=-1,y=e.length,E=o.length,O=-1,F=i.length,J=Bt(y-E,0),Q=z(F+J),Z=!c;++O<F;)Q[O]=i[O];for(;++f<E;)(Z||f<y)&&(Q[o[f]]=e[f]);for(;J--;)Q[O++]=e[f++];return Q}function Ph(e,i,o,c){for(var f=-1,y=e.length,E=-1,O=o.length,F=-1,J=i.length,Q=Bt(y-O,0),Z=z(Q+J),ae=!c;++f<Q;)Z[f]=e[f];for(var ve=f;++F<J;)Z[ve+F]=i[F];for(;++E<O;)(ae||f<y)&&(Z[ve+o[E]]=e[f++]);return Z}function fr(e,i){var o=-1,c=e.length;for(i||(i=z(c));++o<c;)i[o]=e[o];return i}function Zr(e,i,o,c){var f=!o;o||(o={});for(var y=-1,E=i.length;++y<E;){var O=i[y],F=c?c(o[O],e[O],O,o,e):r;F===r&&(F=e[O]),f?hi(o,O,F):Wn(o,O,F)}return o}function d0(e,i){return Zr(e,cc(e),i)}function p0(e,i){return Zr(e,qh(e),i)}function yo(e,i){return function(o,c){var f=Te(o)?mp:$g,y=i?i():{};return f(o,e,me(c,2),y)}}function In(e){return Be(function(i,o){var c=-1,f=o.length,y=f>1?o[f-1]:r,E=f>2?o[2]:r;for(y=e.length>3&&typeof y=="function"?(f--,y):r,E&&nr(o[0],o[1],E)&&(y=f<3?r:y,f=1),i=ut(i);++c<f;){var O=o[c];O&&e(i,O,c,y)}return i})}function Ch(e,i){return function(o,c){if(o==null)return o;if(!dr(o))return e(o,c);for(var f=o.length,y=i?f:-1,E=ut(o);(i?y--:++y<f)&&c(E[y],y,E)!==!1;);return o}}function Ah(e){return function(i,o,c){for(var f=-1,y=ut(i),E=c(i),O=E.length;O--;){var F=E[e?O:++f];if(o(y[F],F,y)===!1)break}return i}}function g0(e,i,o){var c=i&B,f=Zn(e);function y(){var E=this&&this!==Qe&&this instanceof y?f:e;return E.apply(c?o:this,arguments)}return y}function Nh(e){return function(i){i=it(i);var o=vn(i)?Kr(i):r,c=o?o[0]:i.charAt(0),f=o?Ri(o,1).join(""):i.slice(1);return c[e]()+f}}function Sn(e){return function(i){return Oa(Cl(Pl(i).replace(qn,"")),e,"")}}function Zn(e){return function(){var i=arguments;switch(i.length){case 0:return new e;case 1:return new e(i[0]);case 2:return new e(i[0],i[1]);case 3:return new e(i[0],i[1],i[2]);case 4:return new e(i[0],i[1],i[2],i[3]);case 5:return new e(i[0],i[1],i[2],i[3],i[4]);case 6:return new e(i[0],i[1],i[2],i[3],i[4],i[5]);case 7:return new e(i[0],i[1],i[2],i[3],i[4],i[5],i[6])}var o=En(e.prototype),c=e.apply(o,i);return wt(c)?c:o}}function v0(e,i,o){var c=Zn(e);function f(){for(var y=arguments.length,E=z(y),O=y,F=xn(f);O--;)E[O]=arguments[O];var J=y<3&&E[0]!==F&&E[y-1]!==F?[]:Oi(E,F);if(y-=J.length,y<o)return Fh(e,i,_o,f.placeholder,r,E,J,r,r,o-y);var Q=this&&this!==Qe&&this instanceof f?c:e;return kt(Q,this,E)}return f}function Rh(e){return function(i,o,c){var f=ut(i);if(!dr(i)){var y=me(o,3);i=Vt(i),o=function(O){return y(f[O],O,f)}}var E=e(i,o,c);return E>-1?f[y?i[E]:E]:r}}function Th(e){return fi(function(i){var o=i.length,c=o,f=Tr.prototype.thru;for(e&&i.reverse();c--;){var y=i[c];if(typeof y!="function")throw new Rr(p);if(f&&!E&&Eo(y)=="wrapper")var E=new Tr([],!0)}for(c=E?c:o;++c<o;){y=i[c];var O=Eo(y),F=O=="wrapper"?oc(y):r;F&&hc(F[0])&&F[1]==(u|D|P|_)&&!F[4].length&&F[9]==1?E=E[Eo(F[0])].apply(E,F[3]):E=y.length==1&&hc(y)?E[O]():E.thru(y)}return function(){var J=arguments,Q=J[0];if(E&&J.length==1&&Te(Q))return E.plant(Q).value();for(var Z=0,ae=o?i[Z].apply(this,J):Q;++Z<o;)ae=i[Z].call(this,ae);return ae}})}function _o(e,i,o,c,f,y,E,O,F,J){var Q=i&u,Z=i&B,ae=i&oe,ve=i&(D|S),be=i&G,He=ae?r:Zn(e);function Ee(){for(var Ge=arguments.length,Xe=z(Ge),Ir=Ge;Ir--;)Xe[Ir]=arguments[Ir];if(ve)var sr=xn(Ee),Sr=Cp(Xe,sr);if(c&&(Xe=Oh(Xe,c,f,ve)),y&&(Xe=Ph(Xe,y,E,ve)),Ge-=Sr,ve&&Ge<J){var Tt=Oi(Xe,sr);return Fh(e,i,_o,Ee.placeholder,o,Xe,Tt,O,F,J-Ge)}var Vr=Z?o:this,vi=ae?Vr[e]:e;return Ge=Xe.length,O?Xe=$0(Xe,O):be&&Ge>1&&Xe.reverse(),Q&&F<Ge&&(Xe.length=F),this&&this!==Qe&&this instanceof Ee&&(vi=He||Zn(vi)),vi.apply(Vr,Xe)}return Ee}function Lh(e,i){return function(o,c){return Bg(o,e,i(c),{})}}function mo(e,i){return function(o,c){var f;if(o===r&&c===r)return i;if(o!==r&&(f=o),c!==r){if(f===r)return c;typeof o=="string"||typeof c=="string"?(o=br(o),c=br(c)):(o=_h(o),c=_h(c)),f=e(o,c)}return f}}function rc(e){return fi(function(i){return i=_t(i,wr(me())),Be(function(o){var c=this;return e(i,function(f){return kt(f,c,o)})})})}function wo(e,i){i=i===r?" ":br(i);var o=i.length;if(o<2)return o?Ya(i,e):i;var c=Ya(i,so(e/yn(i)));return vn(i)?Ri(Kr(c),0,e).join(""):c.slice(0,e)}function y0(e,i,o,c){var f=i&B,y=Zn(e);function E(){for(var O=-1,F=arguments.length,J=-1,Q=c.length,Z=z(Q+F),ae=this&&this!==Qe&&this instanceof E?y:e;++J<Q;)Z[J]=c[J];for(;F--;)Z[J++]=arguments[++O];return kt(ae,f?o:this,Z)}return E}function Uh(e){return function(i,o,c){return c&&typeof c!="number"&&nr(i,o,c)&&(o=c=r),i=gi(i),o===r?(o=i,i=0):o=gi(o),c=c===r?i<o?1:-1:gi(c),r0(i,o,c,e)}}function bo(e){return function(i,o){return typeof i=="string"&&typeof o=="string"||(i=$r(i),o=$r(o)),e(i,o)}}function Fh(e,i,o,c,f,y,E,O,F,J){var Q=i&D,Z=Q?E:r,ae=Q?r:E,ve=Q?y:r,be=Q?r:y;i|=Q?P:m,i&=~(Q?m:P),i&R||(i&=~(B|oe));var He=[e,i,f,ve,Z,be,ae,O,F,J],Ee=o.apply(r,He);return hc(e)&&Gh(Ee,He),Ee.placeholder=c,Wh(Ee,e,i)}function ic(e){var i=Kt[e];return function(o,c){if(o=$r(o),c=c==null?0:Jt(Me(c),292),c&&Wu(o)){var f=(it(o)+"e").split("e"),y=i(f[0]+"e"+(+f[1]+c));return f=(it(y)+"e").split("e"),+(f[0]+"e"+(+f[1]-c))}return i(o)}}var _0=wn&&1/Ys(new wn([,-0]))[1]==te?function(e){return new wn(e)}:xc;function $h(e){return function(i){var o=Qt(i);return o==Se?La(i):o==xe?Fp(i):Pp(i,e(i))}}function li(e,i,o,c,f,y,E,O){var F=i&oe;if(!F&&typeof e!="function")throw new Rr(p);var J=c?c.length:0;if(J||(i&=~(P|m),c=f=r),E=E===r?E:Bt(Me(E),0),O=O===r?O:Me(O),J-=f?f.length:0,i&m){var Q=c,Z=f;c=f=r}var ae=F?r:oc(e),ve=[e,i,o,c,f,Q,Z,y,E,O];if(ae&&L0(ve,ae),e=ve[0],i=ve[1],o=ve[2],c=ve[3],f=ve[4],O=ve[9]=ve[9]===r?F?0:e.length:Bt(ve[9]-J,0),!O&&i&(D|S)&&(i&=~(D|S)),!i||i==B)var be=g0(e,i,o);else i==D||i==S?be=v0(e,i,O):(i==P||i==(B|P))&&!f.length?be=y0(e,i,o,c):be=_o.apply(r,ve);var He=ae?vh:Gh;return Wh(He(be,ve),e,i)}function Dh(e,i,o,c){return e===r||kr(e,mn[o])&&!nt.call(c,o)?i:e}function Mh(e,i,o,c,f,y){return wt(e)&&wt(i)&&(y.set(i,e),po(e,i,r,Mh,y),y.delete(i)),e}function m0(e){return rs(e)?r:e}function jh(e,i,o,c,f,y){var E=o&H,O=e.length,F=i.length;if(O!=F&&!(E&&F>O))return!1;var J=y.get(e),Q=y.get(i);if(J&&Q)return J==i&&Q==e;var Z=-1,ae=!0,ve=o&K?new Vi:r;for(y.set(e,i),y.set(i,e);++Z<O;){var be=e[Z],He=i[Z];if(c)var Ee=E?c(He,be,Z,i,e,y):c(be,He,Z,e,i,y);if(Ee!==r){if(Ee)continue;ae=!1;break}if(ve){if(!Pa(i,function(Ge,Xe){if(!zn(ve,Xe)&&(be===Ge||f(be,Ge,o,c,y)))return ve.push(Xe)})){ae=!1;break}}else if(!(be===He||f(be,He,o,c,y))){ae=!1;break}}return y.delete(e),y.delete(i),ae}function w0(e,i,o,c,f,y,E){switch(o){case Ae:if(e.byteLength!=i.byteLength||e.byteOffset!=i.byteOffset)return!1;e=e.buffer,i=i.buffer;case Ie:return!(e.byteLength!=i.byteLength||!y(new to(e),new to(i)));case M:case A:case ze:return kr(+e,+i);case x:return e.name==i.name&&e.message==i.message;case je:case Le:return e==i+"";case Se:var O=La;case xe:var F=c&H;if(O||(O=Ys),e.size!=i.size&&!F)return!1;var J=E.get(e);if(J)return J==i;c|=K,E.set(e,i);var Q=jh(O(e),O(i),c,f,y,E);return E.delete(e),Q;case Ue:if(Gn)return Gn.call(e)==Gn.call(i)}return!1}function b0(e,i,o,c,f,y){var E=o&H,O=nc(e),F=O.length,J=nc(i),Q=J.length;if(F!=Q&&!E)return!1;for(var Z=F;Z--;){var ae=O[Z];if(!(E?ae in i:nt.call(i,ae)))return!1}var ve=y.get(e),be=y.get(i);if(ve&&be)return ve==i&&be==e;var He=!0;y.set(e,i),y.set(i,e);for(var Ee=E;++Z<F;){ae=O[Z];var Ge=e[ae],Xe=i[ae];if(c)var Ir=E?c(Xe,Ge,ae,i,e,y):c(Ge,Xe,ae,e,i,y);if(!(Ir===r?Ge===Xe||f(Ge,Xe,o,c,y):Ir)){He=!1;break}Ee||(Ee=ae=="constructor")}if(He&&!Ee){var sr=e.constructor,Sr=i.constructor;sr!=Sr&&"constructor"in e&&"constructor"in i&&!(typeof sr=="function"&&sr instanceof sr&&typeof Sr=="function"&&Sr instanceof Sr)&&(He=!1)}return y.delete(e),y.delete(i),He}function fi(e){return fc(kh(e,r,el),e+"")}function nc(e){return sh(e,Vt,cc)}function sc(e){return sh(e,pr,qh)}var oc=ao?function(e){return ao.get(e)}:xc;function Eo(e){for(var i=e.name+"",o=bn[i],c=nt.call(bn,i)?o.length:0;c--;){var f=o[c],y=f.func;if(y==null||y==e)return f.name}return i}function xn(e){var i=nt.call(g,"placeholder")?g:e;return i.placeholder}function me(){var e=g.iteratee||Ic;return e=e===Ic?ch:e,arguments.length?e(arguments[0],arguments[1]):e}function Io(e,i){var o=e.__data__;return A0(i)?o[typeof i=="string"?"string":"hash"]:o.map}function ac(e){for(var i=Vt(e),o=i.length;o--;){var c=i[o],f=e[c];i[o]=[c,f,Kh(f)]}return i}function Yi(e,i){var o=Tp(e,i);return ah(o)?o:r}function E0(e){var i=nt.call(e,Bi),o=e[Bi];try{e[Bi]=r;var c=!0}catch{}var f=Zs.call(e);return c&&(i?e[Bi]=o:delete e[Bi]),f}var cc=Fa?function(e){return e==null?[]:(e=ut(e),Si(Fa(e),function(i){return Vu.call(e,i)}))}:Oc,qh=Fa?function(e){for(var i=[];e;)xi(i,cc(e)),e=ro(e);return i}:Oc,Qt=ir;($a&&Qt(new $a(new ArrayBuffer(1)))!=Ae||Bn&&Qt(new Bn)!=Se||Da&&Qt(Da.resolve())!=pt||wn&&Qt(new wn)!=xe||kn&&Qt(new kn)!=Ce)&&(Qt=function(e){var i=ir(e),o=i==De?e.constructor:r,c=o?Ji(o):"";if(c)switch(c){case ng:return Ae;case sg:return Se;case og:return pt;case ag:return xe;case cg:return Ce}return i});function I0(e,i,o){for(var c=-1,f=o.length;++c<f;){var y=o[c],E=y.size;switch(y.type){case"drop":e+=E;break;case"dropRight":i-=E;break;case"take":i=Jt(i,e+E);break;case"takeRight":e=Bt(e,i-E);break}}return{start:e,end:i}}function S0(e){var i=e.match(ht);return i?i[1].split(Mt):[]}function Hh(e,i,o){i=Ni(i,e);for(var c=-1,f=i.length,y=!1;++c<f;){var E=ei(i[c]);if(!(y=e!=null&&o(e,E)))break;e=e[E]}return y||++c!=f?y:(f=e==null?0:e.length,!!f&&No(f)&&di(E,f)&&(Te(e)||Qi(e)))}function x0(e){var i=e.length,o=new e.constructor(i);return i&&typeof e[0]=="string"&&nt.call(e,"index")&&(o.index=e.index,o.input=e.input),o}function zh(e){return typeof e.constructor=="function"&&!es(e)?En(ro(e)):{}}function O0(e,i,o){var c=e.constructor;switch(i){case Ie:return tc(e);case M:case A:return new c(+e);case Ae:return u0(e,o);case Ke:case Pe:case Ve:case We:case et:case tt:case Je:case er:case hr:return Sh(e,o);case Se:return new c;case ze:case Le:return new c(e);case je:return h0(e);case xe:return new c;case Ue:return l0(e)}}function P0(e,i){var o=i.length;if(!o)return e;var c=o-1;return i[c]=(o>1?"& ":"")+i[c],i=i.join(o>2?", ":" "),e.replace(Pt,`{
/* [wrapped with `+i+`] */
`)}function C0(e){return Te(e)||Qi(e)||!!(Gu&&e&&e[Gu])}function di(e,i){var o=typeof e;return i=i??W,!!i&&(o=="number"||o!="symbol"&&la.test(e))&&e>-1&&e%1==0&&e<i}function nr(e,i,o){if(!wt(o))return!1;var c=typeof i;return(c=="number"?dr(o)&&di(i,o.length):c=="string"&&i in o)?kr(o[i],e):!1}function uc(e,i){if(Te(e))return!1;var o=typeof e;return o=="number"||o=="symbol"||o=="boolean"||e==null||Er(e)?!0:Ft.test(e)||!yt.test(e)||i!=null&&e in ut(i)}function A0(e){var i=typeof e;return i=="string"||i=="number"||i=="symbol"||i=="boolean"?e!=="__proto__":e===null}function hc(e){var i=Eo(e),o=g[i];if(typeof o!="function"||!(i in Ye.prototype))return!1;if(e===o)return!0;var c=oc(o);return!!c&&e===c[0]}function N0(e){return!!Ku&&Ku in e}var R0=Qs?pi:Pc;function es(e){var i=e&&e.constructor,o=typeof i=="function"&&i.prototype||mn;return e===o}function Kh(e){return e===e&&!wt(e)}function Bh(e,i){return function(o){return o==null?!1:o[e]===i&&(i!==r||e in ut(o))}}function T0(e){var i=Co(e,function(c){return o.size===b&&o.clear(),c}),o=i.cache;return i}function L0(e,i){var o=e[1],c=i[1],f=o|c,y=f<(B|oe|u),E=c==u&&o==D||c==u&&o==_&&e[7].length<=i[8]||c==(u|_)&&i[7].length<=i[8]&&o==D;if(!(y||E))return e;c&B&&(e[2]=i[2],f|=o&B?0:R);var O=i[3];if(O){var F=e[3];e[3]=F?Oh(F,O,i[4]):O,e[4]=F?Oi(e[3],I):i[4]}return O=i[5],O&&(F=e[5],e[5]=F?Ph(F,O,i[6]):O,e[6]=F?Oi(e[5],I):i[6]),O=i[7],O&&(e[7]=O),c&u&&(e[8]=e[8]==null?i[8]:Jt(e[8],i[8])),e[9]==null&&(e[9]=i[9]),e[0]=i[0],e[1]=f,e}function U0(e){var i=[];if(e!=null)for(var o in ut(e))i.push(o);return i}function F0(e){return Zs.call(e)}function kh(e,i,o){return i=Bt(i===r?e.length-1:i,0),function(){for(var c=arguments,f=-1,y=Bt(c.length-i,0),E=z(y);++f<y;)E[f]=c[i+f];f=-1;for(var O=z(i+1);++f<i;)O[f]=c[f];return O[i]=o(E),kt(e,this,O)}}function Vh(e,i){return i.length<2?e:Wi(e,Ur(i,0,-1))}function $0(e,i){for(var o=e.length,c=Jt(i.length,o),f=fr(e);c--;){var y=i[c];e[c]=di(y,o)?f[y]:r}return e}function lc(e,i){if(!(i==="constructor"&&typeof e[i]=="function")&&i!="__proto__")return e[i]}var Gh=Yh(vh),ts=Qp||function(e,i){return Qe.setTimeout(e,i)},fc=Yh(s0);function Wh(e,i,o){var c=i+"";return fc(e,P0(c,D0(S0(c),o)))}function Yh(e){var i=0,o=0;return function(){var c=tg(),f=ge-(c-o);if(o=c,f>0){if(++i>=ce)return arguments[0]}else i=0;return e.apply(r,arguments)}}function So(e,i){var o=-1,c=e.length,f=c-1;for(i=i===r?c:i;++o<i;){var y=Wa(o,f),E=e[y];e[y]=e[o],e[o]=E}return e.length=i,e}var Jh=T0(function(e){var i=[];return e.charCodeAt(0)===46&&i.push(""),e.replace($t,function(o,c,f,y){i.push(f?y.replace(sa,"$1"):c||o)}),i});function ei(e){if(typeof e=="string"||Er(e))return e;var i=e+"";return i=="0"&&1/e==-te?"-0":i}function Ji(e){if(e!=null){try{return Xs.call(e)}catch{}try{return e+""}catch{}}return""}function D0(e,i){return Nr(we,function(o){var c="_."+o[0];i&o[1]&&!Gs(e,c)&&e.push(c)}),e.sort()}function Qh(e){if(e instanceof Ye)return e.clone();var i=new Tr(e.__wrapped__,e.__chain__);return i.__actions__=fr(e.__actions__),i.__index__=e.__index__,i.__values__=e.__values__,i}function M0(e,i,o){(o?nr(e,i,o):i===r)?i=1:i=Bt(Me(i),0);var c=e==null?0:e.length;if(!c||i<1)return[];for(var f=0,y=0,E=z(so(c/i));f<c;)E[y++]=Ur(e,f,f+=i);return E}function j0(e){for(var i=-1,o=e==null?0:e.length,c=0,f=[];++i<o;){var y=e[i];y&&(f[c++]=y)}return f}function q0(){var e=arguments.length;if(!e)return[];for(var i=z(e-1),o=arguments[0],c=e;c--;)i[c-1]=arguments[c];return xi(Te(o)?fr(o):[o],Wt(i,1))}var H0=Be(function(e,i){return Rt(e)?Yn(e,Wt(i,1,Rt,!0)):[]}),z0=Be(function(e,i){var o=Fr(i);return Rt(o)&&(o=r),Rt(e)?Yn(e,Wt(i,1,Rt,!0),me(o,2)):[]}),K0=Be(function(e,i){var o=Fr(i);return Rt(o)&&(o=r),Rt(e)?Yn(e,Wt(i,1,Rt,!0),r,o):[]});function B0(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:Me(i),Ur(e,i<0?0:i,c)):[]}function k0(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:Me(i),i=c-i,Ur(e,0,i<0?0:i)):[]}function V0(e,i){return e&&e.length?vo(e,me(i,3),!0,!0):[]}function G0(e,i){return e&&e.length?vo(e,me(i,3),!0):[]}function W0(e,i,o,c){var f=e==null?0:e.length;return f?(o&&typeof o!="number"&&nr(e,i,o)&&(o=0,c=f),qg(e,i,o,c)):[]}function Xh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=o==null?0:Me(o);return f<0&&(f=Bt(c+f,0)),Ws(e,me(i,3),f)}function Zh(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=c-1;return o!==r&&(f=Me(o),f=o<0?Bt(c+f,0):Jt(f,c-1)),Ws(e,me(i,3),f,!0)}function el(e){var i=e==null?0:e.length;return i?Wt(e,1):[]}function Y0(e){var i=e==null?0:e.length;return i?Wt(e,te):[]}function J0(e,i){var o=e==null?0:e.length;return o?(i=i===r?1:Me(i),Wt(e,i)):[]}function Q0(e){for(var i=-1,o=e==null?0:e.length,c={};++i<o;){var f=e[i];c[f[0]]=f[1]}return c}function tl(e){return e&&e.length?e[0]:r}function X0(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=o==null?0:Me(o);return f<0&&(f=Bt(c+f,0)),gn(e,i,f)}function Z0(e){var i=e==null?0:e.length;return i?Ur(e,0,-1):[]}var e1=Be(function(e){var i=_t(e,Za);return i.length&&i[0]===e[0]?Ka(i):[]}),t1=Be(function(e){var i=Fr(e),o=_t(e,Za);return i===Fr(o)?i=r:o.pop(),o.length&&o[0]===e[0]?Ka(o,me(i,2)):[]}),r1=Be(function(e){var i=Fr(e),o=_t(e,Za);return i=typeof i=="function"?i:r,i&&o.pop(),o.length&&o[0]===e[0]?Ka(o,r,i):[]});function i1(e,i){return e==null?"":Zp.call(e,i)}function Fr(e){var i=e==null?0:e.length;return i?e[i-1]:r}function n1(e,i,o){var c=e==null?0:e.length;if(!c)return-1;var f=c;return o!==r&&(f=Me(o),f=f<0?Bt(c+f,0):Jt(f,c-1)),i===i?Dp(e,i,f):Ws(e,Fu,f,!0)}function s1(e,i){return e&&e.length?fh(e,Me(i)):r}var o1=Be(rl);function rl(e,i){return e&&e.length&&i&&i.length?Ga(e,i):e}function a1(e,i,o){return e&&e.length&&i&&i.length?Ga(e,i,me(o,2)):e}function c1(e,i,o){return e&&e.length&&i&&i.length?Ga(e,i,r,o):e}var u1=fi(function(e,i){var o=e==null?0:e.length,c=ja(e,i);return gh(e,_t(i,function(f){return di(f,o)?+f:f}).sort(xh)),c});function h1(e,i){var o=[];if(!(e&&e.length))return o;var c=-1,f=[],y=e.length;for(i=me(i,3);++c<y;){var E=e[c];i(E,c,e)&&(o.push(E),f.push(c))}return gh(e,f),o}function dc(e){return e==null?e:ig.call(e)}function l1(e,i,o){var c=e==null?0:e.length;return c?(o&&typeof o!="number"&&nr(e,i,o)?(i=0,o=c):(i=i==null?0:Me(i),o=o===r?c:Me(o)),Ur(e,i,o)):[]}function f1(e,i){return go(e,i)}function d1(e,i,o){return Ja(e,i,me(o,2))}function p1(e,i){var o=e==null?0:e.length;if(o){var c=go(e,i);if(c<o&&kr(e[c],i))return c}return-1}function g1(e,i){return go(e,i,!0)}function v1(e,i,o){return Ja(e,i,me(o,2),!0)}function y1(e,i){var o=e==null?0:e.length;if(o){var c=go(e,i,!0)-1;if(kr(e[c],i))return c}return-1}function _1(e){return e&&e.length?yh(e):[]}function m1(e,i){return e&&e.length?yh(e,me(i,2)):[]}function w1(e){var i=e==null?0:e.length;return i?Ur(e,1,i):[]}function b1(e,i,o){return e&&e.length?(i=o||i===r?1:Me(i),Ur(e,0,i<0?0:i)):[]}function E1(e,i,o){var c=e==null?0:e.length;return c?(i=o||i===r?1:Me(i),i=c-i,Ur(e,i<0?0:i,c)):[]}function I1(e,i){return e&&e.length?vo(e,me(i,3),!1,!0):[]}function S1(e,i){return e&&e.length?vo(e,me(i,3)):[]}var x1=Be(function(e){return Ai(Wt(e,1,Rt,!0))}),O1=Be(function(e){var i=Fr(e);return Rt(i)&&(i=r),Ai(Wt(e,1,Rt,!0),me(i,2))}),P1=Be(function(e){var i=Fr(e);return i=typeof i=="function"?i:r,Ai(Wt(e,1,Rt,!0),r,i)});function C1(e){return e&&e.length?Ai(e):[]}function A1(e,i){return e&&e.length?Ai(e,me(i,2)):[]}function N1(e,i){return i=typeof i=="function"?i:r,e&&e.length?Ai(e,r,i):[]}function pc(e){if(!(e&&e.length))return[];var i=0;return e=Si(e,function(o){if(Rt(o))return i=Bt(o.length,i),!0}),Ra(i,function(o){return _t(e,Ca(o))})}function il(e,i){if(!(e&&e.length))return[];var o=pc(e);return i==null?o:_t(o,function(c){return kt(i,r,c)})}var R1=Be(function(e,i){return Rt(e)?Yn(e,i):[]}),T1=Be(function(e){return Xa(Si(e,Rt))}),L1=Be(function(e){var i=Fr(e);return Rt(i)&&(i=r),Xa(Si(e,Rt),me(i,2))}),U1=Be(function(e){var i=Fr(e);return i=typeof i=="function"?i:r,Xa(Si(e,Rt),r,i)}),F1=Be(pc);function $1(e,i){return bh(e||[],i||[],Wn)}function D1(e,i){return bh(e||[],i||[],Xn)}var M1=Be(function(e){var i=e.length,o=i>1?e[i-1]:r;return o=typeof o=="function"?(e.pop(),o):r,il(e,o)});function nl(e){var i=g(e);return i.__chain__=!0,i}function j1(e,i){return i(e),e}function xo(e,i){return i(e)}var q1=fi(function(e){var i=e.length,o=i?e[0]:0,c=this.__wrapped__,f=function(y){return ja(y,e)};return i>1||this.__actions__.length||!(c instanceof Ye)||!di(o)?this.thru(f):(c=c.slice(o,+o+(i?1:0)),c.__actions__.push({func:xo,args:[f],thisArg:r}),new Tr(c,this.__chain__).thru(function(y){return i&&!y.length&&y.push(r),y}))});function H1(){return nl(this)}function z1(){return new Tr(this.value(),this.__chain__)}function K1(){this.__values__===r&&(this.__values__=_l(this.value()));var e=this.__index__>=this.__values__.length,i=e?r:this.__values__[this.__index__++];return{done:e,value:i}}function B1(){return this}function k1(e){for(var i,o=this;o instanceof uo;){var c=Qh(o);c.__index__=0,c.__values__=r,i?f.__wrapped__=c:i=c;var f=c;o=o.__wrapped__}return f.__wrapped__=e,i}function V1(){var e=this.__wrapped__;if(e instanceof Ye){var i=e;return this.__actions__.length&&(i=new Ye(this)),i=i.reverse(),i.__actions__.push({func:xo,args:[dc],thisArg:r}),new Tr(i,this.__chain__)}return this.thru(dc)}function G1(){return wh(this.__wrapped__,this.__actions__)}var W1=yo(function(e,i,o){nt.call(e,o)?++e[o]:hi(e,o,1)});function Y1(e,i,o){var c=Te(e)?Lu:jg;return o&&nr(e,i,o)&&(i=r),c(e,me(i,3))}function J1(e,i){var o=Te(e)?Si:ih;return o(e,me(i,3))}var Q1=Rh(Xh),X1=Rh(Zh);function Z1(e,i){return Wt(Oo(e,i),1)}function ev(e,i){return Wt(Oo(e,i),te)}function tv(e,i,o){return o=o===r?1:Me(o),Wt(Oo(e,i),o)}function sl(e,i){var o=Te(e)?Nr:Ci;return o(e,me(i,3))}function ol(e,i){var o=Te(e)?wp:rh;return o(e,me(i,3))}var rv=yo(function(e,i,o){nt.call(e,o)?e[o].push(i):hi(e,o,[i])});function iv(e,i,o,c){e=dr(e)?e:Pn(e),o=o&&!c?Me(o):0;var f=e.length;return o<0&&(o=Bt(f+o,0)),Ro(e)?o<=f&&e.indexOf(i,o)>-1:!!f&&gn(e,i,o)>-1}var nv=Be(function(e,i,o){var c=-1,f=typeof i=="function",y=dr(e)?z(e.length):[];return Ci(e,function(E){y[++c]=f?kt(i,E,o):Jn(E,i,o)}),y}),sv=yo(function(e,i,o){hi(e,o,i)});function Oo(e,i){var o=Te(e)?_t:uh;return o(e,me(i,3))}function ov(e,i,o,c){return e==null?[]:(Te(i)||(i=i==null?[]:[i]),o=c?r:o,Te(o)||(o=o==null?[]:[o]),dh(e,i,o))}var av=yo(function(e,i,o){e[o?0:1].push(i)},function(){return[[],[]]});function cv(e,i,o){var c=Te(e)?Oa:Du,f=arguments.length<3;return c(e,me(i,4),o,f,Ci)}function uv(e,i,o){var c=Te(e)?bp:Du,f=arguments.length<3;return c(e,me(i,4),o,f,rh)}function hv(e,i){var o=Te(e)?Si:ih;return o(e,Ao(me(i,3)))}function lv(e){var i=Te(e)?Xu:i0;return i(e)}function fv(e,i,o){(o?nr(e,i,o):i===r)?i=1:i=Me(i);var c=Te(e)?Ug:n0;return c(e,i)}function dv(e){var i=Te(e)?Fg:o0;return i(e)}function pv(e){if(e==null)return 0;if(dr(e))return Ro(e)?yn(e):e.length;var i=Qt(e);return i==Se||i==xe?e.size:ka(e).length}function gv(e,i,o){var c=Te(e)?Pa:a0;return o&&nr(e,i,o)&&(i=r),c(e,me(i,3))}var vv=Be(function(e,i){if(e==null)return[];var o=i.length;return o>1&&nr(e,i[0],i[1])?i=[]:o>2&&nr(i[0],i[1],i[2])&&(i=[i[0]]),dh(e,Wt(i,1),[])}),Po=Jp||function(){return Qe.Date.now()};function yv(e,i){if(typeof i!="function")throw new Rr(p);return e=Me(e),function(){if(--e<1)return i.apply(this,arguments)}}function al(e,i,o){return i=o?r:i,i=e&&i==null?e.length:i,li(e,u,r,r,r,r,i)}function cl(e,i){var o;if(typeof i!="function")throw new Rr(p);return e=Me(e),function(){return--e>0&&(o=i.apply(this,arguments)),e<=1&&(i=r),o}}var gc=Be(function(e,i,o){var c=B;if(o.length){var f=Oi(o,xn(gc));c|=P}return li(e,c,i,o,f)}),ul=Be(function(e,i,o){var c=B|oe;if(o.length){var f=Oi(o,xn(ul));c|=P}return li(i,c,e,o,f)});function hl(e,i,o){i=o?r:i;var c=li(e,D,r,r,r,r,r,i);return c.placeholder=hl.placeholder,c}function ll(e,i,o){i=o?r:i;var c=li(e,S,r,r,r,r,r,i);return c.placeholder=ll.placeholder,c}function fl(e,i,o){var c,f,y,E,O,F,J=0,Q=!1,Z=!1,ae=!0;if(typeof e!="function")throw new Rr(p);i=$r(i)||0,wt(o)&&(Q=!!o.leading,Z="maxWait"in o,y=Z?Bt($r(o.maxWait)||0,i):y,ae="trailing"in o?!!o.trailing:ae);function ve(Tt){var Vr=c,vi=f;return c=f=r,J=Tt,E=e.apply(vi,Vr),E}function be(Tt){return J=Tt,O=ts(Ge,i),Q?ve(Tt):E}function He(Tt){var Vr=Tt-F,vi=Tt-J,Rl=i-Vr;return Z?Jt(Rl,y-vi):Rl}function Ee(Tt){var Vr=Tt-F,vi=Tt-J;return F===r||Vr>=i||Vr<0||Z&&vi>=y}function Ge(){var Tt=Po();if(Ee(Tt))return Xe(Tt);O=ts(Ge,He(Tt))}function Xe(Tt){return O=r,ae&&c?ve(Tt):(c=f=r,E)}function Ir(){O!==r&&Eh(O),J=0,c=F=f=O=r}function sr(){return O===r?E:Xe(Po())}function Sr(){var Tt=Po(),Vr=Ee(Tt);if(c=arguments,f=this,F=Tt,Vr){if(O===r)return be(F);if(Z)return Eh(O),O=ts(Ge,i),ve(F)}return O===r&&(O=ts(Ge,i)),E}return Sr.cancel=Ir,Sr.flush=sr,Sr}var _v=Be(function(e,i){return th(e,1,i)}),mv=Be(function(e,i,o){return th(e,$r(i)||0,o)});function wv(e){return li(e,G)}function Co(e,i){if(typeof e!="function"||i!=null&&typeof i!="function")throw new Rr(p);var o=function(){var c=arguments,f=i?i.apply(this,c):c[0],y=o.cache;if(y.has(f))return y.get(f);var E=e.apply(this,c);return o.cache=y.set(f,E)||y,E};return o.cache=new(Co.Cache||ui),o}Co.Cache=ui;function Ao(e){if(typeof e!="function")throw new Rr(p);return function(){var i=arguments;switch(i.length){case 0:return!e.call(this);case 1:return!e.call(this,i[0]);case 2:return!e.call(this,i[0],i[1]);case 3:return!e.call(this,i[0],i[1],i[2])}return!e.apply(this,i)}}function bv(e){return cl(2,e)}var Ev=c0(function(e,i){i=i.length==1&&Te(i[0])?_t(i[0],wr(me())):_t(Wt(i,1),wr(me()));var o=i.length;return Be(function(c){for(var f=-1,y=Jt(c.length,o);++f<y;)c[f]=i[f].call(this,c[f]);return kt(e,this,c)})}),vc=Be(function(e,i){var o=Oi(i,xn(vc));return li(e,P,r,i,o)}),dl=Be(function(e,i){var o=Oi(i,xn(dl));return li(e,m,r,i,o)}),Iv=fi(function(e,i){return li(e,_,r,r,r,i)});function Sv(e,i){if(typeof e!="function")throw new Rr(p);return i=i===r?i:Me(i),Be(e,i)}function xv(e,i){if(typeof e!="function")throw new Rr(p);return i=i==null?0:Bt(Me(i),0),Be(function(o){var c=o[i],f=Ri(o,0,i);return c&&xi(f,c),kt(e,this,f)})}function Ov(e,i,o){var c=!0,f=!0;if(typeof e!="function")throw new Rr(p);return wt(o)&&(c="leading"in o?!!o.leading:c,f="trailing"in o?!!o.trailing:f),fl(e,i,{leading:c,maxWait:i,trailing:f})}function Pv(e){return al(e,1)}function Cv(e,i){return vc(ec(i),e)}function Av(){if(!arguments.length)return[];var e=arguments[0];return Te(e)?e:[e]}function Nv(e){return Lr(e,N)}function Rv(e,i){return i=typeof i=="function"?i:r,Lr(e,N,i)}function Tv(e){return Lr(e,C|N)}function Lv(e,i){return i=typeof i=="function"?i:r,Lr(e,C|N,i)}function Uv(e,i){return i==null||eh(e,i,Vt(i))}function kr(e,i){return e===i||e!==e&&i!==i}var Fv=bo(za),$v=bo(function(e,i){return e>=i}),Qi=oh(function(){return arguments}())?oh:function(e){return Ct(e)&&nt.call(e,"callee")&&!Vu.call(e,"callee")},Te=z.isArray,Dv=rr?wr(rr):kg;function dr(e){return e!=null&&No(e.length)&&!pi(e)}function Rt(e){return Ct(e)&&dr(e)}function Mv(e){return e===!0||e===!1||Ct(e)&&ir(e)==M}var Ti=Xp||Pc,jv=zr?wr(zr):Vg;function qv(e){return Ct(e)&&e.nodeType===1&&!rs(e)}function Hv(e){if(e==null)return!0;if(dr(e)&&(Te(e)||typeof e=="string"||typeof e.splice=="function"||Ti(e)||On(e)||Qi(e)))return!e.length;var i=Qt(e);if(i==Se||i==xe)return!e.size;if(es(e))return!ka(e).length;for(var o in e)if(nt.call(e,o))return!1;return!0}function zv(e,i){return Qn(e,i)}function Kv(e,i,o){o=typeof o=="function"?o:r;var c=o?o(e,i):r;return c===r?Qn(e,i,r,o):!!c}function yc(e){if(!Ct(e))return!1;var i=ir(e);return i==x||i==h||typeof e.message=="string"&&typeof e.name=="string"&&!rs(e)}function Bv(e){return typeof e=="number"&&Wu(e)}function pi(e){if(!wt(e))return!1;var i=ir(e);return i==ne||i==fe||i==j||i==gt}function pl(e){return typeof e=="number"&&e==Me(e)}function No(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=W}function wt(e){var i=typeof e;return e!=null&&(i=="object"||i=="function")}function Ct(e){return e!=null&&typeof e=="object"}var gl=Ar?wr(Ar):Wg;function kv(e,i){return e===i||Ba(e,i,ac(i))}function Vv(e,i,o){return o=typeof o=="function"?o:r,Ba(e,i,ac(i),o)}function Gv(e){return vl(e)&&e!=+e}function Wv(e){if(R0(e))throw new Ne(l);return ah(e)}function Yv(e){return e===null}function Jv(e){return e==null}function vl(e){return typeof e=="number"||Ct(e)&&ir(e)==ze}function rs(e){if(!Ct(e)||ir(e)!=De)return!1;var i=ro(e);if(i===null)return!0;var o=nt.call(i,"constructor")&&i.constructor;return typeof o=="function"&&o instanceof o&&Xs.call(o)==Vp}var _c=Qr?wr(Qr):Yg;function Qv(e){return pl(e)&&e>=-W&&e<=W}var yl=Hn?wr(Hn):Jg;function Ro(e){return typeof e=="string"||!Te(e)&&Ct(e)&&ir(e)==Le}function Er(e){return typeof e=="symbol"||Ct(e)&&ir(e)==Ue}var On=Ki?wr(Ki):Qg;function Xv(e){return e===r}function Zv(e){return Ct(e)&&Qt(e)==Ce}function ey(e){return Ct(e)&&ir(e)==Fe}var ty=bo(Va),ry=bo(function(e,i){return e<=i});function _l(e){if(!e)return[];if(dr(e))return Ro(e)?Kr(e):fr(e);if(Kn&&e[Kn])return Up(e[Kn]());var i=Qt(e),o=i==Se?La:i==xe?Ys:Pn;return o(e)}function gi(e){if(!e)return e===0?e:0;if(e=$r(e),e===te||e===-te){var i=e<0?-1:1;return i*ee}return e===e?e:0}function Me(e){var i=gi(e),o=i%1;return i===i?o?i-o:i:0}function ml(e){return e?Gi(Me(e),0,re):0}function $r(e){if(typeof e=="number")return e;if(Er(e))return Y;if(wt(e)){var i=typeof e.valueOf=="function"?e.valueOf():e;e=wt(i)?i+"":i}if(typeof e!="string")return e===0?e:+e;e=Mu(e);var o=ca.test(e);return o||ha.test(e)?Re(e.slice(2),o?2:8):aa.test(e)?Y:+e}function wl(e){return Zr(e,pr(e))}function iy(e){return e?Gi(Me(e),-W,W):e===0?e:0}function it(e){return e==null?"":br(e)}var ny=In(function(e,i){if(es(i)||dr(i)){Zr(i,Vt(i),e);return}for(var o in i)nt.call(i,o)&&Wn(e,o,i[o])}),bl=In(function(e,i){Zr(i,pr(i),e)}),To=In(function(e,i,o,c){Zr(i,pr(i),e,c)}),sy=In(function(e,i,o,c){Zr(i,Vt(i),e,c)}),oy=fi(ja);function ay(e,i){var o=En(e);return i==null?o:Zu(o,i)}var cy=Be(function(e,i){e=ut(e);var o=-1,c=i.length,f=c>2?i[2]:r;for(f&&nr(i[0],i[1],f)&&(c=1);++o<c;)for(var y=i[o],E=pr(y),O=-1,F=E.length;++O<F;){var J=E[O],Q=e[J];(Q===r||kr(Q,mn[J])&&!nt.call(e,J))&&(e[J]=y[J])}return e}),uy=Be(function(e){return e.push(r,Mh),kt(El,r,e)});function hy(e,i){return Uu(e,me(i,3),Xr)}function ly(e,i){return Uu(e,me(i,3),Ha)}function fy(e,i){return e==null?e:qa(e,me(i,3),pr)}function dy(e,i){return e==null?e:nh(e,me(i,3),pr)}function py(e,i){return e&&Xr(e,me(i,3))}function gy(e,i){return e&&Ha(e,me(i,3))}function vy(e){return e==null?[]:fo(e,Vt(e))}function yy(e){return e==null?[]:fo(e,pr(e))}function mc(e,i,o){var c=e==null?r:Wi(e,i);return c===r?o:c}function _y(e,i){return e!=null&&Hh(e,i,Hg)}function wc(e,i){return e!=null&&Hh(e,i,zg)}var my=Lh(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Zs.call(i)),e[i]=o},Ec(gr)),wy=Lh(function(e,i,o){i!=null&&typeof i.toString!="function"&&(i=Zs.call(i)),nt.call(e,i)?e[i].push(o):e[i]=[o]},me),by=Be(Jn);function Vt(e){return dr(e)?Qu(e):ka(e)}function pr(e){return dr(e)?Qu(e,!0):Xg(e)}function Ey(e,i){var o={};return i=me(i,3),Xr(e,function(c,f,y){hi(o,i(c,f,y),c)}),o}function Iy(e,i){var o={};return i=me(i,3),Xr(e,function(c,f,y){hi(o,f,i(c,f,y))}),o}var Sy=In(function(e,i,o){po(e,i,o)}),El=In(function(e,i,o,c){po(e,i,o,c)}),xy=fi(function(e,i){var o={};if(e==null)return o;var c=!1;i=_t(i,function(y){return y=Ni(y,e),c||(c=y.length>1),y}),Zr(e,sc(e),o),c&&(o=Lr(o,C|$|N,m0));for(var f=i.length;f--;)Qa(o,i[f]);return o});function Oy(e,i){return Il(e,Ao(me(i)))}var Py=fi(function(e,i){return e==null?{}:e0(e,i)});function Il(e,i){if(e==null)return{};var o=_t(sc(e),function(c){return[c]});return i=me(i),ph(e,o,function(c,f){return i(c,f[0])})}function Cy(e,i,o){i=Ni(i,e);var c=-1,f=i.length;for(f||(f=1,e=r);++c<f;){var y=e==null?r:e[ei(i[c])];y===r&&(c=f,y=o),e=pi(y)?y.call(e):y}return e}function Ay(e,i,o){return e==null?e:Xn(e,i,o)}function Ny(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:Xn(e,i,o,c)}var Sl=$h(Vt),xl=$h(pr);function Ry(e,i,o){var c=Te(e),f=c||Ti(e)||On(e);if(i=me(i,4),o==null){var y=e&&e.constructor;f?o=c?new y:[]:wt(e)?o=pi(y)?En(ro(e)):{}:o={}}return(f?Nr:Xr)(e,function(E,O,F){return i(o,E,O,F)}),o}function Ty(e,i){return e==null?!0:Qa(e,i)}function Ly(e,i,o){return e==null?e:mh(e,i,ec(o))}function Uy(e,i,o,c){return c=typeof c=="function"?c:r,e==null?e:mh(e,i,ec(o),c)}function Pn(e){return e==null?[]:Ta(e,Vt(e))}function Fy(e){return e==null?[]:Ta(e,pr(e))}function $y(e,i,o){return o===r&&(o=i,i=r),o!==r&&(o=$r(o),o=o===o?o:0),i!==r&&(i=$r(i),i=i===i?i:0),Gi($r(e),i,o)}function Dy(e,i,o){return i=gi(i),o===r?(o=i,i=0):o=gi(o),e=$r(e),Kg(e,i,o)}function My(e,i,o){if(o&&typeof o!="boolean"&&nr(e,i,o)&&(i=o=r),o===r&&(typeof i=="boolean"?(o=i,i=r):typeof e=="boolean"&&(o=e,e=r)),e===r&&i===r?(e=0,i=1):(e=gi(e),i===r?(i=e,e=0):i=gi(i)),e>i){var c=e;e=i,i=c}if(o||e%1||i%1){var f=Yu();return Jt(e+f*(i-e+at("1e-"+((f+"").length-1))),i)}return Wa(e,i)}var jy=Sn(function(e,i,o){return i=i.toLowerCase(),e+(o?Ol(i):i)});function Ol(e){return bc(it(e).toLowerCase())}function Pl(e){return e=it(e),e&&e.replace(oi,Ap).replace(Ia,"")}function qy(e,i,o){e=it(e),i=br(i);var c=e.length;o=o===r?c:Gi(Me(o),0,c);var f=o;return o-=i.length,o>=0&&e.slice(o,f)==i}function Hy(e){return e=it(e),e&&vt.test(e)?e.replace(Mi,Np):e}function zy(e){return e=it(e),e&&Dt.test(e)?e.replace(xt,"\\$&"):e}var Ky=Sn(function(e,i,o){return e+(o?"-":"")+i.toLowerCase()}),By=Sn(function(e,i,o){return e+(o?" ":"")+i.toLowerCase()}),ky=Nh("toLowerCase");function Vy(e,i,o){e=it(e),i=Me(i);var c=i?yn(e):0;if(!i||c>=i)return e;var f=(i-c)/2;return wo(oo(f),o)+e+wo(so(f),o)}function Gy(e,i,o){e=it(e),i=Me(i);var c=i?yn(e):0;return i&&c<i?e+wo(i-c,o):e}function Wy(e,i,o){e=it(e),i=Me(i);var c=i?yn(e):0;return i&&c<i?wo(i-c,o)+e:e}function Yy(e,i,o){return o||i==null?i=0:i&&(i=+i),rg(it(e).replace(Ot,""),i||0)}function Jy(e,i,o){return(o?nr(e,i,o):i===r)?i=1:i=Me(i),Ya(it(e),i)}function Qy(){var e=arguments,i=it(e[0]);return e.length<3?i:i.replace(e[1],e[2])}var Xy=Sn(function(e,i,o){return e+(o?"_":"")+i.toLowerCase()});function Zy(e,i,o){return o&&typeof o!="number"&&nr(e,i,o)&&(i=o=r),o=o===r?re:o>>>0,o?(e=it(e),e&&(typeof i=="string"||i!=null&&!_c(i))&&(i=br(i),!i&&vn(e))?Ri(Kr(e),0,o):e.split(i,o)):[]}var e_=Sn(function(e,i,o){return e+(o?" ":"")+bc(i)});function t_(e,i,o){return e=it(e),o=o==null?0:Gi(Me(o),0,e.length),i=br(i),e.slice(o,o+i.length)==i}function r_(e,i,o){var c=g.templateSettings;o&&nr(e,i,o)&&(i=r),e=it(e),i=To({},i,c,Dh);var f=To({},i.imports,c.imports,Dh),y=Vt(f),E=Ta(f,y),O,F,J=0,Q=i.interpolate||cn,Z="__p += '",ae=Ua((i.escape||cn).source+"|"+Q.source+"|"+(Q===mt?oa:cn).source+"|"+(i.evaluate||cn).source+"|$","g"),ve="//# sourceURL="+(nt.call(i,"sourceURL")?(i.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Sa+"]")+`
`;e.replace(ae,function(Ee,Ge,Xe,Ir,sr,Sr){return Xe||(Xe=Ir),Z+=e.slice(J,Sr).replace(fa,Rp),Ge&&(O=!0,Z+=`' +
__e(`+Ge+`) +
'`),sr&&(F=!0,Z+=`';
`+sr+`;
__p += '`),Xe&&(Z+=`' +
((__t = (`+Xe+`)) == null ? '' : __t) +
'`),J=Sr+Ee.length,Ee}),Z+=`';
`;var be=nt.call(i,"variable")&&i.variable;if(!be)Z=`with (obj) {
`+Z+`
}
`;else if(na.test(be))throw new Ne(d);Z=(F?Z.replace(Yr,""):Z).replace(tr,"$1").replace(si,"$1;"),Z="function("+(be||"obj")+`) {
`+(be?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(O?", __e = _.escape":"")+(F?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Z+`return __p
}`;var He=Al(function(){return rt(y,ve+"return "+Z).apply(r,E)});if(He.source=Z,yc(He))throw He;return He}function i_(e){return it(e).toLowerCase()}function n_(e){return it(e).toUpperCase()}function s_(e,i,o){if(e=it(e),e&&(o||i===r))return Mu(e);if(!e||!(i=br(i)))return e;var c=Kr(e),f=Kr(i),y=ju(c,f),E=qu(c,f)+1;return Ri(c,y,E).join("")}function o_(e,i,o){if(e=it(e),e&&(o||i===r))return e.slice(0,zu(e)+1);if(!e||!(i=br(i)))return e;var c=Kr(e),f=qu(c,Kr(i))+1;return Ri(c,0,f).join("")}function a_(e,i,o){if(e=it(e),e&&(o||i===r))return e.replace(Ot,"");if(!e||!(i=br(i)))return e;var c=Kr(e),f=ju(c,Kr(i));return Ri(c,f).join("")}function c_(e,i){var o=V,c=se;if(wt(i)){var f="separator"in i?i.separator:f;o="length"in i?Me(i.length):o,c="omission"in i?br(i.omission):c}e=it(e);var y=e.length;if(vn(e)){var E=Kr(e);y=E.length}if(o>=y)return e;var O=o-yn(c);if(O<1)return c;var F=E?Ri(E,0,O).join(""):e.slice(0,O);if(f===r)return F+c;if(E&&(O+=F.length-O),_c(f)){if(e.slice(O).search(f)){var J,Q=F;for(f.global||(f=Ua(f.source,it(Cr.exec(f))+"g")),f.lastIndex=0;J=f.exec(Q);)var Z=J.index;F=F.slice(0,Z===r?O:Z)}}else if(e.indexOf(br(f),O)!=O){var ae=F.lastIndexOf(f);ae>-1&&(F=F.slice(0,ae))}return F+c}function u_(e){return e=it(e),e&&Et.test(e)?e.replace(Ei,Mp):e}var h_=Sn(function(e,i,o){return e+(o?" ":"")+i.toUpperCase()}),bc=Nh("toUpperCase");function Cl(e,i,o){return e=it(e),i=o?r:i,i===r?Lp(e)?Hp(e):Sp(e):e.match(i)||[]}var Al=Be(function(e,i){try{return kt(e,r,i)}catch(o){return yc(o)?o:new Ne(o)}}),l_=fi(function(e,i){return Nr(i,function(o){o=ei(o),hi(e,o,gc(e[o],e))}),e});function f_(e){var i=e==null?0:e.length,o=me();return e=i?_t(e,function(c){if(typeof c[1]!="function")throw new Rr(p);return[o(c[0]),c[1]]}):[],Be(function(c){for(var f=-1;++f<i;){var y=e[f];if(kt(y[0],this,c))return kt(y[1],this,c)}})}function d_(e){return Mg(Lr(e,C))}function Ec(e){return function(){return e}}function p_(e,i){return e==null||e!==e?i:e}var g_=Th(),v_=Th(!0);function gr(e){return e}function Ic(e){return ch(typeof e=="function"?e:Lr(e,C))}function y_(e){return hh(Lr(e,C))}function __(e,i){return lh(e,Lr(i,C))}var m_=Be(function(e,i){return function(o){return Jn(o,e,i)}}),w_=Be(function(e,i){return function(o){return Jn(e,o,i)}});function Sc(e,i,o){var c=Vt(i),f=fo(i,c);o==null&&!(wt(i)&&(f.length||!c.length))&&(o=i,i=e,e=this,f=fo(i,Vt(i)));var y=!(wt(o)&&"chain"in o)||!!o.chain,E=pi(e);return Nr(f,function(O){var F=i[O];e[O]=F,E&&(e.prototype[O]=function(){var J=this.__chain__;if(y||J){var Q=e(this.__wrapped__),Z=Q.__actions__=fr(this.__actions__);return Z.push({func:F,args:arguments,thisArg:e}),Q.__chain__=J,Q}return F.apply(e,xi([this.value()],arguments))})}),e}function b_(){return Qe._===this&&(Qe._=Gp),this}function xc(){}function E_(e){return e=Me(e),Be(function(i){return fh(i,e)})}var I_=rc(_t),S_=rc(Lu),x_=rc(Pa);function Nl(e){return uc(e)?Ca(ei(e)):t0(e)}function O_(e){return function(i){return e==null?r:Wi(e,i)}}var P_=Uh(),C_=Uh(!0);function Oc(){return[]}function Pc(){return!1}function A_(){return{}}function N_(){return""}function R_(){return!0}function T_(e,i){if(e=Me(e),e<1||e>W)return[];var o=re,c=Jt(e,re);i=me(i),e-=re;for(var f=Ra(c,i);++o<e;)i(o);return f}function L_(e){return Te(e)?_t(e,ei):Er(e)?[e]:fr(Jh(it(e)))}function U_(e){var i=++kp;return it(e)+i}var F_=mo(function(e,i){return e+i},0),$_=ic("ceil"),D_=mo(function(e,i){return e/i},1),M_=ic("floor");function j_(e){return e&&e.length?lo(e,gr,za):r}function q_(e,i){return e&&e.length?lo(e,me(i,2),za):r}function H_(e){return $u(e,gr)}function z_(e,i){return $u(e,me(i,2))}function K_(e){return e&&e.length?lo(e,gr,Va):r}function B_(e,i){return e&&e.length?lo(e,me(i,2),Va):r}var k_=mo(function(e,i){return e*i},1),V_=ic("round"),G_=mo(function(e,i){return e-i},0);function W_(e){return e&&e.length?Na(e,gr):0}function Y_(e,i){return e&&e.length?Na(e,me(i,2)):0}return g.after=yv,g.ary=al,g.assign=ny,g.assignIn=bl,g.assignInWith=To,g.assignWith=sy,g.at=oy,g.before=cl,g.bind=gc,g.bindAll=l_,g.bindKey=ul,g.castArray=Av,g.chain=nl,g.chunk=M0,g.compact=j0,g.concat=q0,g.cond=f_,g.conforms=d_,g.constant=Ec,g.countBy=W1,g.create=ay,g.curry=hl,g.curryRight=ll,g.debounce=fl,g.defaults=cy,g.defaultsDeep=uy,g.defer=_v,g.delay=mv,g.difference=H0,g.differenceBy=z0,g.differenceWith=K0,g.drop=B0,g.dropRight=k0,g.dropRightWhile=V0,g.dropWhile=G0,g.fill=W0,g.filter=J1,g.flatMap=Z1,g.flatMapDeep=ev,g.flatMapDepth=tv,g.flatten=el,g.flattenDeep=Y0,g.flattenDepth=J0,g.flip=wv,g.flow=g_,g.flowRight=v_,g.fromPairs=Q0,g.functions=vy,g.functionsIn=yy,g.groupBy=rv,g.initial=Z0,g.intersection=e1,g.intersectionBy=t1,g.intersectionWith=r1,g.invert=my,g.invertBy=wy,g.invokeMap=nv,g.iteratee=Ic,g.keyBy=sv,g.keys=Vt,g.keysIn=pr,g.map=Oo,g.mapKeys=Ey,g.mapValues=Iy,g.matches=y_,g.matchesProperty=__,g.memoize=Co,g.merge=Sy,g.mergeWith=El,g.method=m_,g.methodOf=w_,g.mixin=Sc,g.negate=Ao,g.nthArg=E_,g.omit=xy,g.omitBy=Oy,g.once=bv,g.orderBy=ov,g.over=I_,g.overArgs=Ev,g.overEvery=S_,g.overSome=x_,g.partial=vc,g.partialRight=dl,g.partition=av,g.pick=Py,g.pickBy=Il,g.property=Nl,g.propertyOf=O_,g.pull=o1,g.pullAll=rl,g.pullAllBy=a1,g.pullAllWith=c1,g.pullAt=u1,g.range=P_,g.rangeRight=C_,g.rearg=Iv,g.reject=hv,g.remove=h1,g.rest=Sv,g.reverse=dc,g.sampleSize=fv,g.set=Ay,g.setWith=Ny,g.shuffle=dv,g.slice=l1,g.sortBy=vv,g.sortedUniq=_1,g.sortedUniqBy=m1,g.split=Zy,g.spread=xv,g.tail=w1,g.take=b1,g.takeRight=E1,g.takeRightWhile=I1,g.takeWhile=S1,g.tap=j1,g.throttle=Ov,g.thru=xo,g.toArray=_l,g.toPairs=Sl,g.toPairsIn=xl,g.toPath=L_,g.toPlainObject=wl,g.transform=Ry,g.unary=Pv,g.union=x1,g.unionBy=O1,g.unionWith=P1,g.uniq=C1,g.uniqBy=A1,g.uniqWith=N1,g.unset=Ty,g.unzip=pc,g.unzipWith=il,g.update=Ly,g.updateWith=Uy,g.values=Pn,g.valuesIn=Fy,g.without=R1,g.words=Cl,g.wrap=Cv,g.xor=T1,g.xorBy=L1,g.xorWith=U1,g.zip=F1,g.zipObject=$1,g.zipObjectDeep=D1,g.zipWith=M1,g.entries=Sl,g.entriesIn=xl,g.extend=bl,g.extendWith=To,Sc(g,g),g.add=F_,g.attempt=Al,g.camelCase=jy,g.capitalize=Ol,g.ceil=$_,g.clamp=$y,g.clone=Nv,g.cloneDeep=Tv,g.cloneDeepWith=Lv,g.cloneWith=Rv,g.conformsTo=Uv,g.deburr=Pl,g.defaultTo=p_,g.divide=D_,g.endsWith=qy,g.eq=kr,g.escape=Hy,g.escapeRegExp=zy,g.every=Y1,g.find=Q1,g.findIndex=Xh,g.findKey=hy,g.findLast=X1,g.findLastIndex=Zh,g.findLastKey=ly,g.floor=M_,g.forEach=sl,g.forEachRight=ol,g.forIn=fy,g.forInRight=dy,g.forOwn=py,g.forOwnRight=gy,g.get=mc,g.gt=Fv,g.gte=$v,g.has=_y,g.hasIn=wc,g.head=tl,g.identity=gr,g.includes=iv,g.indexOf=X0,g.inRange=Dy,g.invoke=by,g.isArguments=Qi,g.isArray=Te,g.isArrayBuffer=Dv,g.isArrayLike=dr,g.isArrayLikeObject=Rt,g.isBoolean=Mv,g.isBuffer=Ti,g.isDate=jv,g.isElement=qv,g.isEmpty=Hv,g.isEqual=zv,g.isEqualWith=Kv,g.isError=yc,g.isFinite=Bv,g.isFunction=pi,g.isInteger=pl,g.isLength=No,g.isMap=gl,g.isMatch=kv,g.isMatchWith=Vv,g.isNaN=Gv,g.isNative=Wv,g.isNil=Jv,g.isNull=Yv,g.isNumber=vl,g.isObject=wt,g.isObjectLike=Ct,g.isPlainObject=rs,g.isRegExp=_c,g.isSafeInteger=Qv,g.isSet=yl,g.isString=Ro,g.isSymbol=Er,g.isTypedArray=On,g.isUndefined=Xv,g.isWeakMap=Zv,g.isWeakSet=ey,g.join=i1,g.kebabCase=Ky,g.last=Fr,g.lastIndexOf=n1,g.lowerCase=By,g.lowerFirst=ky,g.lt=ty,g.lte=ry,g.max=j_,g.maxBy=q_,g.mean=H_,g.meanBy=z_,g.min=K_,g.minBy=B_,g.stubArray=Oc,g.stubFalse=Pc,g.stubObject=A_,g.stubString=N_,g.stubTrue=R_,g.multiply=k_,g.nth=s1,g.noConflict=b_,g.noop=xc,g.now=Po,g.pad=Vy,g.padEnd=Gy,g.padStart=Wy,g.parseInt=Yy,g.random=My,g.reduce=cv,g.reduceRight=uv,g.repeat=Jy,g.replace=Qy,g.result=Cy,g.round=V_,g.runInContext=U,g.sample=lv,g.size=pv,g.snakeCase=Xy,g.some=gv,g.sortedIndex=f1,g.sortedIndexBy=d1,g.sortedIndexOf=p1,g.sortedLastIndex=g1,g.sortedLastIndexBy=v1,g.sortedLastIndexOf=y1,g.startCase=e_,g.startsWith=t_,g.subtract=G_,g.sum=W_,g.sumBy=Y_,g.template=r_,g.times=T_,g.toFinite=gi,g.toInteger=Me,g.toLength=ml,g.toLower=i_,g.toNumber=$r,g.toSafeInteger=iy,g.toString=it,g.toUpper=n_,g.trim=s_,g.trimEnd=o_,g.trimStart=a_,g.truncate=c_,g.unescape=u_,g.uniqueId=U_,g.upperCase=h_,g.upperFirst=bc,g.each=sl,g.eachRight=ol,g.first=tl,Sc(g,function(){var e={};return Xr(g,function(i,o){nt.call(g.prototype,o)||(e[o]=i)}),e}(),{chain:!1}),g.VERSION=s,Nr(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){g[e].placeholder=g}),Nr(["drop","take"],function(e,i){Ye.prototype[e]=function(o){o=o===r?1:Bt(Me(o),0);var c=this.__filtered__&&!i?new Ye(this):this.clone();return c.__filtered__?c.__takeCount__=Jt(o,c.__takeCount__):c.__views__.push({size:Jt(o,re),type:e+(c.__dir__<0?"Right":"")}),c},Ye.prototype[e+"Right"]=function(o){return this.reverse()[e](o).reverse()}}),Nr(["filter","map","takeWhile"],function(e,i){var o=i+1,c=o==T||o==le;Ye.prototype[e]=function(f){var y=this.clone();return y.__iteratees__.push({iteratee:me(f,3),type:o}),y.__filtered__=y.__filtered__||c,y}}),Nr(["head","last"],function(e,i){var o="take"+(i?"Right":"");Ye.prototype[e]=function(){return this[o](1).value()[0]}}),Nr(["initial","tail"],function(e,i){var o="drop"+(i?"":"Right");Ye.prototype[e]=function(){return this.__filtered__?new Ye(this):this[o](1)}}),Ye.prototype.compact=function(){return this.filter(gr)},Ye.prototype.find=function(e){return this.filter(e).head()},Ye.prototype.findLast=function(e){return this.reverse().find(e)},Ye.prototype.invokeMap=Be(function(e,i){return typeof e=="function"?new Ye(this):this.map(function(o){return Jn(o,e,i)})}),Ye.prototype.reject=function(e){return this.filter(Ao(me(e)))},Ye.prototype.slice=function(e,i){e=Me(e);var o=this;return o.__filtered__&&(e>0||i<0)?new Ye(o):(e<0?o=o.takeRight(-e):e&&(o=o.drop(e)),i!==r&&(i=Me(i),o=i<0?o.dropRight(-i):o.take(i-e)),o)},Ye.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},Ye.prototype.toArray=function(){return this.take(re)},Xr(Ye.prototype,function(e,i){var o=/^(?:filter|find|map|reject)|While$/.test(i),c=/^(?:head|last)$/.test(i),f=g[c?"take"+(i=="last"?"Right":""):i],y=c||/^find/.test(i);f&&(g.prototype[i]=function(){var E=this.__wrapped__,O=c?[1]:arguments,F=E instanceof Ye,J=O[0],Q=F||Te(E),Z=function(Ge){var Xe=f.apply(g,xi([Ge],O));return c&&ae?Xe[0]:Xe};Q&&o&&typeof J=="function"&&J.length!=1&&(F=Q=!1);var ae=this.__chain__,ve=!!this.__actions__.length,be=y&&!ae,He=F&&!ve;if(!y&&Q){E=He?E:new Ye(this);var Ee=e.apply(E,O);return Ee.__actions__.push({func:xo,args:[Z],thisArg:r}),new Tr(Ee,ae)}return be&&He?e.apply(this,O):(Ee=this.thru(Z),be?c?Ee.value()[0]:Ee.value():Ee)})}),Nr(["pop","push","shift","sort","splice","unshift"],function(e){var i=Js[e],o=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",c=/^(?:pop|shift)$/.test(e);g.prototype[e]=function(){var f=arguments;if(c&&!this.__chain__){var y=this.value();return i.apply(Te(y)?y:[],f)}return this[o](function(E){return i.apply(Te(E)?E:[],f)})}}),Xr(Ye.prototype,function(e,i){var o=g[i];if(o){var c=o.name+"";nt.call(bn,c)||(bn[c]=[]),bn[c].push({name:i,func:o})}}),bn[_o(r,oe).name]=[{name:"wrapper",func:r}],Ye.prototype.clone=ug,Ye.prototype.reverse=hg,Ye.prototype.value=lg,g.prototype.at=q1,g.prototype.chain=H1,g.prototype.commit=z1,g.prototype.next=K1,g.prototype.plant=k1,g.prototype.reverse=V1,g.prototype.toJSON=g.prototype.valueOf=g.prototype.value=G1,g.prototype.first=g.prototype.head,Kn&&(g.prototype[Kn]=B1),g},_n=zp();Nt?((Nt.exports=_n)._=_n,ct._=_n):Qe._=_n}).call(ps)})(au,au.exports);var U5=Object.defineProperty,F5=Object.defineProperties,$5=Object.getOwnPropertyDescriptors,rd=Object.getOwnPropertySymbols,D5=Object.prototype.hasOwnProperty,M5=Object.prototype.propertyIsEnumerable,id=(n,t,r)=>t in n?U5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,Fo=(n,t)=>{for(var r in t||(t={}))D5.call(t,r)&&id(n,r,t[r]);if(rd)for(var r of rd(t))M5.call(t,r)&&id(n,r,t[r]);return n},j5=(n,t)=>F5(n,$5(t));function Mr(n,t,r){let s;const a=cu(n);return t.rpcMap&&(s=t.rpcMap[a]),s||(s=`${L5}?chainId=eip155:${a}&projectId=${r}`),s}function cu(n){return n.includes("eip155")?Number(n.split(":")[1]):Number(n)}function yp(n){return n.map(t=>`${t.split(":")[0]}:${t.split(":")[1]}`)}function q5(n,t){const r=Object.keys(t.namespaces).filter(a=>a.includes(n));if(!r.length)return[];const s=[];return r.forEach(a=>{const l=t.namespaces[a].accounts;s.push(...l)}),s}function H5(n={},t={}){const r=nd(n),s=nd(t);return au.exports.merge(r,s)}function nd(n){var t,r,s,a;const l={};if(!Ln(n))return l;for(const[p,d]of Object.entries(n)){const v=Eu(p)?[p]:d.chains,b=d.methods||[],I=d.events||[],C=d.rpcMap||{},$=gs(p);l[$]=j5(Fo(Fo({},l[$]),d),{chains:Dc(v,(t=l[$])==null?void 0:t.chains),methods:Dc(b,(r=l[$])==null?void 0:r.methods),events:Dc(I,(s=l[$])==null?void 0:s.events),rpcMap:Fo(Fo({},C),(a=l[$])==null?void 0:a.rpcMap)})}return l}function z5(n){return n.includes(":")?n.split(":")[2]:n}function K5(n){const t={};for(const[r,s]of Object.entries(n)){const a=s.methods||[],l=s.events||[],p=s.accounts||[],d=Eu(r)?[r]:s.chains?s.chains:yp(s.accounts);t[r]={chains:d,methods:a,events:l,accounts:p}}return t}function Bc(n){return typeof n=="number"?n:n.includes("0x")?parseInt(n,16):n.includes(":")?Number(n.split(":")[1]):Number(n)}const _p={},Ut=n=>_p[n],kc=(n,t)=>{_p[n]=t};class B5{constructor(t){this.name="polkadot",this.namespace=t.namespace,this.events=Ut("events"),this.client=Ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2])||[]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace);return typeof s>"u"?void 0:new $i(new an(s,Ut("disableProviderPing")))}}class k5{constructor(t){this.name="eip155",this.namespace=t.namespace,this.events=Ut("events"),this.client=Ut("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(t){switch(t.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(t);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(t.request.method)?await this.client.request(t):this.getHttpProvider().request(t.request)}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}setDefaultChain(t,r){const s=cu(t);if(!this.httpProviders[s]){const a=r||Mr(`${this.name}:${s}`,this.namespace,this.client.core.projectId);if(!a)throw new Error(`No RPC url provided for chainId: ${s}`);this.setHttpProvider(s,a)}this.chainId=s,this.events.emit(Di.DEFAULT_CHAIN_CHANGED,`${this.name}:${s}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}createHttpProvider(t,r){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new $i(new an(s,Ut("disableProviderPing")))}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;const a=cu(r);t[a]=this.createHttpProvider(a,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}getHttpProvider(){const t=this.chainId,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}async handleSwitchChain(t){var r,s;let a=t.request.params?(r=t.request.params[0])==null?void 0:r.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const l=parseInt(a,16);if(this.isChainApproved(l))this.setDefaultChain(`${l}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:t.topic,request:{method:t.request.method,params:[{chainId:a}]},chainId:(s=this.namespace.chains)==null?void 0:s[0]}),this.setDefaultChain(`${l}`);else throw new Error(`Failed to switch to chain 'eip155:${l}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(t){return this.namespace.chains.includes(`${this.name}:${t}`)}}class V5{constructor(t){this.name="solana",this.namespace=t.namespace,this.events=Ut("events"),this.client=Ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new $i(new an(s,Ut("disableProviderPing")))}}class G5{constructor(t){this.name="cosmos",this.namespace=t.namespace,this.events=Ut("events"),this.client=Ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new $i(new an(s,Ut("disableProviderPing")))}}class W5{constructor(t){this.name="cip34",this.namespace=t.namespace,this.events=Ut("events"),this.client=Ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(this.chainId=t,!this.httpProviders[t]){const s=r||this.getCardanoRPCUrl(t);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.events.emit(Di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{const s=this.getCardanoRPCUrl(r);t[r]=this.createHttpProvider(r,s)}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}getCardanoRPCUrl(t){const r=this.namespace.rpcMap;if(r)return r[t]}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||this.getCardanoRPCUrl(t);return typeof s>"u"?void 0:new $i(new an(s,Ut("disableProviderPing")))}}class Y5{constructor(t){this.name="elrond",this.namespace=t.namespace,this.events=Ut("events"),this.client=Ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new $i(new an(s,Ut("disableProviderPing")))}}class J5{constructor(t){this.name="multiversx",this.namespace=t.namespace,this.events=Ut("events"),this.client=Ut("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(t){this.namespace=Object.assign(this.namespace,t)}requestAccounts(){return this.getAccounts()}request(t){return this.namespace.methods.includes(t.request.method)?this.client.request(t):this.getHttpProvider().request(t.request)}setDefaultChain(t,r){if(!this.httpProviders[t]){const s=r||Mr(`${this.name}:${t}`,this.namespace,this.client.core.projectId);if(!s)throw new Error(`No RPC url provided for chainId: ${t}`);this.setHttpProvider(t,s)}this.chainId=t,this.events.emit(Di.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const t=this.namespace.chains[0];if(!t)throw new Error("ChainId not found");return t.split(":")[1]}getAccounts(){const t=this.namespace.accounts;return t?[...new Set(t.filter(r=>r.split(":")[1]===this.chainId.toString()).map(r=>r.split(":")[2]))]:[]}createHttpProviders(){const t={};return this.namespace.chains.forEach(r=>{var s;t[r]=this.createHttpProvider(r,(s=this.namespace.rpcMap)==null?void 0:s[r])}),t}getHttpProvider(){const t=`${this.name}:${this.chainId}`,r=this.httpProviders[t];if(typeof r>"u")throw new Error(`JSON-RPC provider for ${t} not found`);return r}setHttpProvider(t,r){const s=this.createHttpProvider(t,r);s&&(this.httpProviders[t]=s)}createHttpProvider(t,r){const s=r||Mr(t,this.namespace,this.client.core.projectId);return typeof s>"u"?void 0:new $i(new an(s,Ut("disableProviderPing")))}}var Q5=Object.defineProperty,X5=Object.defineProperties,Z5=Object.getOwnPropertyDescriptors,sd=Object.getOwnPropertySymbols,e3=Object.prototype.hasOwnProperty,t3=Object.prototype.propertyIsEnumerable,od=(n,t,r)=>t in n?Q5(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,$o=(n,t)=>{for(var r in t||(t={}))e3.call(t,r)&&od(n,r,t[r]);if(sd)for(var r of sd(t))t3.call(t,r)&&od(n,r,t[r]);return n},Vc=(n,t)=>X5(n,Z5(t));class Ru{constructor(t){this.events=new lu,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=t,this.logger=typeof(t==null?void 0:t.logger)<"u"&&typeof(t==null?void 0:t.logger)!="string"?t.logger:Ze.pino(Ze.getDefaultLoggerOptions({level:(t==null?void 0:t.logger)||ed})),this.disableProviderPing=(t==null?void 0:t.disableProviderPing)||!1}static async init(t){const r=new Ru(t);return await r.initialize(),r}async request(t,r){const[s,a]=this.validateChain(r);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(s).request({request:$o({},t),chainId:`${s}:${a}`,topic:this.session.topic})}sendAsync(t,r,s){this.request(t,s).then(a=>r(null,a)).catch(a=>r(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var t;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(t=this.session)==null?void 0:t.topic,reason:Lt("USER_DISCONNECTED")}),await this.cleanup()}async connect(t){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(t),await this.cleanupPendingPairings(),!t.skipPairing)return await this.pair(t.pairingTopic)}on(t,r){this.events.on(t,r)}once(t,r){this.events.once(t,r)}removeListener(t,r){this.events.removeListener(t,r)}off(t,r){this.events.off(t,r)}get isWalletConnect(){return!0}async pair(t){this.shouldAbortPairingAttempt=!1;let r=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(r>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:s,approval:a}=await this.client.connect({pairingTopic:t,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});s&&(this.uri=s,this.events.emit("display_uri",s)),await a().then(l=>{this.session=l,this.namespaces||(this.namespaces=K5(l.namespaces),this.persist("namespaces",this.namespaces))}).catch(l=>{if(l.message!==gp)throw l;r++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(t,r){try{if(!this.session)return;const[s,a]=this.validateChain(t);this.getProvider(s).setDefaultChain(a,r)}catch(s){if(!/Please call connect/.test(s.message))throw s}}async cleanupPendingPairings(t={}){this.logger.info("Cleaning up inactive pairings...");const r=this.client.pairing.getAll();if(ni(r)){for(const s of r)t.deletePairings?this.client.core.expirer.set(s.topic,0):await this.client.core.relayer.subscriber.unsubscribe(s.topic);this.logger.info(`Inactive pairings cleared: ${r.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const t=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[t]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await P5.init({logger:this.providerOpts.logger||ed,relayUrl:this.providerOpts.relayUrl||N5,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const t=[...new Set(Object.keys(this.session.namespaces).map(r=>gs(r)))];kc("client",this.client),kc("events",this.events),kc("disableProviderPing",this.disableProviderPing),t.forEach(r=>{if(!this.session)return;const s=q5(r,this.session),a=yp(s),l=H5(this.namespaces,this.optionalNamespaces),p=Vc($o({},l[r]),{accounts:s,chains:a});switch(r){case"eip155":this.rpcProviders[r]=new k5({namespace:p});break;case"solana":this.rpcProviders[r]=new V5({namespace:p});break;case"cosmos":this.rpcProviders[r]=new G5({namespace:p});break;case"polkadot":this.rpcProviders[r]=new B5({namespace:p});break;case"cip34":this.rpcProviders[r]=new W5({namespace:p});break;case"elrond":this.rpcProviders[r]=new Y5({namespace:p});break;case"multiversx":this.rpcProviders[r]=new J5({namespace:p});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",t=>{this.events.emit("session_ping",t)}),this.client.on("session_event",t=>{const{params:r}=t,{event:s}=r;if(s.name==="accountsChanged"){const a=s.data;a&&ni(a)&&this.events.emit("accountsChanged",a.map(z5))}else if(s.name==="chainChanged"){const a=r.chainId,l=r.event.data,p=gs(a),d=Bc(a)!==Bc(l)?`${p}:${Bc(l)}`:a;this.onChainChanged(d)}else this.events.emit(s.name,s.data);this.events.emit("session_event",t)}),this.client.on("session_update",({topic:t,params:r})=>{var s;const{namespaces:a}=r,l=(s=this.client)==null?void 0:s.session.get(t);this.session=Vc($o({},l),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:t,params:r})}),this.client.on("session_delete",async t=>{await this.cleanup(),this.events.emit("session_delete",t),this.events.emit("disconnect",Vc($o({},Lt("USER_DISCONNECTED")),{data:t.topic}))}),this.on(Di.DEFAULT_CHAIN_CHANGED,t=>{this.onChainChanged(t,!0)})}getProvider(t){if(!this.rpcProviders[t])throw new Error(`Provider not found: ${t}`);return this.rpcProviders[t]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(t=>{var r;this.getProvider(t).updateNamespace((r=this.session)==null?void 0:r.namespaces[t])})}setNamespaces(t){const{namespaces:r,optionalNamespaces:s,sessionProperties:a}=t;r&&Object.keys(r).length&&(this.namespaces=r),s&&Object.keys(s).length&&(this.optionalNamespaces=s),this.sessionProperties=a,this.persist("namespaces",r),this.persist("optionalNamespaces",s)}validateChain(t){const[r,s]=(t==null?void 0:t.split(":"))||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[r,s];if(r&&!Object.keys(this.namespaces||{}).map(p=>gs(p)).includes(r))throw new Error(`Namespace '${r}' is not configured. Please call connect() first with namespace config.`);if(r&&s)return[r,s];const a=gs(Object.keys(this.namespaces)[0]),l=this.rpcProviders[a].getDefaultChain();return[a,l]}async requestAccounts(){const[t]=this.validateChain();return await this.getProvider(t).requestAccounts()}onChainChanged(t,r=!1){var s;if(!this.namespaces)return;const[a,l]=this.validateChain(t);r||this.getProvider(a).setDefaultChain(l),((s=this.namespaces[a])!=null?s:this.namespaces[`${a}:${l}`]).defaultChain=l,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",l)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(t,r){this.client.core.storage.setItem(`${td}/${t}`,r)}async getFromStore(t){return await this.client.core.storage.getItem(`${td}/${t}`)}}const r3=Ru,i3="wc",n3="ethereum_provider",s3=`${i3}@2:${n3}:`,o3="https://rpc.walletconnect.com/v1/",uu=["eth_sendTransaction","personal_sign"],a3=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],hu=["chainChanged","accountsChanged"],c3=["message","disconnect","connect"];var u3=Object.defineProperty,h3=Object.defineProperties,l3=Object.getOwnPropertyDescriptors,ad=Object.getOwnPropertySymbols,f3=Object.prototype.hasOwnProperty,d3=Object.prototype.propertyIsEnumerable,cd=(n,t,r)=>t in n?u3(n,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):n[t]=r,vs=(n,t)=>{for(var r in t||(t={}))f3.call(t,r)&&cd(n,r,t[r]);if(ad)for(var r of ad(t))d3.call(t,r)&&cd(n,r,t[r]);return n},ud=(n,t)=>h3(n,l3(t));function Vo(n){return Number(n[0].split(":")[1])}function Gc(n){return`0x${n.toString(16)}`}function p3(n){const{chains:t,optionalChains:r,methods:s,optionalMethods:a,events:l,optionalEvents:p,rpcMap:d}=n;if(!ni(t))throw new Error("Invalid chains");const v={chains:t,methods:s||uu,events:l||hu,rpcMap:vs({},t.length?{[Vo(t)]:d[Vo(t)]}:{})},b=l==null?void 0:l.filter(N=>!hu.includes(N)),I=s==null?void 0:s.filter(N=>!uu.includes(N));if(!r&&!p&&!a&&!(b!=null&&b.length)&&!(I!=null&&I.length))return{required:t.length?v:void 0};const C=(b==null?void 0:b.length)&&(I==null?void 0:I.length)||!r,$={chains:[...new Set(C?v.chains.concat(r||[]):r)],methods:[...new Set(v.methods.concat(a!=null&&a.length?a:a3))],events:[...new Set(v.events.concat(p||c3))],rpcMap:d};return{required:t.length?v:void 0,optional:r.length?$:void 0}}class Tu{constructor(){this.events=new jr.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=s3,this.on=(t,r)=>(this.events.on(t,r),this),this.once=(t,r)=>(this.events.once(t,r),this),this.removeListener=(t,r)=>(this.events.removeListener(t,r),this),this.off=(t,r)=>(this.events.off(t,r),this),this.parseAccount=t=>this.isCompatibleChainId(t)?this.parseAccountId(t).address:t,this.signer={},this.rpc={}}static async init(t){const r=new Tu;return await r.initialize(t),r}async request(t){return await this.signer.request(t,this.formatChainId(this.chainId))}sendAsync(t,r){this.signer.sendAsync(t,r,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(t){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(t);const{required:r,optional:s}=p3(this.rpc);try{const a=await new Promise(async(p,d)=>{var v;this.rpc.showQrModal&&((v=this.modal)==null||v.subscribeModal(b=>{!b.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),d(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(ud(vs({namespaces:vs({},r&&{[this.namespace]:r})},s&&{optionalNamespaces:{[this.namespace]:s}}),{pairingTopic:t==null?void 0:t.pairingTopic})).then(b=>{p(b)}).catch(b=>{d(new Error(b.message))})});if(!a)return;const l=nb(a.namespaces,[this.namespace]);this.setChainIds(this.rpc.chains.length?this.rpc.chains:l),this.setAccounts(l),this.events.emit("connect",{chainId:Gc(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",t=>{const{params:r}=t,{event:s}=r;s.name==="accountsChanged"?(this.accounts=this.parseAccounts(s.data),this.events.emit("accountsChanged",this.accounts)):s.name==="chainChanged"?this.setChainId(this.formatChainId(s.data)):this.events.emit(s.name,s.data),this.events.emit("session_event",t)}),this.signer.on("chainChanged",t=>{const r=parseInt(t);this.chainId=r,this.events.emit("chainChanged",Gc(this.chainId)),this.persist()}),this.signer.on("session_update",t=>{this.events.emit("session_update",t)}),this.signer.on("session_delete",t=>{this.reset(),this.events.emit("session_delete",t),this.events.emit("disconnect",ud(vs({},Lt("USER_DISCONNECTED")),{data:t.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",t=>{var r,s;this.rpc.showQrModal&&((r=this.modal)==null||r.closeModal(),(s=this.modal)==null||s.openModal({uri:t})),this.events.emit("display_uri",t)})}switchEthereumChain(t){this.request({method:"wallet_switchEthereumChain",params:[{chainId:t.toString(16)}]})}isCompatibleChainId(t){return typeof t=="string"?t.startsWith(`${this.namespace}:`):!1}formatChainId(t){return`${this.namespace}:${t}`}parseChainId(t){return Number(t.split(":")[1])}setChainIds(t){const r=t.filter(s=>this.isCompatibleChainId(s)).map(s=>this.parseChainId(s));r.length&&(this.chainId=r[0],this.events.emit("chainChanged",Gc(this.chainId)),this.persist())}setChainId(t){if(this.isCompatibleChainId(t)){const r=this.parseChainId(t);this.chainId=r,this.switchEthereumChain(r)}}parseAccountId(t){const[r,s,a]=t.split(":");return{chainId:`${r}:${s}`,address:a}}setAccounts(t){this.accounts=t.filter(r=>this.parseChainId(this.parseAccountId(r).chainId)===this.chainId).map(r=>this.parseAccountId(r).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(t){var r,s;const a=(r=t==null?void 0:t.chains)!=null?r:[],l=(s=t==null?void 0:t.optionalChains)!=null?s:[],p=a.concat(l);if(!p.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const d=a.length?(t==null?void 0:t.methods)||uu:[],v=a.length?(t==null?void 0:t.events)||hu:[],b=(t==null?void 0:t.optionalMethods)||[],I=(t==null?void 0:t.optionalEvents)||[],C=(t==null?void 0:t.rpcMap)||this.buildRpcMap(p,t.projectId),$=(t==null?void 0:t.qrModalOptions)||void 0;return{chains:a==null?void 0:a.map(N=>this.formatChainId(N)),optionalChains:l.map(N=>this.formatChainId(N)),methods:d,events:v,optionalMethods:b,optionalEvents:I,rpcMap:C,showQrModal:!!(t!=null&&t.showQrModal),qrModalOptions:$,projectId:t.projectId,metadata:t.metadata}}buildRpcMap(t,r){const s={};return t.forEach(a=>{s[a]=this.getRpcUrl(a,r)}),s}async initialize(t){if(this.rpc=this.getRpcConfig(t),this.chainId=this.rpc.chains.length?Vo(this.rpc.chains):Vo(this.rpc.optionalChains),this.signer=await r3.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:t.disableProviderPing,relayUrl:t.relayUrl,storageOptions:t.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let r;try{const{WalletConnectModal:s}=await Z_(()=>import("./index-2f1138c9.js").then(a=>a.i),["assets/index-2f1138c9.js","assets/index-bee7d828.js","assets/index-2ef0605c.css"]);r=s}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(r)try{this.modal=new r(vs({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(s){throw this.signer.logger.error(s),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(t){if(!t)return;const{chains:r,optionalChains:s,rpcMap:a}=t;r&&ni(r)&&(this.rpc.chains=r.map(l=>this.formatChainId(l)),r.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)})),s&&ni(s)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=s==null?void 0:s.map(l=>this.formatChainId(l)),s.forEach(l=>{this.rpc.rpcMap[l]=(a==null?void 0:a[l])||this.getRpcUrl(l)}))}getRpcUrl(t,r){var s;return((s=this.rpc.rpcMap)==null?void 0:s[t])||`${o3}?chainId=eip155:${t}&projectId=${r||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const t=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),r=this.session.namespaces[`${this.namespace}:${t}`]?this.session.namespaces[`${this.namespace}:${t}`]:this.session.namespaces[this.namespace];this.setChainIds(t?[this.formatChainId(t)]:r==null?void 0:r.accounts),this.setAccounts(r==null?void 0:r.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(t){return typeof t=="string"||t instanceof String?[this.parseAccount(t)]:t.map(r=>this.parseAccount(r))}}const C3=Tu;export{C3 as EthereumProvider,c3 as OPTIONAL_EVENTS,a3 as OPTIONAL_METHODS,hu as REQUIRED_EVENTS,uu as REQUIRED_METHODS,Tu as default};
